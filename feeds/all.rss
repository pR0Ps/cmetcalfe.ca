<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"><channel><title>Carey Metcalfe</title><link>https://cmetcalfe.ca/</link><description></description><lastBuildDate>Sun, 23 May 2021 00:00:00 -0400</lastBuildDate><item><title>Only record audio from specific applications with NVIDIA ShadowPlay</title><link>https://cmetcalfe.ca/blog/record-audio-from-specific-applications-with-shadowplay.html</link><description>&lt;p&gt;&lt;a href="https://www.nvidia.com/en-us/geforce/geforce-experience/shadowplay/"&gt;ShadowPlay&lt;/a&gt; is a feature of modern NVIDIA graphics cards that allows for recording games and
other applications at native resolution with only a minimal performance hit. It also includes some
genuinely useful features like instant replay.&lt;/p&gt;
&lt;p&gt;Unfortunately, the audio options for recording are pretty limited. By default, all audio is recorded
to a single mixed track. This includes the game audio, but also your mic, notification sounds, any
music you're playing in the background, people talking on Steam, Discord, etc.&lt;/p&gt;
&lt;p&gt;After some experimentation I eventually found a way to pick which applications to record the audio
from, but it's not intuitive at all so I'm documenting it here.&lt;/p&gt;
&lt;h1&gt;General idea&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Create a virtual audio device&lt;/li&gt;
&lt;li&gt;Play the audio from this device to the default audio device so you can hear it&lt;/li&gt;
&lt;li&gt;Force the applications you want to record to only play audio to this device&lt;/li&gt;
&lt;li&gt;Tell ShadowPlay to only record audio from this device&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Step by step guide&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Install &lt;a href="https://www.nvidia.com/en-us/geforce/geforce-experience/"&gt;GeForce Experience&lt;/a&gt; and enable the in-game overlay and hotkey in the settings. Press
   the hotkey to bring up the overlay. In the overlay on the right you will see a microphone icon.
   Click it to bring up a dropdown menu then click on "Settings". In the menu that appears,
   configure your microphone input and select the "Separate both tracks" option. This will cause
   your microphone audio to be recorded, but in a separate track from the game audio, making it easy
   to strip out or mix in later. You can also just use the single track mode and mute the mic
   instead if you never want to record yourself.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Install &lt;a href="https://vb-audio.com/Cable/"&gt;Virtual Audio Cable&lt;/a&gt;. This will install two virtual sound devices on your system:
   "CABLE Input" (an output device) and "CABLE Output" (an input device). When sounds are played out
   the "CABLE Input" device, they can be recorded by listening to the "CABLE Output" device.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Open the "Sounds" control panel (Open the Control Panel, click "Hardware and Sound", then
   "Sound"), go to the "Recording" tab and find the "CABLE Output" device. Double click it to open
   its properties. Go to the "Listen" tab, check the "Listen to this device" option, and select the
   "Default Playback Device" as the target. This will allow you to hear any audio that is played by
   this device.
   &lt;img alt="Configuring the &amp;quot;CABLE Output&amp;quot; device in the sounds control panel" src="https://cmetcalfe.ca/images/listen_to_this_device.png"&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Launch all applications and games you want to record.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Open the Sound mixer (Start menu, type "Sound mixer options"). You should see your open programs
   mapped to audio inputs and outputs. If you don't see a "NVIDIA Container" program listed then
   activate the GeForce overlay and toggle the "Instant Replay" setting on and off to make it
   appear. Change the "Output" of the "NVIDIA Container" application to the "CABLE Input" device.
   This tells ShadowPlay to only record the audio sent to this output.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Change the "Output" of each of the applications you want to record to "CABLE Input". I'm
   recording the audio from a game called &lt;a href="https://store.steampowered.com/app/563560/Alien_Swarm_Reactive_Drop/"&gt;&lt;em&gt;Alien Swarm: Reactive Drop&lt;/em&gt;&lt;/a&gt; in the example below.
   &lt;img alt="Recording the audio from Alien Swarm: Reactive Drop" src="https://cmetcalfe.ca/images/mixer_recording_asrd.png"&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Start recording (or enable the instant replay recording mode)&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The resulting video files will only include audio from the applications you selected in step 6. If
you opted to record your microphone in step 1, it will be in a separate audio track that you can
either remove or manually mix into the main audio later.&lt;/p&gt;
&lt;h1&gt;Notes&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Tested on Windows 10 21H1 running GeForce Experience v3.22.0.32&lt;/li&gt;
&lt;li&gt;Once this is all set up, the only thing you'll have to mess with on an ongoing basis is the mixer
   settings (steps 5 and 6)&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Sun, 23 May 2021 00:00:00 -0400</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2021-05-23:/blog/record-audio-from-specific-applications-with-shadowplay.html</guid><category>blog</category><category>windows</category><category>audio</category><category>nvidia</category><category>games</category></item><item><title>Removing the Proxmox VE subscription notice</title><link>https://cmetcalfe.ca/blog/remove-proxmox-subscription-notice.html</link><description>&lt;p&gt;&lt;a href="https://www.proxmox.com/proxmox-ve"&gt;Proxmox VE&lt;/a&gt; is an open-source (&lt;a href="https://www.gnu.org/licenses/agpl-3.0.en.html"&gt;AGPL v3&lt;/a&gt;) virtualization platform for running containers and
VMs. It's comparable to a proprietary solution like &lt;a href="https://www.vmware.com/products/esxi-and-esx.html"&gt;VMware ESXi&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;It can be downloaded and installed completely free of charge, lacking only access to support and
other things that more enterprise-focused users care about. For a homelab install, the free version
is perfect.&lt;/p&gt;
&lt;p&gt;...except for one thing. Each time you log in, you have to click through this dialog:&lt;/p&gt;
&lt;p&gt;&lt;img alt="&amp;quot;You do not have a valid subscription for this server. Please visit www.proxmox.com to get a list of available options.&amp;quot;" src="https://cmetcalfe.ca/images/proxmox_subscription_notice.png"&gt;&lt;/p&gt;
&lt;p&gt;The goal of this post is to walk through developing a solution to automatically remove that
notification in any installed version of Proxmox VE, as well as have that removal survive future
updates.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;To skip to the solution, click &lt;a href="#the-solution"&gt;here&lt;/a&gt;.&lt;/strong&gt;&lt;/p&gt;
&lt;h1&gt;Developing a patch&lt;/h1&gt;
&lt;p&gt;Searching the internet reveals that a few other people (&lt;a href="https://johnscs.com/remove-proxmox51-subscription-notice/"&gt;1&lt;/a&gt;, &lt;a href="https://dannyda.com/2020/05/17/how-to-remove-you-do-not-have-a-valid-subscription-for-this-server-from-proxmox-virtual-environment-6-1-2-proxmox-ve-6-1-2-pve-6-1-2/"&gt;2&lt;/a&gt;, &lt;a href="https://www.jamescoyle.net/how-to/614-remove-the-proxmox-no-subscription-message"&gt;3&lt;/a&gt;) have already attacked
this problem. All articles point to some code in
&lt;code&gt;/usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js&lt;/code&gt; being responsible for the notification
so this is where we'll start.&lt;/p&gt;
&lt;p&gt;Scanning though that file reveals a function called &lt;a href="https://git.proxmox.com/?p=proxmox-widget-toolkit.git;a=blob;f=src/Utils.js;h=85387946165e592e89a65e6973dc7f1836edc984;hb=HEAD#l460"&gt;&lt;code&gt;checked_command(orig_cmd)&lt;/code&gt;&lt;/a&gt;.
This function just executes &lt;code&gt;orig_cmd&lt;/code&gt; after showing the subscription notification if it determines
that you don't have a valid subscription.&lt;/p&gt;
&lt;p&gt;Based on this, the goal of this patch will be to make &lt;code&gt;checked_command&lt;/code&gt; always execute &lt;code&gt;orig_cmd&lt;/code&gt;
without bothering to check if there is a subscription at all. As a bonus, this will also speed up
the login process since it removes a blocking call to the server&lt;sup id="fnref:1"&gt;&lt;a class="footnote-ref" href="#fn:1"&gt;1&lt;/a&gt;&lt;/sup&gt;.&lt;/p&gt;
&lt;p&gt;Since we want this patch to work for as many versions as possible, it's a good idea to take a look
into how this function has changed over time. By looking at the &lt;a href="https://git.proxmox.com/?p=proxmox-widget-toolkit.git"&gt;proxmox-widget-toolkit&lt;/a&gt; history,
we can see that &lt;code&gt;checked_command&lt;/code&gt; was originally added in commit &lt;a href="https://git.proxmox.com/?p=proxmox-widget-toolkit.git;a=commitdiff;h=5f93e010854dadb38fa1e7d10c00f42df38cedd4"&gt;&lt;code&gt;5f93e010&lt;/code&gt;&lt;/a&gt;. However, it
was actually moved from the &lt;a href="https://git.proxmox.com/?p=pve-manager.git;"&gt;pve-manager&lt;/a&gt; project where it was written for the &lt;a href="https://git.proxmox.com/?p=pve-manager.git;a=commitdiff;h=1556735e9c4dfdd13d1b0823942adf8feb003891"&gt;initial
implementation of the subscription notice&lt;/a&gt;. By looking at the entire history of this function we can see that
while the function implementation has changed slightly over time, the name, arguments, and goal of
it has stayed exactly the same.&lt;/p&gt;
&lt;p&gt;Given this, as long as we only use the function definition to do the patch, it should work for every
version of Proxmox VE to date (and hopefully into the future). Using &lt;code&gt;sed&lt;/code&gt; to prepend &lt;code&gt;orig_cmd();
return;&lt;/code&gt; to the function should work nicely:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sed&lt;span class="w"&gt; &lt;/span&gt;--in-place&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;s/checked_command: function(orig_cmd) {$/&amp;amp; orig_cmd(); return;/&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;/usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;This results in the following change:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gd"&gt;-checked_command: function(orig_cmd) {&lt;/span&gt;
&lt;span class="gi"&gt;+checked_command: function(orig_cmd) { orig_cmd(); return;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Notice that the &lt;code&gt;sed&lt;/code&gt; script is looking for the function definition followed by a line ending (&lt;code&gt;$&lt;/code&gt;).
Because the patch is added to the same line, if the command is run again it won't match and won't
make any changes, making it safe to blindly run multiple times. This becomes important for
automating it later.&lt;/p&gt;
&lt;p&gt;Now that we know it works, we should harden it up against whitespace changes by replacing the spaces
in the regex with &lt;code&gt;\s*&lt;/code&gt; (0 or more whitespace characters):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sed&lt;span class="w"&gt; &lt;/span&gt;--in-place&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;s/checked_command:\s*function(orig_cmd)\s*{\s*$/&amp;amp; orig_cmd(); return;/&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;/usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;The only thing left to solve is which file &lt;code&gt;checked_command&lt;/code&gt; is defined in. Since it used to be a
part of the &lt;code&gt;pve-manager&lt;/code&gt; project, it's safe to say that it wasn't always stored in
&lt;code&gt;/usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js&lt;/code&gt;. It could also move around in the
future.&lt;/p&gt;
&lt;p&gt;To deal with this, we use &lt;code&gt;grep&lt;/code&gt; to find the file that it's defined in, then run the previous
command over that file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;grep&lt;span class="w"&gt; &lt;/span&gt;--files-with-matches&lt;span class="w"&gt; &lt;/span&gt;--include&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;*.js&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;--recursive&lt;span class="w"&gt; &lt;/span&gt;--null&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;checked_command:\s*function(orig_cmd)&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;/usr/share/&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;xargs&lt;span class="w"&gt; &lt;/span&gt;--null&lt;span class="w"&gt; &lt;/span&gt;--no-run-if-empty&lt;span class="w"&gt; &lt;/span&gt;sed&lt;span class="w"&gt; &lt;/span&gt;--in-place&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;s/checked_command:\s*function(orig_cmd)\s*{\s*$/&amp;amp; orig_cmd(); return;/&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Simply run this command on your Proxmox VE server&lt;sup id="fnref:2"&gt;&lt;a class="footnote-ref" href="#fn:2"&gt;2&lt;/a&gt;&lt;/sup&gt;, refresh the web UI, and the notice should be
gone!&lt;/p&gt;
&lt;h1&gt;Automating it&lt;/h1&gt;
&lt;p&gt;At this point we have a working command that will remove the subscription notice from any version of
Proxmox VE to date. However, after updating the system, there's a chance that a newer version of the
file will have overwritten our patched version.&lt;/p&gt;
&lt;p&gt;While we could just save the command in a script and manually run it after every update, that's
annoying and will definitely be forgotten. Instead, we want to automatically run the command every
time the web server starts. This will ensure that it will always be serving a patched version of the
file.&lt;/p&gt;
&lt;p&gt;Proxmox VE uses &lt;a href="https://systemd.io/"&gt;&lt;code&gt;systemd&lt;/code&gt;&lt;/a&gt; to manage the startup of its services. This means that once we
find the service that manages the web server, we should be able to make &lt;code&gt;systemd&lt;/code&gt; launch a service
that applies our patch just before the web server.&lt;/p&gt;
&lt;p&gt;The first step is to find the service that manages the web server. Since we know it's running on
port 8006, we can use &lt;code&gt;netstat&lt;/code&gt; to enumerate all listening TCP ports and &lt;code&gt;grep&lt;/code&gt; to filter it down to
just the port we're interested in:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$&lt;span class="w"&gt; &lt;/span&gt;netstat&lt;span class="w"&gt; &lt;/span&gt;--listening&lt;span class="w"&gt; &lt;/span&gt;--tcp&lt;span class="w"&gt; &lt;/span&gt;--numeric-ports&lt;span class="w"&gt; &lt;/span&gt;--program&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;grep&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;8006&lt;/span&gt;
tcp&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;.0.0.0:8006&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;.0.0.0:*&lt;span class="w"&gt;  &lt;/span&gt;LISTEN&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;15771&lt;/span&gt;/pveproxy
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Once we know the PID of the program, running &lt;code&gt;systemctl status &amp;lt;PID&amp;gt;&lt;/code&gt; will show the status
(including the service name) of the service that's managing it&lt;sup id="fnref:3"&gt;&lt;a class="footnote-ref" href="#fn:3"&gt;3&lt;/a&gt;&lt;/sup&gt;. In this case it shows that the
service is &lt;code&gt;pveproxy.service&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;We can now define a service that runs our code, is wanted by &lt;code&gt;pveproxy.service&lt;/code&gt;, and
must be run before it. Then, whenever &lt;code&gt;systemd&lt;/code&gt; starts (or restarts) &lt;code&gt;pveproxy.service&lt;/code&gt;, it will
make sure to also run our service that applies the patch.&lt;/p&gt;
&lt;h1&gt;The solution&lt;/h1&gt;
&lt;p&gt;&lt;a name="the-solution"&gt;&lt;/a&gt;
Putting it all together:&lt;/p&gt;
&lt;p&gt;1. Create &lt;code&gt;/etc/systemd/system/no-subscription-notice.service&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt; 1&lt;/span&gt;
&lt;span class="normal"&gt; 2&lt;/span&gt;
&lt;span class="normal"&gt; 3&lt;/span&gt;
&lt;span class="normal"&gt; 4&lt;/span&gt;
&lt;span class="normal"&gt; 5&lt;/span&gt;
&lt;span class="normal"&gt; 6&lt;/span&gt;
&lt;span class="normal"&gt; 7&lt;/span&gt;
&lt;span class="normal"&gt; 8&lt;/span&gt;
&lt;span class="normal"&gt; 9&lt;/span&gt;
&lt;span class="normal"&gt;10&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;[Unit]&lt;/span&gt;
&lt;span class="na"&gt;Description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;Remove Proxmox VE subscription notice&lt;/span&gt;
&lt;span class="na"&gt;Before&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;pveproxy.service&lt;/span&gt;

&lt;span class="k"&gt;[Service]&lt;/span&gt;
&lt;span class="na"&gt;Type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;oneshot&lt;/span&gt;
&lt;span class="na"&gt;ExecStart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/bin/sh -c &amp;quot;grep --files-with-matches --include &amp;#39;*.js&amp;#39; --recursive --null &amp;#39;checked_command:\s*function(orig_cmd)&amp;#39; /usr/share/ | xargs --null --no-run-if-empty sed --in-place &amp;#39;s/checked_command:\s*function(orig_cmd)\s*{\s*$/&amp;amp; orig_cmd()&lt;/span&gt;&lt;span class="c1"&gt;; return;/&amp;#39;&amp;quot;&lt;/span&gt;

&lt;span class="k"&gt;[Install]&lt;/span&gt;
&lt;span class="na"&gt;WantedBy&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;pveproxy.service&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;2. &lt;code&gt;systemctl enable --now no-subscription-notice.service&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;And that's it! The subscription notice should now be gone for good. I'll update this post if it
breaks, but that hopefully won't be for a while.&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:1"&gt;
&lt;p&gt;Interestingly, the existing solutions I found all patch the code that checks the returned
    subscription status instead of just not asking about the status at all. Compared to the
    solution here, this is both more fragile, as well as slower.&amp;#160;&lt;a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:2"&gt;
&lt;p&gt;Commands can be run from the web UI (Datacenter -&amp;gt; node -&amp;gt; Shell), via SSH, or just by
    using a keyboard and monitor hooked up to the server.&amp;#160;&lt;a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:3"&gt;
&lt;p&gt;Another way to go from PID or command to service name is to use &lt;code&gt;ps&lt;/code&gt; like so:
    &lt;code&gt;ps --format=unit= &amp;lt;PID&amp;gt;&lt;/code&gt; or &lt;code&gt;ps --format=unit= -C &amp;lt;cmd&amp;gt;&lt;/code&gt;. Note that this requires your
    version of &lt;code&gt;ps&lt;/code&gt; to be compiled with &lt;code&gt;systemd&lt;/code&gt; support (which it is in most &lt;code&gt;systemd&lt;/code&gt;-based
    distros).&amp;#160;&lt;a class="footnote-backref" href="#fnref:3" title="Jump back to footnote 3 in the text"&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Wed, 28 Apr 2021 10:03:00 -0400</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2021-04-28:/blog/remove-proxmox-subscription-notice.html</guid><category>blog</category><category>proxmox</category><category>linux</category><category>shell script</category></item><item><title>Preventing auto-locking and sleeping by simulating user activity</title><link>https://cmetcalfe.ca/blog/prevent-auto-lock-by-simulating-activity.html</link><description>&lt;p&gt;This post will detail how to simulate activity on your computer in order to prevent it from
auto-locking or going into sleep mode. Note that this will usually also prevent the "auto-away"
functionality of various chat programs from ever marking you as "away".&lt;/p&gt;
&lt;p&gt;Generally you should change your operating system's settings to disable sleeping and auto-locking if
possible instead. These methods are for when you don't have the access or permission to change those
settings (ie. locked-down devices).&lt;/p&gt;
&lt;h2&gt;Windows&lt;/h2&gt;
&lt;p&gt;This method runs a &lt;a href="https://en.wikipedia.org/wiki/Powershell"&gt;Powershell&lt;/a&gt; script on login that toggles &lt;a href="https://en.wikipedia.org/wiki/Scroll_lock"&gt;scroll lock&lt;/a&gt; on/off every minute.
Since scroll lock mostly doesn't do anything on modern systems and the script will press it twice to
immediately unlock/relock it, this is basically unnoticeable to the user. However, if you have
issues simply swap the two &lt;code&gt;{SCROLLLOCK}&lt;/code&gt;s in the below command to something else. A full list of
special keys can be found &lt;a href="https://social.technet.microsoft.com/wiki/contents/articles/5169.vbscript-sendkeys-method.aspx"&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Open Explorer (shortcut: &lt;code&gt;Win+E&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;Paste &lt;code&gt;%APPDATA%\Microsoft\Windows\Start Menu\Programs\Startup&lt;/code&gt; into the location bar and hit
   enter to navigate there.&lt;/li&gt;
&lt;li&gt;Right click in the folder and click &lt;code&gt;New &amp;gt; Shortcut&lt;/code&gt; to open the shortcut creation wizard.&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Paste the following as the shortcut's location:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;powershell.exe -windowstyle hidden -command &amp;quot;$myshell=New-Object -com \&amp;quot;Wscript.Shell\&amp;quot;;while(1){$myshell.SendKeys(\&amp;quot;{SCROLLLOCK}{SCROLLLOCK}\&amp;quot;);Start-Sleep -Seconds 60}&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Give it any name you like and hit &lt;code&gt;Finish&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;macOS&lt;/h2&gt;
&lt;p&gt;This method runs a shell script on login that uses a tool called &lt;a href="https://www.bluem.net/en/projects/cliclick/"&gt;&lt;code&gt;cliclick&lt;/code&gt;&lt;/a&gt; to move the
mouse one pixel left and right every minute. This is such a small and fast movement that it's
usually not noticeable unless you're really looking for it.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Install &lt;code&gt;cliclick&lt;/code&gt; from &lt;a href="https://www.bluem.net/en/projects/cliclick/"&gt;the project website&lt;/a&gt; or via &lt;a href="https://brew.sh/"&gt;brew&lt;/a&gt; (&lt;code&gt;brew install cliclick&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;Create a script called &lt;code&gt;jiggle&lt;/code&gt; with the following contents:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;
&lt;span class="normal"&gt;5&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#!/bin/sh
while true; do
    cliclick &amp;#39;m:-1,+0&amp;#39; &amp;#39;m:+1,+0&amp;#39;
    sleep 60
done
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;ol&gt;
&lt;li&gt;Make the script executable (&lt;code&gt;chmod +x jiggle&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;Open System Preferences, search for "login items" and hit enter.&lt;/li&gt;
&lt;li&gt;Click the &lt;code&gt;+&lt;/code&gt; button, select the &lt;code&gt;jiggle&lt;/code&gt; script and hit "Add". You should see it appear in the
   list of programs as a "Unix executable". Check the "Hide" checkbox beside it and exit.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Xorg-based Linux&lt;/h2&gt;
&lt;p&gt;Much like the macOS version above, this moves the mouse one pixel left and right every minute. If
you would prefer to instead use a keyboard-based method like the above Windows version, use &lt;code&gt;xdotool
key Scroll_Lock&lt;/code&gt; twice instead of the &lt;code&gt;xdotool mousemove_relative *&lt;/code&gt; commands in the following
script. More special key names for &lt;code&gt;xdotool&lt;/code&gt; can be found &lt;a href="https://gitlab.com/cunidev/gestures/-/wikis/xdotool-list-of-key-codes"&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Install &lt;a href="https://www.semicomplete.com/projects/xdotool/"&gt;&lt;code&gt;xdotool&lt;/code&gt;&lt;/a&gt; (usually available via your package manager)&lt;/li&gt;
&lt;li&gt;Create a script called &lt;code&gt;jiggle&lt;/code&gt; with the following contents:&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;
&lt;span class="normal"&gt;5&lt;/span&gt;
&lt;span class="normal"&gt;6&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#!/bin/sh
while true; do
    xdotool mousemove_relative --sync -- -1 0
    xdotool mousemove_relative 1 0
    sleep 60
done
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;ol&gt;
&lt;li&gt;Make the script executable (&lt;code&gt;chmod +x jiggle&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;Configure your OS to run the script at login. Usually this would be done through the desktop
   environment's settings or via something like &lt;a href="https://www.freedesktop.org/wiki/Software/systemd/"&gt;&lt;code&gt;systemd&lt;/code&gt;&lt;/a&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Wayland-based Linux&lt;/h2&gt;
&lt;p&gt;Some preliminary research suggests that this is possible on Wayland using &lt;a href="https://github.com/ReimuNotMoe/ydotool"&gt;&lt;code&gt;ydotool&lt;/code&gt;&lt;/a&gt; as a
replacement for &lt;code&gt;xdotool&lt;/code&gt;. I don't currently run a Wayland-based setup so I can't test it. If you
manage to find a solution for Wayland feel free to send it to me and I'll update the post.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Thu, 10 Dec 2020 23:12:00 -0500</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2020-12-10:/blog/prevent-auto-lock-by-simulating-activity.html</guid><category>blog</category><category>windows</category><category>macOS</category><category>linux</category><category>shell script</category></item><item><title>Diagnosing periodic high ping times on macOS</title><link>https://cmetcalfe.ca/blog/diagnosing-periodic-high-ping-times-on-macos.html</link><description>&lt;h2&gt;Background&lt;/h2&gt;
&lt;p&gt;Up until a few months ago, my home network setup was pretty terrible. The entire house ran off the
WiFi provided by an &lt;a href="https://openwrt.org/"&gt;OpenWRT&lt;/a&gt;-powered &lt;a href="https://www.tp-link.com/us/products/details/TL-WDR3600.html"&gt;TP-Link WDR3600&lt;/a&gt; from 2013 in the far corner of the
house. So when I fired up a game on my laptop via &lt;a href="https://store.steampowered.com/streaming/"&gt;Steam in-home streaming&lt;/a&gt; and got unplayable lag
and stuttering, I just figured that the issue was the network and left it at that. After all, the
gaming PC was connected via WiFI from the opposite corner of the house with no shortage of walls in
between.&lt;/p&gt;
&lt;p&gt;In November 2018, I finally got serious about the network upgrade I had been planning. I'll probably
do a more in-depth post about this at some point, but to make a long story short: Most things are
wired and what isn't is connected via a modern, centrally-located access point. Performance is
noticeably better in general and &lt;em&gt;amazingly&lt;/em&gt; better for high-bandwidth tasks like transferring
files.&lt;/p&gt;
&lt;p&gt;So when I excitedly fired up the same game on my laptop, I was pretty surprised that it was still
unplayable. At this point I should clarify that the game was not something that requires a CRT and
wired controller for super-low response times. So when I say unplayable, I mean legitimately
unplayable. I'm talking periodic lag spikes that caused the video to drop a few seconds or more
behind the inputs. Even turn-based games would have issues with the amount of lag.&lt;/p&gt;
&lt;h2&gt;Narrowing the scope&lt;/h2&gt;
&lt;p&gt;To make sure it wasn't an issue with the streaming software, the gaming PC, or the network, I used
&lt;code&gt;ping&lt;/code&gt; to test the latency to the gateway from a few hosts. All the computers &lt;em&gt;except&lt;/em&gt; my laptop had
normal ping times. Running it on my laptop looked like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt; 1&lt;/span&gt;
&lt;span class="normal"&gt; 2&lt;/span&gt;
&lt;span class="normal"&gt; 3&lt;/span&gt;
&lt;span class="normal"&gt; 4&lt;/span&gt;
&lt;span class="normal"&gt; 5&lt;/span&gt;
&lt;span class="normal"&gt; 6&lt;/span&gt;
&lt;span class="normal"&gt; 7&lt;/span&gt;
&lt;span class="normal"&gt; 8&lt;/span&gt;
&lt;span class="normal"&gt; 9&lt;/span&gt;
&lt;span class="normal"&gt;10&lt;/span&gt;
&lt;span class="normal"&gt;11&lt;/span&gt;
&lt;span class="normal"&gt;12&lt;/span&gt;
&lt;span class="normal"&gt;13&lt;/span&gt;
&lt;span class="normal"&gt;14&lt;/span&gt;
&lt;span class="normal"&gt;15&lt;/span&gt;
&lt;span class="normal"&gt;16&lt;/span&gt;
&lt;span class="normal"&gt;17&lt;/span&gt;
&lt;span class="normal"&gt;18&lt;/span&gt;
&lt;span class="normal"&gt;19&lt;/span&gt;
&lt;span class="normal"&gt;20&lt;/span&gt;
&lt;span class="normal"&gt;21&lt;/span&gt;
&lt;span class="normal"&gt;22&lt;/span&gt;
&lt;span class="normal"&gt;23&lt;/span&gt;
&lt;span class="normal"&gt;24&lt;/span&gt;
&lt;span class="normal"&gt;25&lt;/span&gt;
&lt;span class="normal"&gt;26&lt;/span&gt;
&lt;span class="normal"&gt;27&lt;/span&gt;
&lt;span class="normal"&gt;28&lt;/span&gt;
&lt;span class="normal"&gt;29&lt;/span&gt;
&lt;span class="normal"&gt;30&lt;/span&gt;
&lt;span class="normal"&gt;31&lt;/span&gt;
&lt;span class="normal"&gt;32&lt;/span&gt;
&lt;span class="normal"&gt;33&lt;/span&gt;
&lt;span class="normal"&gt;34&lt;/span&gt;
&lt;span class="normal"&gt;35&lt;/span&gt;
&lt;span class="normal"&gt;36&lt;/span&gt;
&lt;span class="normal"&gt;37&lt;/span&gt;
&lt;span class="normal"&gt;38&lt;/span&gt;
&lt;span class="normal"&gt;39&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$&lt;span class="w"&gt; &lt;/span&gt;ping&lt;span class="w"&gt; &lt;/span&gt;pfsense.lan&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;tee&lt;span class="w"&gt; &lt;/span&gt;&amp;gt;&lt;span class="o"&gt;(&lt;/span&gt;grep&lt;span class="w"&gt; &lt;/span&gt;-oP&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;time=\K\S*&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;spark&lt;span class="o"&gt;)&lt;/span&gt;
PING&lt;span class="w"&gt; &lt;/span&gt;pfsense.lan&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1&lt;span class="o"&gt;)&lt;/span&gt;:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;56&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;data&lt;span class="w"&gt; &lt;/span&gt;bytes
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.574&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;.996&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.568&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;92&lt;/span&gt;.153&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;39&lt;/span&gt;.079&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;14&lt;/span&gt;.307&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;6&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.570&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;7&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.636&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;8&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.698&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;9&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.568&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.550&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;11&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.106&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;12&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.832&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;13&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.816&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;14&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;36&lt;/span&gt;.598&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;15&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;42&lt;/span&gt;.863&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;16&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;.747&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;17&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;.112&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;18&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.695&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;19&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.795&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.504&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;21&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.644&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;22&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.732&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;23&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.581&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;24&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.794&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;25&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;33&lt;/span&gt;.367&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;26&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;124&lt;/span&gt;.282&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;27&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;97&lt;/span&gt;.719&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;28&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;76&lt;/span&gt;.501&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;29&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.734&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;30&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.622&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;31&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.758&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;32&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.578&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;33&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.527&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;34&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;.017&lt;span class="w"&gt; &lt;/span&gt;ms
^C
&lt;span class="w"&gt; &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;(sweet graph at the end courtesy of &lt;a href="https://github.com/holman/spark/wiki/Wicked-Cool-Usage#visualize-ping-times-jnovinger"&gt;spark&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;Notice the periodic spikes. Clearly there's something going on with the network connection on my
laptop. Connecting via a wired connection and running it again confirmed that it was only happening
on WiFi.&lt;/p&gt;
&lt;h2&gt;WiFi debugging&lt;/h2&gt;
&lt;p&gt;Now that I had narrowed the issue down to an issue with the WiFi, I could start trying to debug it.&lt;/p&gt;
&lt;p&gt;After coming across &lt;a href="https://superuser.com/questions/585473/debugging-osx-airport-wifi-connection/735572#735572"&gt;this very helpful post&lt;/a&gt; explaining how, I enabled WiFi debug logging by running:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo&lt;span class="w"&gt; &lt;/span&gt;/System/Library/PrivateFrameworks/Apple80211.framework/Versions/A/Resources/airport&lt;span class="w"&gt; &lt;/span&gt;en0&lt;span class="w"&gt; &lt;/span&gt;debug&lt;span class="w"&gt; &lt;/span&gt;+AllUserland
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;(remember to turn this off after, &lt;code&gt;airport&lt;/code&gt; is pretty chatty with debug logs enabled)&lt;/p&gt;
&lt;p&gt;I then watched the wifi log (&lt;code&gt;sudo tail -f /var/log/wifi.log&lt;/code&gt;) as I ran the same &lt;code&gt;ping&lt;/code&gt; command.
Whenever I saw ping times spike, I also saw the following entries in the WiFi log:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt; 1&lt;/span&gt;
&lt;span class="normal"&gt; 2&lt;/span&gt;
&lt;span class="normal"&gt; 3&lt;/span&gt;
&lt;span class="normal"&gt; 4&lt;/span&gt;
&lt;span class="normal"&gt; 5&lt;/span&gt;
&lt;span class="normal"&gt; 6&lt;/span&gt;
&lt;span class="normal"&gt; 7&lt;/span&gt;
&lt;span class="normal"&gt; 8&lt;/span&gt;
&lt;span class="normal"&gt; 9&lt;/span&gt;
&lt;span class="normal"&gt;10&lt;/span&gt;
&lt;span class="normal"&gt;11&lt;/span&gt;
&lt;span class="normal"&gt;12&lt;/span&gt;
&lt;span class="normal"&gt;13&lt;/span&gt;
&lt;span class="normal"&gt;14&lt;/span&gt;
&lt;span class="normal"&gt;15&lt;/span&gt;
&lt;span class="normal"&gt;16&lt;/span&gt;
&lt;span class="normal"&gt;17&lt;/span&gt;
&lt;span class="normal"&gt;18&lt;/span&gt;
&lt;span class="normal"&gt;19&lt;/span&gt;
&lt;span class="normal"&gt;20&lt;/span&gt;
&lt;span class="normal"&gt;21&lt;/span&gt;
&lt;span class="normal"&gt;22&lt;/span&gt;
&lt;span class="normal"&gt;23&lt;/span&gt;
&lt;span class="normal"&gt;24&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Tue&lt;span class="w"&gt; &lt;/span&gt;Nov&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;27&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;02&lt;/span&gt;:01:33.764&lt;span class="w"&gt; &lt;/span&gt;IPC:&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;airportd&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="m"&gt;68&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;ADDED&lt;span class="w"&gt; &lt;/span&gt;XPC&lt;span class="w"&gt; &lt;/span&gt;CLIENT&lt;span class="w"&gt; &lt;/span&gt;CONNECTION&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;QSyncthingTray&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;pid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;14397&lt;/span&gt;,&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;euid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;501&lt;/span&gt;,&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;egid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="o"&gt;)]&lt;/span&gt;
Tue&lt;span class="w"&gt; &lt;/span&gt;Nov&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;27&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;02&lt;/span&gt;:01:33.765&lt;span class="w"&gt; &lt;/span&gt;Info:&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;airportd&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="m"&gt;68&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;SCAN&lt;span class="w"&gt; &lt;/span&gt;request&lt;span class="w"&gt; &lt;/span&gt;received&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;pid&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;14397&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;QSyncthingTray&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;with&lt;span class="w"&gt; &lt;/span&gt;priority&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;
Tue&lt;span class="w"&gt; &lt;/span&gt;Nov&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;27&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;02&lt;/span&gt;:01:33.766&lt;span class="w"&gt; &lt;/span&gt;Scan:&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;airportd&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="m"&gt;68&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;Cache-assisted&lt;span class="w"&gt; &lt;/span&gt;scan&lt;span class="w"&gt; &lt;/span&gt;request&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;QSyncthingTray&lt;span class="w"&gt; &lt;/span&gt;on&lt;span class="w"&gt; &lt;/span&gt;channel&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;does&lt;span class="w"&gt; &lt;/span&gt;not&lt;span class="w"&gt; &lt;/span&gt;require&lt;span class="w"&gt; &lt;/span&gt;a&lt;span class="w"&gt; &lt;/span&gt;live&lt;span class="w"&gt; &lt;/span&gt;scan
Tue&lt;span class="w"&gt; &lt;/span&gt;Nov&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;27&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;02&lt;/span&gt;:01:33.766&lt;span class="w"&gt; &lt;/span&gt;Scan:&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;airportd&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="m"&gt;68&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;Cache-assisted&lt;span class="w"&gt; &lt;/span&gt;scan&lt;span class="w"&gt; &lt;/span&gt;request&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;QSyncthingTray&lt;span class="w"&gt; &lt;/span&gt;on&lt;span class="w"&gt; &lt;/span&gt;channel&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;does&lt;span class="w"&gt; &lt;/span&gt;not&lt;span class="w"&gt; &lt;/span&gt;require&lt;span class="w"&gt; &lt;/span&gt;a&lt;span class="w"&gt; &lt;/span&gt;live&lt;span class="w"&gt; &lt;/span&gt;scan
Tue&lt;span class="w"&gt; &lt;/span&gt;Nov&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;27&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;02&lt;/span&gt;:01:33.766&lt;span class="w"&gt; &lt;/span&gt;Scan:&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;airportd&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="m"&gt;68&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;Cache-assisted&lt;span class="w"&gt; &lt;/span&gt;scan&lt;span class="w"&gt; &lt;/span&gt;request&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;QSyncthingTray&lt;span class="w"&gt; &lt;/span&gt;on&lt;span class="w"&gt; &lt;/span&gt;channel&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;does&lt;span class="w"&gt; &lt;/span&gt;not&lt;span class="w"&gt; &lt;/span&gt;require&lt;span class="w"&gt; &lt;/span&gt;a&lt;span class="w"&gt; &lt;/span&gt;live&lt;span class="w"&gt; &lt;/span&gt;scan
Tue&lt;span class="w"&gt; &lt;/span&gt;Nov&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;27&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;02&lt;/span&gt;:01:33.766&lt;span class="w"&gt; &lt;/span&gt;Scan:&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;airportd&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="m"&gt;68&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;Cache-assisted&lt;span class="w"&gt; &lt;/span&gt;scan&lt;span class="w"&gt; &lt;/span&gt;request&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;QSyncthingTray&lt;span class="w"&gt; &lt;/span&gt;on&lt;span class="w"&gt; &lt;/span&gt;channel&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;does&lt;span class="w"&gt; &lt;/span&gt;not&lt;span class="w"&gt; &lt;/span&gt;require&lt;span class="w"&gt; &lt;/span&gt;a&lt;span class="w"&gt; &lt;/span&gt;live&lt;span class="w"&gt; &lt;/span&gt;scan
Tue&lt;span class="w"&gt; &lt;/span&gt;Nov&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;27&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;02&lt;/span&gt;:01:33.766&lt;span class="w"&gt; &lt;/span&gt;Scan:&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;airportd&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="m"&gt;68&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;Cache-assisted&lt;span class="w"&gt; &lt;/span&gt;scan&lt;span class="w"&gt; &lt;/span&gt;request&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;QSyncthingTray&lt;span class="w"&gt; &lt;/span&gt;on&lt;span class="w"&gt; &lt;/span&gt;channel&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;does&lt;span class="w"&gt; &lt;/span&gt;not&lt;span class="w"&gt; &lt;/span&gt;require&lt;span class="w"&gt; &lt;/span&gt;a&lt;span class="w"&gt; &lt;/span&gt;live&lt;span class="w"&gt; &lt;/span&gt;scan
Tue&lt;span class="w"&gt; &lt;/span&gt;Nov&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;27&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;02&lt;/span&gt;:01:33.766&lt;span class="w"&gt; &lt;/span&gt;Scan:&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;airportd&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="m"&gt;68&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;Cache-assisted&lt;span class="w"&gt; &lt;/span&gt;scan&lt;span class="w"&gt; &lt;/span&gt;request&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;QSyncthingTray&lt;span class="w"&gt; &lt;/span&gt;on&lt;span class="w"&gt; &lt;/span&gt;channel&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;6&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;does&lt;span class="w"&gt; &lt;/span&gt;not&lt;span class="w"&gt; &lt;/span&gt;require&lt;span class="w"&gt; &lt;/span&gt;a&lt;span class="w"&gt; &lt;/span&gt;live&lt;span class="w"&gt; &lt;/span&gt;scan
Tue&lt;span class="w"&gt; &lt;/span&gt;Nov&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;27&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;02&lt;/span&gt;:01:33.766&lt;span class="w"&gt; &lt;/span&gt;Scan:&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;airportd&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="m"&gt;68&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;Cache-assisted&lt;span class="w"&gt; &lt;/span&gt;scan&lt;span class="w"&gt; &lt;/span&gt;request&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;QSyncthingTray&lt;span class="w"&gt; &lt;/span&gt;does&lt;span class="w"&gt; &lt;/span&gt;not&lt;span class="w"&gt; &lt;/span&gt;require&lt;span class="w"&gt; &lt;/span&gt;a&lt;span class="w"&gt; &lt;/span&gt;live&lt;span class="w"&gt; &lt;/span&gt;scan
Tue&lt;span class="w"&gt; &lt;/span&gt;Nov&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;27&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;02&lt;/span&gt;:01:33.766&lt;span class="w"&gt; &lt;/span&gt;AutoJoin:&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;airportd&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="m"&gt;68&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;Successful&lt;span class="w"&gt; &lt;/span&gt;cache-assisted&lt;span class="w"&gt; &lt;/span&gt;scan&lt;span class="w"&gt; &lt;/span&gt;request&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;QSyncthingTray&lt;span class="w"&gt; &lt;/span&gt;with&lt;span class="w"&gt; &lt;/span&gt;channels&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;{(&lt;/span&gt;
Tue&lt;span class="w"&gt; &lt;/span&gt;Nov&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;27&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;02&lt;/span&gt;:01:33.766&lt;span class="w"&gt;     &lt;/span&gt;&amp;lt;CWChannel:&lt;span class="w"&gt; &lt;/span&gt;0x7f9073514e70&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;channelNumber&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;2GHz&lt;span class="o"&gt;)&lt;/span&gt;,&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;channelWidth&lt;/span&gt;&lt;span class="o"&gt;={&lt;/span&gt;20MHz&lt;span class="o"&gt;}&lt;/span&gt;,&lt;span class="w"&gt; &lt;/span&gt;active&lt;span class="o"&gt;]&lt;/span&gt;,
Tue&lt;span class="w"&gt; &lt;/span&gt;Nov&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;27&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;02&lt;/span&gt;:01:33.766&lt;span class="w"&gt;     &lt;/span&gt;&amp;lt;CWChannel:&lt;span class="w"&gt; &lt;/span&gt;0x7f90735507b0&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;channelNumber&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;2GHz&lt;span class="o"&gt;)&lt;/span&gt;,&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;channelWidth&lt;/span&gt;&lt;span class="o"&gt;={&lt;/span&gt;20MHz&lt;span class="o"&gt;}&lt;/span&gt;,&lt;span class="w"&gt; &lt;/span&gt;active&lt;span class="o"&gt;]&lt;/span&gt;,
Tue&lt;span class="w"&gt; &lt;/span&gt;Nov&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;27&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;02&lt;/span&gt;:01:33.766&lt;span class="w"&gt;     &lt;/span&gt;&amp;lt;CWChannel:&lt;span class="w"&gt; &lt;/span&gt;0x7f9073526370&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;channelNumber&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;2GHz&lt;span class="o"&gt;)&lt;/span&gt;,&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;channelWidth&lt;/span&gt;&lt;span class="o"&gt;={&lt;/span&gt;20MHz&lt;span class="o"&gt;}&lt;/span&gt;,&lt;span class="w"&gt; &lt;/span&gt;active&lt;span class="o"&gt;]&lt;/span&gt;,
Tue&lt;span class="w"&gt; &lt;/span&gt;Nov&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;27&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;02&lt;/span&gt;:01:33.766&lt;span class="w"&gt;     &lt;/span&gt;&amp;lt;CWChannel:&lt;span class="w"&gt; &lt;/span&gt;0x7f9073526420&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;channelNumber&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;2GHz&lt;span class="o"&gt;)&lt;/span&gt;,&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;channelWidth&lt;/span&gt;&lt;span class="o"&gt;={&lt;/span&gt;20MHz&lt;span class="o"&gt;}&lt;/span&gt;,&lt;span class="w"&gt; &lt;/span&gt;active&lt;span class="o"&gt;]&lt;/span&gt;,
Tue&lt;span class="w"&gt; &lt;/span&gt;Nov&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;27&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;02&lt;/span&gt;:01:33.766&lt;span class="w"&gt;     &lt;/span&gt;&amp;lt;CWChannel:&lt;span class="w"&gt; &lt;/span&gt;0x7f907354ddb0&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;channelNumber&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;5&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;2GHz&lt;span class="o"&gt;)&lt;/span&gt;,&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;channelWidth&lt;/span&gt;&lt;span class="o"&gt;={&lt;/span&gt;20MHz&lt;span class="o"&gt;}&lt;/span&gt;,&lt;span class="w"&gt; &lt;/span&gt;active&lt;span class="o"&gt;]&lt;/span&gt;,
Tue&lt;span class="w"&gt; &lt;/span&gt;Nov&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;27&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;02&lt;/span&gt;:01:33.766&lt;span class="w"&gt;     &lt;/span&gt;&amp;lt;CWChannel:&lt;span class="w"&gt; &lt;/span&gt;0x7f907354c6c0&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;channelNumber&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;6&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;2GHz&lt;span class="o"&gt;)&lt;/span&gt;,&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;channelWidth&lt;/span&gt;&lt;span class="o"&gt;={&lt;/span&gt;20MHz&lt;span class="o"&gt;}&lt;/span&gt;,&lt;span class="w"&gt; &lt;/span&gt;active&lt;span class="o"&gt;]&lt;/span&gt;
Tue&lt;span class="w"&gt; &lt;/span&gt;Nov&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;27&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;02&lt;/span&gt;:01:33.766&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;)}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;took&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;.0007&lt;span class="w"&gt; &lt;/span&gt;seconds,&lt;span class="w"&gt; &lt;/span&gt;returned&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;results
&amp;lt;&lt;span class="w"&gt; &lt;/span&gt;insert&lt;span class="w"&gt; &lt;/span&gt;logs&lt;span class="w"&gt; &lt;/span&gt;like&lt;span class="w"&gt; &lt;/span&gt;above&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;all&lt;span class="w"&gt; &lt;/span&gt;channels&lt;span class="w"&gt; &lt;/span&gt;all&lt;span class="w"&gt; &lt;/span&gt;the&lt;span class="w"&gt; &lt;/span&gt;way&lt;span class="w"&gt; &lt;/span&gt;up&lt;span class="w"&gt; &lt;/span&gt;to&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;144&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;batches&lt;span class="w"&gt; &lt;/span&gt;of&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;6&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&amp;gt;
Tue&lt;span class="w"&gt; &lt;/span&gt;Nov&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;27&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;02&lt;/span&gt;:01:33.779&lt;span class="w"&gt; &lt;/span&gt;IPC:&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;airportd&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="m"&gt;68&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;INVALIDATED&lt;span class="w"&gt; &lt;/span&gt;XPC&lt;span class="w"&gt; &lt;/span&gt;CLIENT&lt;span class="w"&gt; &lt;/span&gt;CONNECTION&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;QSyncthingTray&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;pid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;14397&lt;/span&gt;,&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;euid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;501&lt;/span&gt;,&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;egid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="o"&gt;)]&lt;/span&gt;
&amp;lt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;seconds&lt;span class="w"&gt; &lt;/span&gt;pass&amp;gt;
Tue&lt;span class="w"&gt; &lt;/span&gt;Nov&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;27&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;02&lt;/span&gt;:01:43.847&lt;span class="w"&gt; &lt;/span&gt;IPC:&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;airportd&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="m"&gt;68&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;ADDED&lt;span class="w"&gt; &lt;/span&gt;XPC&lt;span class="w"&gt; &lt;/span&gt;CLIENT&lt;span class="w"&gt; &lt;/span&gt;CONNECTION&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;QSyncthingTray&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;pid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;14397&lt;/span&gt;,&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;euid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;501&lt;/span&gt;,&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;egid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="o"&gt;)]&lt;/span&gt;
&amp;lt;&lt;span class="w"&gt; &lt;/span&gt;same&lt;span class="w"&gt; &lt;/span&gt;scanning&lt;span class="w"&gt; &lt;/span&gt;logs&lt;span class="w"&gt; &lt;/span&gt;as&lt;span class="w"&gt; &lt;/span&gt;above&lt;span class="w"&gt; &lt;/span&gt;&amp;gt;
Tue&lt;span class="w"&gt; &lt;/span&gt;Nov&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;27&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;02&lt;/span&gt;:01:46.741&lt;span class="w"&gt; &lt;/span&gt;IPC:&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;airportd&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="m"&gt;68&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;INVALIDATED&lt;span class="w"&gt; &lt;/span&gt;XPC&lt;span class="w"&gt; &lt;/span&gt;CLIENT&lt;span class="w"&gt; &lt;/span&gt;CONNECTION&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;QSyncthingTray&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;pid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;14397&lt;/span&gt;,&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;euid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;501&lt;/span&gt;,&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;egid&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;20&lt;/span&gt;&lt;span class="o"&gt;)]&lt;/span&gt;
&amp;lt;&lt;span class="w"&gt; &lt;/span&gt;...&lt;span class="w"&gt; &lt;/span&gt;and&lt;span class="w"&gt; &lt;/span&gt;repeat&lt;span class="w"&gt; &lt;/span&gt;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;This pretty clearly indicates that the &lt;a href="https://github.com/sieren/QSyncthingTray"&gt;QSyncthingTray&lt;/a&gt; application (a tray icon to monitor
&lt;a href="https://syncthing.net/"&gt;Syncthing&lt;/a&gt;) was periodically requesting WiFi scans which, in turn, caused the bursts of latency.
After quitting the application and running &lt;code&gt;ping&lt;/code&gt; again, the times were all &amp;lt;2ms, even after running
for a few minutes. Also, when I started up the game again to test it, the lag was completely gone!&lt;/p&gt;
&lt;h2&gt;Digging deeper&lt;/h2&gt;
&lt;p&gt;Since QSyncthingTray is open source, I filed a &lt;a href="https://github.com/sieren/QSyncthingTray/issues/237"&gt;bug report&lt;/a&gt; on the project and dug into the code
to see if I could pinpoint the issue. After finding nothing out of the ordinary and doing a bunch of
searching the internet, it turns out that it's not an issue with QSyncthingTray at all, but with
&lt;a href="https://www.qt.io"&gt;Qt&lt;/a&gt;, a cross-platform SDK that QSyncthingTray and many other programs use. Some classmates and I
actually used it to make a game called &lt;a href="https://github.com/pR0Ps/ParticleStorm"&gt;ParticleStorm&lt;/a&gt; back in university.&lt;/p&gt;
&lt;p&gt;There are open bug reports against this issue from &lt;a href="https://bugreports.qt.io/browse/QTBUG-34641"&gt;2013&lt;/a&gt;, &lt;a href="https://bugreports.qt.io/browse/QTBUG-40332"&gt;2014&lt;/a&gt;, and &lt;a href="https://bugreports.qt.io/browse/QTBUG-46015"&gt;2015&lt;/a&gt;. Additionally,
there are loads of &lt;a href="https://lostdomain.org/2017/06/17/qt-qnetworkaccessmanager-causing-latency-spikes-on-wifi/"&gt;blog&lt;/a&gt; &lt;a href="https://justus.berlin/2016/04/reducing-cpu-load-and-energy-consumption-of-texstudio-on-the-mac/"&gt;posts&lt;/a&gt; and &lt;a href="https://github.com/qbittorrent/qBittorrent/commit/c2b6e1ce1aa402b143d0154748c518a87bc6424a"&gt;per&lt;/a&gt;-&lt;a href="https://github.com/sqlitebrowser/sqlitebrowser/commit/73946400c32d1f7cfcd4672ab0ab3f563eb84f4e"&gt;program&lt;/a&gt; &lt;a href="https://github.com/KDE/krita/commit/19ba224692a52b1d5799fda308bed4b02ff38f7a"&gt;workarounds&lt;/a&gt;. It's a little
disappointing that just running a network-enabled Qt application can seriously disrupt real-time
applications on the same system. Granted, I have no knowledge of the complexities of this issue, but
at the very least it seems &lt;a href="https://doc.qt.io/qt-5/qnetworkconfigurationmanager.html"&gt;the documentation&lt;/a&gt; could be clearer on the issue so developers stop
&lt;a href="https://www.reddit.com/r/krita/comments/9xea9b/this_is_gonna_sound_crazy_but_is_krita/e9tfify/"&gt;getting surprised by it&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Anyway, the "fix" is to set &lt;code&gt;QT_BEARER_POLL_TIMEOUT=-1&lt;/code&gt; as an environment variable on your system.
Honestly, I've just stopped using QSyncthingTray instead. Not that it's not useful, I just realized
that I didn't really need it. Syncthing works well enough that I don't find myself ever worrying
about it. If a Qt application ever becomes an essential part of my setup I guess I'll have to
revisit this.&lt;/p&gt;
&lt;h2&gt;Takeaways&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;When macOS scans for networks (as it does when requested by an application, when you click the WiFi
   icon, or when you request your location) it causes high ping times and dropped packets. According to
   bug reports, scanning for WiFi networks on other OS's causes the same issues. This is something I
   didn't really expect, but good to know going forward.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Qt has a bug where instantiating a &lt;code&gt;QNetworkConfigurationManager&lt;/code&gt; causes it to scan for WiFi
   networks every 10 seconds by default. Some applications set the &lt;code&gt;QT_BEARER_POLL_TIMEOUT&lt;/code&gt; environment
   variable themselves to disable this behaviour, but the majority probably have no idea that it's even
   an issue until a user reports it.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;So if you're seeing regular latency spikes, audit what programs you have running. Specifically look
for programs built with Qt. Setting the &lt;code&gt;QT_BEARER_POLL_TIMEOUT&lt;/code&gt; environment variable to &lt;code&gt;-1&lt;/code&gt; can
help with these. Applications that use your location &lt;a href="https://apple.stackexchange.com/questions/263638/macbook-pro-experiencing-ping-spikes-to-local-router/317431#317431"&gt;could also be the culprit&lt;/a&gt;. Who knew keeping
your ping down to an acceptable level was such a minefield...&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Tue, 22 Jan 2019 04:00:00 -0500</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2019-01-22:/blog/diagnosing-periodic-high-ping-times-on-macos.html</guid><category>blog</category><category>macOS</category><category>networking</category></item><item><title>Proxied access to the Namecheap DNS API</title><link>https://cmetcalfe.ca/blog/proxied-access-to-namecheap-dns.html</link><description>&lt;h2&gt;Background&lt;/h2&gt;
&lt;p&gt;Both this site and my home server use HTTPS certificates provided by &lt;a href="https://letsencrypt.org"&gt;Let's Encrypt&lt;/a&gt;.
&lt;a href="https://cmetcalfe.ca/blog/adding-https-support.html"&gt;Previously&lt;/a&gt; I was using the &lt;code&gt;http-01&lt;/code&gt; challenge method, but once &lt;a href="https://community.letsencrypt.org/t/acme-v2-and-wildcard-certificate-support-is-live/55579"&gt;wildcard
certificates became available&lt;/a&gt;, I decided to switch to the &lt;code&gt;dns-01&lt;/code&gt; method for simplicity.&lt;/p&gt;
&lt;p&gt;My domains are currently registered through &lt;a href="https://www.namecheap.com/"&gt;Namecheap&lt;/a&gt; which provides an API for modifying DNS
records. The only catch is that it can only be accessed via manually-whitelisted IP addresses.
Because the server I'm trying to access the API from is assigned a dynamic IP, this restriction was
a bit of an issue.&lt;/p&gt;
&lt;p&gt;Back in November when I initially made the switch to the DNS-based challenge, I set it up the easy
way: I manually added my current IP to the whitelist, added a TODO entry to fix it somehow, and set
a reminder scheduled for the week before the cert would expire telling me to update the IP
whitelist. Fast-forward to today when I was reminded to update my IP whitelist. Instead of
continuing to kick the can down the road, I decided to actually fix the issue.&lt;/p&gt;
&lt;h2&gt;Setting up a temporary proxy&lt;/h2&gt;
&lt;p&gt;My home server is connected to the internet though a normal residential connection which is assigned
a dynamic IP address. However, the server that I run this website on is configured with a static IP
since it's a hosted &lt;a href="https://en.wikipedia.org/wiki/Virtual_private_server"&gt;VPS&lt;/a&gt;. By proxying all traffic to the Namecheap API through my VPS, I could
add my VPS's static IP to the whitelist and not have to worry about my home IP changing all the
time.&lt;/p&gt;
&lt;p&gt;SSH is perfect tool for this. The &lt;a href="https://www.openssh.com/"&gt;OpenSSH client&lt;/a&gt; supports port forwarding using the &lt;code&gt;-D&lt;/code&gt; flag.
By then setting the &lt;code&gt;HTTP[S]_PROXY&lt;/code&gt; environment variables to point to the forwarded port, programs
that support those environment variables will transparently forward all their requests through the
proxy.&lt;/p&gt;
&lt;p&gt;After a bunch of research and testing, I came up with the following script to easily set up the
temporary proxy:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt; 1&lt;/span&gt;
&lt;span class="normal"&gt; 2&lt;/span&gt;
&lt;span class="normal"&gt; 3&lt;/span&gt;
&lt;span class="normal"&gt; 4&lt;/span&gt;
&lt;span class="normal"&gt; 5&lt;/span&gt;
&lt;span class="normal"&gt; 6&lt;/span&gt;
&lt;span class="normal"&gt; 7&lt;/span&gt;
&lt;span class="normal"&gt; 8&lt;/span&gt;
&lt;span class="normal"&gt; 9&lt;/span&gt;
&lt;span class="normal"&gt;10&lt;/span&gt;
&lt;span class="normal"&gt;11&lt;/span&gt;
&lt;span class="normal"&gt;12&lt;/span&gt;
&lt;span class="normal"&gt;13&lt;/span&gt;
&lt;span class="normal"&gt;14&lt;/span&gt;
&lt;span class="normal"&gt;15&lt;/span&gt;
&lt;span class="normal"&gt;16&lt;/span&gt;
&lt;span class="normal"&gt;17&lt;/span&gt;
&lt;span class="normal"&gt;18&lt;/span&gt;
&lt;span class="normal"&gt;19&lt;/span&gt;
&lt;span class="normal"&gt;20&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;
&lt;span class="c1"&gt;# Source this file to automatically setup and teardown an HTTP* proxy through cmetcalfe.ca&lt;/span&gt;
&lt;span class="c1"&gt;# Use the PROXY_PORT and PROXY_DEST environment variables to customize the proxy&lt;/span&gt;

&lt;span class="nv"&gt;PROXY_PORT&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;PROXY_PORT&lt;/span&gt;&lt;span class="k"&gt;:-&lt;/span&gt;&lt;span class="nv"&gt;11111&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;PROXY_DEST&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;PROXY_DEST&lt;/span&gt;&lt;span class="k"&gt;:-&lt;/span&gt;&lt;span class="p"&gt;&amp;lt;username&amp;gt;@cmetcalfe.ca&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="nv"&gt;PID&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$$&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;

&lt;span class="c1"&gt;# Teardown the SSH connection when the script exits&lt;/span&gt;
&lt;span class="nb"&gt;trap&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ssh -q -S &amp;quot;.ctrl-socket-$PID&amp;quot; -O exit &amp;quot;$PROXY_DEST&amp;quot;&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;EXIT

&lt;span class="c1"&gt;# Set up an SSH tunnel and wait for the port to be forwarded before continuing&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;!&lt;span class="w"&gt; &lt;/span&gt;ssh&lt;span class="w"&gt; &lt;/span&gt;-o&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ExitOnForwardFailure&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;yes&lt;span class="w"&gt; &lt;/span&gt;-M&lt;span class="w"&gt; &lt;/span&gt;-S&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;.ctrl-socket-&lt;/span&gt;&lt;span class="nv"&gt;$PID&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-f&lt;span class="w"&gt; &lt;/span&gt;-N&lt;span class="w"&gt; &lt;/span&gt;-D&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$PROXY_PORT&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$PROXY_DEST&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;then&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Failed to open SSH tunnel, exiting&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;exit&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;

&lt;span class="c1"&gt;# Set environment variables to redirect HTTP* traffic through the proxy&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;HTTP_PROXY&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;socks5://127.0.0.1:&lt;/span&gt;&lt;span class="nv"&gt;$PROXY_PORT&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;HTTPS_PROXY&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$HTTP_PROXY&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;This script is saved as &lt;code&gt;~/.config/tempproxy.rc&lt;/code&gt; and can be sourced to automatically set up a proxy
session and have it be torn down when the script exits.&lt;/p&gt;
&lt;p&gt;You'll want to use key-based authentication with an unencrypted private key so that you don't need
to type anything to initiate the SSH session. For this reason you'll probably want to create a
limited user on the target system that can only really do port forwarding. There's a good post on
this &lt;a href="https://askubuntu.com/questions/48129/how-to-create-a-restricted-ssh-user-for-port-forwarding/50000#50000"&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Talking to the API through the proxy&lt;/h2&gt;
&lt;p&gt;To allow programs that use the &lt;code&gt;tempproxy.rc&lt;/code&gt; script to talk to the Namecheap API, the IP address of
the VPS was added to the whitelist. Now that the proxying issue was taken care of, I just needed
to wire up the actual certificate renewal process to use it.&lt;/p&gt;
&lt;p&gt;The tool I'm using to talk to the Namecheap DNS API is &lt;a href="https://github.com/AnalogJ/lexicon"&gt;lexicon&lt;/a&gt;. It can handle manipulating the
DNS records of a ton of providers and integrates really nicely with my &lt;a href="https://en.wikipedia.org/wiki/Automated_Certificate_Management_Environment"&gt;ACME&lt;/a&gt; client of choice,
&lt;a href="https://github.com/lukas2511/dehydrated"&gt;dehydrated&lt;/a&gt;. Also, because it's using the &lt;a href="https://github.com/Bemmu/PyNamecheap"&gt;PyNamecheap&lt;/a&gt; Python library, which in turn uses
&lt;a href="http://python-requests.org"&gt;requests&lt;/a&gt; under the hood, it will &lt;a href="http://docs.python-requests.org/en/master/user/advanced/#proxies"&gt;automatically use the &lt;code&gt;HTTP*_PROXY&lt;/code&gt; environment
variables&lt;/a&gt; when making requests.&lt;/p&gt;
&lt;p&gt;The only tricky bit is that the base install of &lt;code&gt;lexicon&lt;/code&gt; won't automatically pull in the packages
required for accessing the Namecheap API. Likewise, &lt;code&gt;requests&lt;/code&gt; won't install packages to support
SOCKS proxies. To install all the required packages you'll need to run a command like:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;pip&lt;span class="w"&gt; &lt;/span&gt;install&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;requests[socks]&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;dns-lexicon[namecheap]&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Since lexicon can use environment variables as configuration, I created another small source-able
file at &lt;code&gt;~/.config/lexicon.rc&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;
&lt;span class="normal"&gt;5&lt;/span&gt;
&lt;span class="normal"&gt;6&lt;/span&gt;
&lt;span class="normal"&gt;7&lt;/span&gt;
&lt;span class="normal"&gt;8&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;
&lt;span class="c1"&gt;# Sets environment variables for accessing the Namecheap API&lt;/span&gt;

&lt;span class="c1"&gt;# Turn on API access and get an API token here:&lt;/span&gt;
&lt;span class="c1"&gt;# https://ap.www.namecheap.com/settings/tools/apiaccess/&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;PROVIDER&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;namecheap
&lt;span class="nb"&gt;export&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;LEXICON_NAMECHEAP_USERNAME&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&amp;lt;username&amp;gt;
&lt;span class="nb"&gt;export&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;LEXICON_NAMECHEAP_TOKEN&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&amp;lt;api&lt;span class="w"&gt; &lt;/span&gt;token&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;With that in place, the existing automation script that I had previously set up when I switched to
using the &lt;code&gt;dns-01&lt;/code&gt; challenge just needed some minor tweaks to source the two new files. I've
provided the script below, along with some other useful ones that use the DNS API.&lt;/p&gt;
&lt;h2&gt;Scripts&lt;/h2&gt;
&lt;h3&gt;&lt;code&gt;do-letsencrypt.sh&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;This is the main script that handles all the domain renewals. It's called via &lt;code&gt;cron&lt;/code&gt; on the first
of every month.&lt;/p&gt;
&lt;p&gt;Fun fact: The previous &lt;code&gt;http-01&lt;/code&gt; version of this script was a mess - it involved juggling &lt;code&gt;nginx&lt;/code&gt;
configurations with symlinks, manually opening up the &lt;code&gt;.well-known/acme-challenge&lt;/code&gt; endpoint, and
some other terrible hacks. This version is &lt;em&gt;much&lt;/em&gt; nicer.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt; 1&lt;/span&gt;
&lt;span class="normal"&gt; 2&lt;/span&gt;
&lt;span class="normal"&gt; 3&lt;/span&gt;
&lt;span class="normal"&gt; 4&lt;/span&gt;
&lt;span class="normal"&gt; 5&lt;/span&gt;
&lt;span class="normal"&gt; 6&lt;/span&gt;
&lt;span class="normal"&gt; 7&lt;/span&gt;
&lt;span class="normal"&gt; 8&lt;/span&gt;
&lt;span class="normal"&gt; 9&lt;/span&gt;
&lt;span class="normal"&gt;10&lt;/span&gt;
&lt;span class="normal"&gt;11&lt;/span&gt;
&lt;span class="normal"&gt;12&lt;/span&gt;
&lt;span class="normal"&gt;13&lt;/span&gt;
&lt;span class="normal"&gt;14&lt;/span&gt;
&lt;span class="normal"&gt;15&lt;/span&gt;
&lt;span class="normal"&gt;16&lt;/span&gt;
&lt;span class="normal"&gt;17&lt;/span&gt;
&lt;span class="normal"&gt;18&lt;/span&gt;
&lt;span class="normal"&gt;19&lt;/span&gt;
&lt;span class="normal"&gt;20&lt;/span&gt;
&lt;span class="normal"&gt;21&lt;/span&gt;
&lt;span class="normal"&gt;22&lt;/span&gt;
&lt;span class="normal"&gt;23&lt;/span&gt;
&lt;span class="normal"&gt;24&lt;/span&gt;
&lt;span class="normal"&gt;25&lt;/span&gt;
&lt;span class="normal"&gt;26&lt;/span&gt;
&lt;span class="normal"&gt;27&lt;/span&gt;
&lt;span class="normal"&gt;28&lt;/span&gt;
&lt;span class="normal"&gt;29&lt;/span&gt;
&lt;span class="normal"&gt;30&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;
&lt;span class="c1"&gt;# Generate/renew Let&amp;#39;s Encrypt certificates using dehydrated and lexicon&lt;/span&gt;

&lt;span class="nb"&gt;set&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-e

&lt;span class="c1"&gt;# Set configuration variables and setup the proxy&lt;/span&gt;
&lt;span class="nb"&gt;source&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;~/.config/lexicon.rc
&lt;span class="nb"&gt;source&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;~/.config/tempproxy.rc

&lt;span class="nb"&gt;cd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;/etc/nginx/ssl

&lt;span class="c1"&gt;# Update the certs.&lt;/span&gt;
&lt;span class="c1"&gt;# Hook script copied verbatim from&lt;/span&gt;
&lt;span class="c1"&gt;# https://github.com/AnalogJ/lexicon/blob/master/examples/dehydrated.default.sh&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;!&lt;span class="w"&gt; &lt;/span&gt;dehydrated&lt;span class="w"&gt; &lt;/span&gt;--accept-terms&lt;span class="w"&gt; &lt;/span&gt;--cron&lt;span class="w"&gt; &lt;/span&gt;--challenge&lt;span class="w"&gt; &lt;/span&gt;dns-01&lt;span class="w"&gt; &lt;/span&gt;--hook&lt;span class="w"&gt; &lt;/span&gt;dehydrated.default.sh&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;then&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Failed to renew certificates&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;exit&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;

&lt;span class="c1"&gt;# Reload the nginx config if it&amp;#39;s currently running&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;!&lt;span class="w"&gt; &lt;/span&gt;systemctl&lt;span class="w"&gt; &lt;/span&gt;is-active&lt;span class="w"&gt; &lt;/span&gt;nginx.service&lt;span class="w"&gt; &lt;/span&gt;&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;/dev/null&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;then&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;nginx isn&amp;#39;t running, not reloading it&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;exit&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;!&lt;span class="w"&gt; &lt;/span&gt;systemctl&lt;span class="w"&gt; &lt;/span&gt;reload&lt;span class="w"&gt; &lt;/span&gt;nginx.service&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;then&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;systemctl&lt;span class="w"&gt; &lt;/span&gt;status&lt;span class="w"&gt; &lt;/span&gt;nginx.service
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Failed to reload nginx config, check the error log&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;exit&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;h3&gt;&lt;code&gt;dns.sh&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;This one is really simple - it just augments the normal lexicon CLI interface with the proxy and
configuration variables.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;
&lt;span class="normal"&gt;5&lt;/span&gt;
&lt;span class="normal"&gt;6&lt;/span&gt;
&lt;span class="normal"&gt;7&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;
&lt;span class="c1"&gt;# A simple wrapper around lexicon.&lt;/span&gt;
&lt;span class="c1"&gt;# Sets up the proxy and configuration, then passes all the arguments to the configured provider&lt;/span&gt;

&lt;span class="nb"&gt;source&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;~/.config/lexicon.rc
&lt;span class="nb"&gt;source&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;~/.config/tempproxy.rc
lexicon&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$PROVIDER&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$@&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;
&lt;span class="normal"&gt;5&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$&lt;span class="w"&gt; &lt;/span&gt;./dns.sh&lt;span class="w"&gt; &lt;/span&gt;list&lt;span class="w"&gt; &lt;/span&gt;cmetcalfe.ca&lt;span class="w"&gt; &lt;/span&gt;A
ID&lt;span class="w"&gt;       &lt;/span&gt;TYPE&lt;span class="w"&gt; &lt;/span&gt;NAME&lt;span class="w"&gt;             &lt;/span&gt;CONTENT&lt;span class="w"&gt;         &lt;/span&gt;TTL
--------&lt;span class="w"&gt; &lt;/span&gt;----&lt;span class="w"&gt; &lt;/span&gt;----------------&lt;span class="w"&gt; &lt;/span&gt;---------------&lt;span class="w"&gt; &lt;/span&gt;----
xxxxxxxx&lt;span class="w"&gt; &lt;/span&gt;A&lt;span class="w"&gt;    &lt;/span&gt;@.cmetcalfe.ca&lt;span class="w"&gt;   &lt;/span&gt;xxx.xxx.xxx.xxx&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1800&lt;/span&gt;
xxxxxxxx&lt;span class="w"&gt; &lt;/span&gt;A&lt;span class="w"&gt;    &lt;/span&gt;www.cmetcalfe.ca&lt;span class="w"&gt; &lt;/span&gt;xxx.xxx.xxx.xxx&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1800&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;h3&gt;&lt;code&gt;dns-update.sh&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;An updated version of my &lt;a href="https://cmetcalfe.ca/blog/dynamic-dns-client-for-namecheap.html"&gt;previous script&lt;/a&gt; that uses the API instead of the
&lt;a href="https://www.namecheap.com/support/knowledgebase/article.aspx/29/11/how-do-i-use-a-browser-to-dynamically-update-the-hosts-ip"&gt;DynamicDNS service Namecheap provides&lt;/a&gt;. Called via &lt;code&gt;cron&lt;/code&gt; every 30 minutes.&lt;/p&gt;
&lt;div class="admonition update"&gt;
&lt;p class="admonition-title"&gt;Update&lt;/p&gt;
&lt;p&gt;A previous version of this script didn't try to delete the DNS entry before setting the new one,
resulting in multiple IPs being set as the same &lt;code&gt;A&lt;/code&gt; record.&lt;/p&gt;
&lt;p&gt;This is because the &lt;a href="https://github.com/AnalogJ/lexicon/blob/1feca5ead36cbf85ad92676dc853045e2c646097/lexicon/providers/namecheap.py#L233"&gt;update function of the Namecheap plugin for lexicon&lt;/a&gt; is implemented as a
2-step delete and add. When it tries to delete the old record, it looks for one with the same
content as the old one. This means that if you update a record with a new IP, it doesn't find
the old record to delete first, leaving you with all of your old IPs set as individual A
records.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt; 1&lt;/span&gt;
&lt;span class="normal"&gt; 2&lt;/span&gt;
&lt;span class="normal"&gt; 3&lt;/span&gt;
&lt;span class="normal"&gt; 4&lt;/span&gt;
&lt;span class="normal"&gt; 5&lt;/span&gt;
&lt;span class="normal"&gt; 6&lt;/span&gt;
&lt;span class="normal"&gt; 7&lt;/span&gt;
&lt;span class="normal"&gt; 8&lt;/span&gt;
&lt;span class="normal"&gt; 9&lt;/span&gt;
&lt;span class="normal"&gt;10&lt;/span&gt;
&lt;span class="normal"&gt;11&lt;/span&gt;
&lt;span class="normal"&gt;12&lt;/span&gt;
&lt;span class="normal"&gt;13&lt;/span&gt;
&lt;span class="normal"&gt;14&lt;/span&gt;
&lt;span class="normal"&gt;15&lt;/span&gt;
&lt;span class="normal"&gt;16&lt;/span&gt;
&lt;span class="normal"&gt;17&lt;/span&gt;
&lt;span class="normal"&gt;18&lt;/span&gt;
&lt;span class="normal"&gt;19&lt;/span&gt;
&lt;span class="normal"&gt;20&lt;/span&gt;
&lt;span class="normal"&gt;21&lt;/span&gt;
&lt;span class="normal"&gt;22&lt;/span&gt;
&lt;span class="normal"&gt;23&lt;/span&gt;
&lt;span class="normal"&gt;24&lt;/span&gt;
&lt;span class="normal"&gt;25&lt;/span&gt;
&lt;span class="normal"&gt;26&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;
&lt;span class="c1"&gt;# Check the server&amp;#39;s current IP against the IP listed in its DNS entry.&lt;/span&gt;
&lt;span class="c1"&gt;# Set the current IP if they differ.&lt;/span&gt;

&lt;span class="nb"&gt;set&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-e

resolve&lt;span class="o"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nv"&gt;line&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;drill&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;@resolver1.opendns.com&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;/dev/null&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;sed&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/;;.*$/d;/^\s*$/d&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;grep&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$line&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;head&lt;span class="w"&gt; &lt;/span&gt;-1&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;cut&lt;span class="w"&gt; &lt;/span&gt;-f5
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="nv"&gt;dns&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;resolve&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;subdomain&amp;gt;.cmetcalfe.ca&lt;span class="k"&gt;)&lt;/span&gt;
&lt;span class="nv"&gt;curr&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;resolve&lt;span class="w"&gt; &lt;/span&gt;myip.opendns.com&lt;span class="k"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$dns&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;!&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$curr&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;then&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;source&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;~/.config/lexicon.rc
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;source&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;~/.config/tempproxy.rc
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;!&lt;span class="w"&gt; &lt;/span&gt;lexicon&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$PROVIDER&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;delete&lt;span class="w"&gt; &lt;/span&gt;cmetcalfe.ca&lt;span class="w"&gt; &lt;/span&gt;A&lt;span class="w"&gt; &lt;/span&gt;--name&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;lt;subdomain&amp;gt;.cmetcalfe.ca&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;then&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Failed to delete old DNS record, not setting the new one.&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nb"&gt;exit&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;lexicon&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$PROVIDER&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;update&lt;span class="w"&gt; &lt;/span&gt;cmetcalfe.ca&lt;span class="w"&gt; &lt;/span&gt;A&lt;span class="w"&gt; &lt;/span&gt;--name&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;lt;subdomain&amp;gt;.cmetcalfe.ca&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;--content&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$curr&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;--ttl&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;900&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;then&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Server DNS record updated (&lt;/span&gt;&lt;span class="nv"&gt;$dns&lt;/span&gt;&lt;span class="s2"&gt; -&amp;gt; &lt;/span&gt;&lt;span class="nv"&gt;$curr&lt;/span&gt;&lt;span class="s2"&gt;)&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Server DNS record update FAILED (tried &lt;/span&gt;&lt;span class="nv"&gt;$dns&lt;/span&gt;&lt;span class="s2"&gt; -&amp;gt; &lt;/span&gt;&lt;span class="nv"&gt;$curr&lt;/span&gt;&lt;span class="s2"&gt;)&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Sun, 20 Jan 2019 06:15:00 -0500</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2019-01-20:/blog/proxied-access-to-namecheap-dns.html</guid><category>blog</category><category>code</category><category>shell script</category><category>website</category><category>automation</category><category>let's encrypt</category><category>homelab</category></item><item><title>Reducing Chromecast Idle Bandwidth</title><link>https://cmetcalfe.ca/blog/reducing-chromecast-idle-bandwidth.html</link><description>&lt;p&gt;Google's &lt;a href="https://store.google.com/product/chromecast"&gt;Chromecast&lt;/a&gt; is a pretty useful device. It plugs into the HDMI port of a TV and allows
users to "cast" content to it via a smartphone, &lt;a href="https://www.google.com/chrome/"&gt;Chrome browser&lt;/a&gt;, etc. This content is mostly
assumed to be streaming services like &lt;a href="https://www.youtube.com/"&gt;Youtube&lt;/a&gt;, &lt;a href="https://www.spotify.com/"&gt;Spotify&lt;/a&gt;, or &lt;a href="https://www.netflix.com/"&gt;Netflix&lt;/a&gt;, but for someone who
doesn't really buy into the whole cloud revolution like myself, it's still perfectly capable of
playing local content as well.&lt;/p&gt;
&lt;p&gt;The one downside of the Chromecast is that when it's not being used, instead of going into a
low-power state and/or turning off the TV, it instead enters &lt;a href="https://support.google.com/chromecast/answer/6080931"&gt;Ambient Mode&lt;/a&gt;. This shows some
useful information overlaid on a changing backdrop of featured photos downloaded from &lt;a href="https://photos.google.com/"&gt;Google
Photos&lt;/a&gt;. The issue with this is that the images are high-resolution, not cached, and are
continually being downloaded 24/7 even when the TV is turned off. Although I haven't personally
measured it, the general consensus seems to be that it uses around 15GB of data per month from just
being plugged in.&lt;/p&gt;
&lt;p&gt;What I'll be going over here is reducing the data the Chromecast uses by configuring it to only
download some tiny black 1x1 px images to use as a backdrop.&lt;/p&gt;
&lt;h2&gt;The short version&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Make a tiny black PNG (&lt;a href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAAAAAA6fptVAAAACklEQVQIHWNgAAAAAgABz8g15QAAAABJRU5ErkJggg=="&gt;pixel.png&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;Make a slightly different tiny PNG to avoid deduplication (&lt;a href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAAAAAA6fptVAAAACklEQVQIW2NgAAAAAgABYkBPaAAAAABJRU5ErkJggg=="&gt;pixel_alt1.png&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;Upload both to an album in Google Photos&lt;/li&gt;
&lt;li&gt;Mark both images as favorites&lt;/li&gt;
&lt;li&gt;Configure the Chromecast to only pull images from your specific album every 10 minutes&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If you like details, keep reading...&lt;/p&gt;
&lt;h2&gt;Making a small image&lt;/h2&gt;
&lt;p&gt;I ended up creating a 1x1 solid black image in GIMP, saving it as a PNG, hacking out as much data as
possible using a hex editor, then using &lt;a href="https://pmt.sourceforge.io/pngcrush/"&gt;&lt;code&gt;pngcrush&lt;/code&gt;&lt;/a&gt; to attempt to optimize the data
that was left.&lt;/p&gt;
&lt;p&gt;As I was working on the PNG file, I used a small script based on the Python &lt;a href="https://construct.readthedocs.io/en/latest/"&gt;construct&lt;/a&gt; library to
visualize the chunks and structure of it so I could figure out what to cut.&lt;/p&gt;
&lt;p&gt;To install &lt;code&gt;construct&lt;/code&gt; and download the example PNG specification:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;python3&lt;span class="w"&gt; &lt;/span&gt;-m&lt;span class="w"&gt; &lt;/span&gt;venv&lt;span class="w"&gt; &lt;/span&gt;.venv
&lt;span class="nb"&gt;source&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;.venv/bin/activate
pip&lt;span class="w"&gt; &lt;/span&gt;install&lt;span class="w"&gt; &lt;/span&gt;construct
wget&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;https://raw.githubusercontent.com/construct/construct/abd48c4892ceddc60c11d25f4a955573e2c61111/deprecated_gallery/png.py&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Create &lt;code&gt;pngview.py&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;
&lt;span class="normal"&gt;5&lt;/span&gt;
&lt;span class="normal"&gt;6&lt;/span&gt;
&lt;span class="normal"&gt;7&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;png&lt;/span&gt;  &lt;span class="c1"&gt;# the png spec downloaded above&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;

&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;argv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;rb&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;read&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Size:&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;bytes&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;png&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;png_file&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Running it on the PNG exported from GIMP using the default settings gives:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt; 1&lt;/span&gt;
&lt;span class="normal"&gt; 2&lt;/span&gt;
&lt;span class="normal"&gt; 3&lt;/span&gt;
&lt;span class="normal"&gt; 4&lt;/span&gt;
&lt;span class="normal"&gt; 5&lt;/span&gt;
&lt;span class="normal"&gt; 6&lt;/span&gt;
&lt;span class="normal"&gt; 7&lt;/span&gt;
&lt;span class="normal"&gt; 8&lt;/span&gt;
&lt;span class="normal"&gt; 9&lt;/span&gt;
&lt;span class="normal"&gt;10&lt;/span&gt;
&lt;span class="normal"&gt;11&lt;/span&gt;
&lt;span class="normal"&gt;12&lt;/span&gt;
&lt;span class="normal"&gt;13&lt;/span&gt;
&lt;span class="normal"&gt;14&lt;/span&gt;
&lt;span class="normal"&gt;15&lt;/span&gt;
&lt;span class="normal"&gt;16&lt;/span&gt;
&lt;span class="normal"&gt;17&lt;/span&gt;
&lt;span class="normal"&gt;18&lt;/span&gt;
&lt;span class="normal"&gt;19&lt;/span&gt;
&lt;span class="normal"&gt;20&lt;/span&gt;
&lt;span class="normal"&gt;21&lt;/span&gt;
&lt;span class="normal"&gt;22&lt;/span&gt;
&lt;span class="normal"&gt;23&lt;/span&gt;
&lt;span class="normal"&gt;24&lt;/span&gt;
&lt;span class="normal"&gt;25&lt;/span&gt;
&lt;span class="normal"&gt;26&lt;/span&gt;
&lt;span class="normal"&gt;27&lt;/span&gt;
&lt;span class="normal"&gt;28&lt;/span&gt;
&lt;span class="normal"&gt;29&lt;/span&gt;
&lt;span class="normal"&gt;30&lt;/span&gt;
&lt;span class="normal"&gt;31&lt;/span&gt;
&lt;span class="normal"&gt;32&lt;/span&gt;
&lt;span class="normal"&gt;33&lt;/span&gt;
&lt;span class="normal"&gt;34&lt;/span&gt;
&lt;span class="normal"&gt;35&lt;/span&gt;
&lt;span class="normal"&gt;36&lt;/span&gt;
&lt;span class="normal"&gt;37&lt;/span&gt;
&lt;span class="normal"&gt;38&lt;/span&gt;
&lt;span class="normal"&gt;39&lt;/span&gt;
&lt;span class="normal"&gt;40&lt;/span&gt;
&lt;span class="normal"&gt;41&lt;/span&gt;
&lt;span class="normal"&gt;42&lt;/span&gt;
&lt;span class="normal"&gt;43&lt;/span&gt;
&lt;span class="normal"&gt;44&lt;/span&gt;
&lt;span class="normal"&gt;45&lt;/span&gt;
&lt;span class="normal"&gt;46&lt;/span&gt;
&lt;span class="normal"&gt;47&lt;/span&gt;
&lt;span class="normal"&gt;48&lt;/span&gt;
&lt;span class="normal"&gt;49&lt;/span&gt;
&lt;span class="normal"&gt;50&lt;/span&gt;
&lt;span class="normal"&gt;51&lt;/span&gt;
&lt;span class="normal"&gt;52&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$&lt;span class="w"&gt; &lt;/span&gt;./pngview.py&lt;span class="w"&gt; &lt;/span&gt;pixel.png
Size:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;146&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes
Container:&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nv"&gt;signature&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;b&lt;span class="s1"&gt;&amp;#39;\x89PNG\r\n\x1a\n&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;total&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;8&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nv"&gt;image_header&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;Container:&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;length&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;13&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;signature&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;b&lt;span class="s1"&gt;&amp;#39;IHDR&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;total&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;width&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;height&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;bit_depth&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;8&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;color_type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;enum&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;truecolor&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;compression_method&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;enum&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;deflate&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;filter_method&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;enum&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;adaptive5&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;interlace_method&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;enum&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;none&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;crc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2423739358&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nv"&gt;chunks&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;ListContainer:&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;Container:&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;length&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;9&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;b&lt;span class="s1"&gt;&amp;#39;pHYs&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;total&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;Container:&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="nv"&gt;pixels_per_unit_x&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;11811&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="nv"&gt;pixels_per_unit_y&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;11811&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="nv"&gt;unit&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;enum&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;meter&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;crc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2024095606&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;Container:&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;length&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;7&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;b&lt;span class="s1"&gt;&amp;#39;tIME&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;total&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;Container:&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="nv"&gt;year&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2018&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="nv"&gt;month&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;12&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="nv"&gt;day&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;11&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="nv"&gt;hour&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;5&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="nv"&gt;minute&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="nv"&gt;second&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;19&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;crc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;904567710&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;Container:&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;length&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;25&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;b&lt;span class="s1"&gt;&amp;#39;tEXt&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;total&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;Container:&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="nv"&gt;keyword&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;u&lt;span class="s1"&gt;&amp;#39;Comment&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;total&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;7&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="nv"&gt;text&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;b&lt;span class="s1"&gt;&amp;#39;Created with GIM&amp;#39;&lt;/span&gt;...&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;truncated,&lt;span class="w"&gt; &lt;/span&gt;total&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;17&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;crc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1468075543&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;Container:&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;length&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;12&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;b&lt;span class="s1"&gt;&amp;#39;IDAT&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;total&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;b&lt;span class="s1"&gt;&amp;#39;\x08\xd7c```\x00\x00\x00\x04\x00\x01&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;total&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;12&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;crc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;657729290&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;Container:&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;length&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;b&lt;span class="s1"&gt;&amp;#39;IEND&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;total&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;None
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;crc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2923585666&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;After removing the unneeded &lt;code&gt;pHYs&lt;/code&gt;, &lt;code&gt;tIME&lt;/code&gt;, and &lt;code&gt;tEXt&lt;/code&gt; chunks using a hex editor, it looks like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt; 1&lt;/span&gt;
&lt;span class="normal"&gt; 2&lt;/span&gt;
&lt;span class="normal"&gt; 3&lt;/span&gt;
&lt;span class="normal"&gt; 4&lt;/span&gt;
&lt;span class="normal"&gt; 5&lt;/span&gt;
&lt;span class="normal"&gt; 6&lt;/span&gt;
&lt;span class="normal"&gt; 7&lt;/span&gt;
&lt;span class="normal"&gt; 8&lt;/span&gt;
&lt;span class="normal"&gt; 9&lt;/span&gt;
&lt;span class="normal"&gt;10&lt;/span&gt;
&lt;span class="normal"&gt;11&lt;/span&gt;
&lt;span class="normal"&gt;12&lt;/span&gt;
&lt;span class="normal"&gt;13&lt;/span&gt;
&lt;span class="normal"&gt;14&lt;/span&gt;
&lt;span class="normal"&gt;15&lt;/span&gt;
&lt;span class="normal"&gt;16&lt;/span&gt;
&lt;span class="normal"&gt;17&lt;/span&gt;
&lt;span class="normal"&gt;18&lt;/span&gt;
&lt;span class="normal"&gt;19&lt;/span&gt;
&lt;span class="normal"&gt;20&lt;/span&gt;
&lt;span class="normal"&gt;21&lt;/span&gt;
&lt;span class="normal"&gt;22&lt;/span&gt;
&lt;span class="normal"&gt;23&lt;/span&gt;
&lt;span class="normal"&gt;24&lt;/span&gt;
&lt;span class="normal"&gt;25&lt;/span&gt;
&lt;span class="normal"&gt;26&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$&lt;span class="w"&gt; &lt;/span&gt;./pngview.py&lt;span class="w"&gt; &lt;/span&gt;pixel.png&lt;span class="w"&gt; &lt;/span&gt;
Size:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;69&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes
Container:&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nv"&gt;signature&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;b&lt;span class="s1"&gt;&amp;#39;\x89PNG\r\n\x1a\n&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;total&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;8&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nv"&gt;image_header&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;Container:&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;length&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;13&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;signature&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;b&lt;span class="s1"&gt;&amp;#39;IHDR&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;total&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;width&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;height&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;bit_depth&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;8&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;color_type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;enum&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;truecolor&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;compression_method&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;enum&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;deflate&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;filter_method&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;enum&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;adaptive5&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;interlace_method&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;enum&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;none&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;crc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2423739358&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nv"&gt;chunks&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;ListContainer:&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;Container:&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;length&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;12&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;b&lt;span class="s1"&gt;&amp;#39;IDAT&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;total&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;b&lt;span class="s1"&gt;&amp;#39;\x08\xd7c```\x00\x00\x00\x04\x00\x01&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;total&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;12&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;crc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;657729290&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;Container:&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;length&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;b&lt;span class="s1"&gt;&amp;#39;IEND&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;total&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;None
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;crc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2923585666&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;At this point, all that's left to optimize is the image data itself. This is where &lt;code&gt;pngcrush&lt;/code&gt;
shines. After running &lt;code&gt;pngcrush -brute -ow pixel.png&lt;/code&gt; we see:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt; 1&lt;/span&gt;
&lt;span class="normal"&gt; 2&lt;/span&gt;
&lt;span class="normal"&gt; 3&lt;/span&gt;
&lt;span class="normal"&gt; 4&lt;/span&gt;
&lt;span class="normal"&gt; 5&lt;/span&gt;
&lt;span class="normal"&gt; 6&lt;/span&gt;
&lt;span class="normal"&gt; 7&lt;/span&gt;
&lt;span class="normal"&gt; 8&lt;/span&gt;
&lt;span class="normal"&gt; 9&lt;/span&gt;
&lt;span class="normal"&gt;10&lt;/span&gt;
&lt;span class="normal"&gt;11&lt;/span&gt;
&lt;span class="normal"&gt;12&lt;/span&gt;
&lt;span class="normal"&gt;13&lt;/span&gt;
&lt;span class="normal"&gt;14&lt;/span&gt;
&lt;span class="normal"&gt;15&lt;/span&gt;
&lt;span class="normal"&gt;16&lt;/span&gt;
&lt;span class="normal"&gt;17&lt;/span&gt;
&lt;span class="normal"&gt;18&lt;/span&gt;
&lt;span class="normal"&gt;19&lt;/span&gt;
&lt;span class="normal"&gt;20&lt;/span&gt;
&lt;span class="normal"&gt;21&lt;/span&gt;
&lt;span class="normal"&gt;22&lt;/span&gt;
&lt;span class="normal"&gt;23&lt;/span&gt;
&lt;span class="normal"&gt;24&lt;/span&gt;
&lt;span class="normal"&gt;25&lt;/span&gt;
&lt;span class="normal"&gt;26&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$&lt;span class="w"&gt; &lt;/span&gt;./pngview.py&lt;span class="w"&gt; &lt;/span&gt;pixel.png
Size:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;67&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes
Container:&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nv"&gt;signature&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;b&lt;span class="s1"&gt;&amp;#39;\x89PNG\r\n\x1a\n&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;total&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;8&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nv"&gt;image_header&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;Container:&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;length&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;13&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;signature&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;b&lt;span class="s1"&gt;&amp;#39;IHDR&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;total&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;width&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;height&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;bit_depth&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;8&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;color_type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;enum&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;greyscale&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;compression_method&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;enum&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;deflate&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;filter_method&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;enum&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;adaptive5&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;interlace_method&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;enum&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;none&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;crc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;981375829&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nv"&gt;chunks&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;ListContainer:&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;Container:&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;length&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;b&lt;span class="s1"&gt;&amp;#39;IDAT&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;total&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;b&lt;span class="s1"&gt;&amp;#39;\x08\x1dc`\x00\x00\x00\x02\x00\x01&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;total&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;crc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;3486004709&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;Container:&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;length&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;b&lt;span class="s1"&gt;&amp;#39;IEND&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;total&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;4&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;None
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nv"&gt;crc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2923585666&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;The 2 byte savings in the data seem to have come from setting the &lt;code&gt;color_type&lt;/code&gt; to &lt;code&gt;greyscale&lt;/code&gt;
instead of &lt;code&gt;truecolor&lt;/code&gt;. To view what actually changed in the data, we can un-&lt;code&gt;deflate&lt;/code&gt; it using Python:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;
&lt;span class="normal"&gt;5&lt;/span&gt;
&lt;span class="normal"&gt;6&lt;/span&gt;
&lt;span class="normal"&gt;7&lt;/span&gt;
&lt;span class="normal"&gt;8&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;zlib&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="c1"&gt;# before pngcrush (12 bytes)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;zlib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decompress&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\x08\xd7&lt;/span&gt;&lt;span class="s1"&gt;c```&lt;/span&gt;&lt;span class="se"&gt;\x00\x00\x00\x04\x00\x01&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\x00\x00\x00\x00&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="c1"&gt;# after pngcrush (10 bytes)&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;zlib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decompress&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\x08\x1d&lt;/span&gt;&lt;span class="s1"&gt;c`&lt;/span&gt;&lt;span class="se"&gt;\x00\x00\x00\x02\x00\x01&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\x00\x00&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;This makes sense since, according to the &lt;a href="https://www.w3.org/TR/PNG/"&gt;PNG spec&lt;/a&gt;, when using &lt;code&gt;truecolor&lt;/code&gt;, each pixel is an RGB
triple, requiring 3 bytes. For &lt;code&gt;greyscale&lt;/code&gt;, only a single byte representing luminance is needed. The
first byte is the filtering method, which isn't relevant here since we only have a single pixel.&lt;/p&gt;
&lt;p&gt;Interestingly enough, in both cases we would actually be much better off if we could opt to &lt;strong&gt;not&lt;/strong&gt; use
compression, but alas, the spec does not allow for anything except &lt;code&gt;deflate&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;But I digress, we now have a black 1x1 px PNG image that's just 67 bytes (&lt;a href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAAAAAA6fptVAAAACklEQVQIHWNgAAAAAgABz8g15QAAAABJRU5ErkJggg=="&gt;pixel.png&lt;/a&gt;).&lt;/p&gt;
&lt;h2&gt;Generating multiple unique small images&lt;/h2&gt;
&lt;p&gt;So now we have the small PNG we want to display. Since the Chromecast's ambient mode requires at
least 2 different images in an album to cycle through, all we need to to do is upload 2 copies
of this PNG and we're done right? Almost.&lt;/p&gt;
&lt;p&gt;Since Google Photos will automatically deduplicate uploaded images, we need to find a way to make
the second image slightly different. Normally this would involve tweaking a comment or something,
but in this case, the image has already been stripped down to its bare essentials.&lt;/p&gt;
&lt;p&gt;My strategy was attempt to abuse the data compression to see if I could generate an image that
compressed the same data into the same number of bytes, but differently. Fortunately, &lt;code&gt;pngcrush&lt;/code&gt; can
be told to use specific compression strategies (there are currently 177 of them). My hope is that at
least one of these will achieve the same results, but in a different way. For starters we'll try the
first 9:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;x&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;seq&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;9&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;do&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;pngcrush&lt;span class="w"&gt; &lt;/span&gt;-m&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$x&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;pixel.png&lt;span class="w"&gt; &lt;/span&gt;pixel_alt&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;x&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;.png&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;done&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;A quick &lt;code&gt;ls -l&lt;/code&gt; reveals that all of the &lt;code&gt;pixel_alt*.png&lt;/code&gt; files are still 67 bytes. Now we just need
to find one that has different data. &lt;code&gt;sha1sum&lt;/code&gt; is the perfect utility for this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt; 1&lt;/span&gt;
&lt;span class="normal"&gt; 2&lt;/span&gt;
&lt;span class="normal"&gt; 3&lt;/span&gt;
&lt;span class="normal"&gt; 4&lt;/span&gt;
&lt;span class="normal"&gt; 5&lt;/span&gt;
&lt;span class="normal"&gt; 6&lt;/span&gt;
&lt;span class="normal"&gt; 7&lt;/span&gt;
&lt;span class="normal"&gt; 8&lt;/span&gt;
&lt;span class="normal"&gt; 9&lt;/span&gt;
&lt;span class="normal"&gt;10&lt;/span&gt;
&lt;span class="normal"&gt;11&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$&lt;span class="w"&gt; &lt;/span&gt;sha1sum&lt;span class="w"&gt; &lt;/span&gt;pixel.png&lt;span class="w"&gt; &lt;/span&gt;pixel_alt*.png
d99a9d63b1cd9e4b3f823d4d03144ccd95328f48&lt;span class="w"&gt;  &lt;/span&gt;pixel.png
7487dcce2b2bb81a442faf139b0a547bf070d5e2&lt;span class="w"&gt;  &lt;/span&gt;pixel_alt1.png
7487dcce2b2bb81a442faf139b0a547bf070d5e2&lt;span class="w"&gt;  &lt;/span&gt;pixel_alt2.png
7487dcce2b2bb81a442faf139b0a547bf070d5e2&lt;span class="w"&gt;  &lt;/span&gt;pixel_alt3.png
c3ea09bfcfcb36ce22d3f19eacada359f3984ed1&lt;span class="w"&gt;  &lt;/span&gt;pixel_alt4.png
c3ea09bfcfcb36ce22d3f19eacada359f3984ed1&lt;span class="w"&gt;  &lt;/span&gt;pixel_alt5.png
c3ea09bfcfcb36ce22d3f19eacada359f3984ed1&lt;span class="w"&gt;  &lt;/span&gt;pixel_alt6.png
c3ea09bfcfcb36ce22d3f19eacada359f3984ed1&lt;span class="w"&gt;  &lt;/span&gt;pixel_alt7.png
c3ea09bfcfcb36ce22d3f19eacada359f3984ed1&lt;span class="w"&gt;  &lt;/span&gt;pixel_alt8.png
d99a9d63b1cd9e4b3f823d4d03144ccd95328f48&lt;span class="w"&gt;  &lt;/span&gt;pixel_alt9.png
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;pixel_alt1.png&lt;/code&gt; looks like a good candidate, let's see what changed:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;
&lt;span class="normal"&gt;5&lt;/span&gt;
&lt;span class="normal"&gt;6&lt;/span&gt;
&lt;span class="normal"&gt;7&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$&lt;span class="w"&gt; &lt;/span&gt;diff&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;&lt;span class="o"&gt;(&lt;/span&gt;./pngview.py&lt;span class="w"&gt; &lt;/span&gt;pixel.png&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;&lt;span class="o"&gt;(&lt;/span&gt;./pngview.py&lt;span class="w"&gt; &lt;/span&gt;pixel_alt1.png&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="m"&gt;20&lt;/span&gt;,21c20,21
&amp;lt;&lt;span class="w"&gt;             &lt;/span&gt;&lt;span class="nv"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;b&lt;span class="s1"&gt;&amp;#39;\x08\x1dc`\x00\x00\x00\x02\x00\x01&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;total&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&amp;lt;&lt;span class="w"&gt;             &lt;/span&gt;&lt;span class="nv"&gt;crc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;3486004709&lt;/span&gt;
---
&amp;gt;&lt;span class="w"&gt;             &lt;/span&gt;&lt;span class="nv"&gt;data&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;b&lt;span class="s1"&gt;&amp;#39;\x08[c`\x00\x00\x00\x02\x00\x01&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;total&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&amp;gt;&lt;span class="w"&gt;             &lt;/span&gt;&lt;span class="nv"&gt;crc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1648381800&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;There's the same amount of data, but it's different. Let's check if it decompresses to the same
image data:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;
&lt;span class="normal"&gt;5&lt;/span&gt;
&lt;span class="normal"&gt;6&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;zlib&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;zlib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decompress&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\x08\x1d&lt;/span&gt;&lt;span class="s1"&gt;c`&lt;/span&gt;&lt;span class="se"&gt;\x00\x00\x00\x02\x00\x01&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\x00\x00&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;zlib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decompress&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\x08&lt;/span&gt;&lt;span class="s1"&gt;[c`&lt;/span&gt;&lt;span class="se"&gt;\x00\x00\x00\x02\x00\x01&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\x00\x00&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Yep, this means that &lt;a href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAAAAAA6fptVAAAACklEQVQIW2NgAAAAAgABYkBPaAAAAABJRU5ErkJggg=="&gt;pixel_alt1.png&lt;/a&gt; is the exact same image with the exact same size, but won't
be deduplicated when uploading it to Google Photos since the compressed data is different.&lt;/p&gt;
&lt;h2&gt;Final touches&lt;/h2&gt;
&lt;p&gt;Now that we have 2 different tiny images, we can upload them to Google Photos and put them in an
album so they can be pulled down by the Chromecast. Something to note is that you may have to mark
the images as favorites to get them to be displayed. There seems to be some sort of AI-fueled "we
know better than you" algorithm that initially refused to display my images until I starred them.&lt;/p&gt;
&lt;p&gt;Now just set your ambient mode to display the album with your images in it (or your favorites
album), set the slideshow speed to its maximum value (change image every 10 mins), and you're done.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Mon, 10 Dec 2018 22:50:00 -0500</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2018-12-10:/blog/reducing-chromecast-idle-bandwidth.html</guid><category>blog</category><category>chromecast</category><category>png</category></item><item><title>Recovering data off a bootlooping Nexus 5</title><link>https://cmetcalfe.ca/blog/recovering-data-off-a-bootlooping-nexus5.html</link><description>&lt;h2&gt;The situation&lt;/h2&gt;
&lt;p&gt;The &lt;a href="https://en.wikipedia.org/wiki/Nexus_5"&gt;Nexus 5&lt;/a&gt; that I've had for almost 5 years started bootlooping repeatedly.&lt;/p&gt;
&lt;p&gt;I've replaced/repaired multiple parts of it over the years but lately it had been more flaky than
usual. For example:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Sometimes when booting it would show a "Firmware update in progress, don't disconnect your
   computer" message, even though there was nothing connected to the USB port.&lt;/li&gt;
&lt;li&gt;It would randomly freeze and soft reboot when using it about once a week.&lt;/li&gt;
&lt;li&gt;When propping it up on a book or something to angle the screen towards me, the screen would
   sometimes turn off and on (as it turns out, this was a warning sign)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I've been ready to replace it for a while, but couldn't justify it while this one was perfectly (ok,
mostly) functional. That changed today when I tried to turn it on and it started bootlooping.&lt;/p&gt;
&lt;p&gt;So buy a new phone and move on, right? Right, except I committed the cardinal sin of living in the
digital age - not having complete backups. Yeah, yeah, I know.&lt;/p&gt;
&lt;p&gt;I got most of it. I'd been using &lt;a href="https://github.com/pR0Ps/freeotp-export"&gt;Syncthing&lt;/a&gt; to automatically back up photos, videos, and other
files to my home server every night so they were all good. The problem was that I had been using
&lt;a href="https://github.com/pR0Ps/freeotp-export"&gt;FreeOTP-export&lt;/a&gt; to back up my &lt;a href="https://en.wikipedia.org/wiki/Multi-factor_authentication"&gt;2FA&lt;/a&gt; secrets manually and the latest backup was missing a bunch
of logins.&lt;/p&gt;
&lt;p&gt;So I needed to somehow get into my non-booting phone and pull the data off it. At least because I
was replacing it, all destructive options were on the table.&lt;/p&gt;
&lt;h2&gt;Diagnosis&lt;/h2&gt;
&lt;p&gt;The first step was seeing if other people had this problem. Some searching revealed that it was most
likely the power button gone bad and being stuck in the pressed position.&lt;/p&gt;
&lt;p&gt;To confirm this, I rapidly hammered the power button on a hard surface while booting, hoping that
the jarring would un-stick it and let it boot. This sort of worked in that it would boot, but
stopping at any point would result it it powering off again. It was also extremely difficult to tap
it consistently enough to keep the phone on for long enough to pull any data off it.&lt;/p&gt;
&lt;p&gt;The issue I mentioned earlier where propping the phone up made the screen turn on and off now made sense.
I'm guessing this was causing a slight flexing of the power button switch, causing it to close and
trigger. Over time this must've permanently bent something so it stayed closed, causing the
bootloop.&lt;/p&gt;
&lt;p&gt;Now that I had pretty much confirmed that it was something physically wrong with the power button
circuitry, I messaged my friend &lt;a href="https://mremallin.ca/"&gt;Mike&lt;/a&gt;. When it comes to electronics, he's definitely more
experienced than me. Plus, he lets me borrow his tools :)&lt;/p&gt;
&lt;h2&gt;The "fix"&lt;/h2&gt;
&lt;p&gt;The next day Mike came over with his soldering iron and we started brainstorming.&lt;/p&gt;
&lt;p&gt;The plan of attack was to just take the power button off the board entirely. It can't always be
pressed down if it's not on the board right?&lt;/p&gt;
&lt;p&gt;In preparation for this, I wanted the phone to automatically boot when it was plugged into a charger
so I wouldn't have to manually short the pins on the board. Fortunately this can be done with a
fastboot command: &lt;code&gt;fastboot oem off-mode-charge 0&lt;/code&gt; (basically: don't allow charging while off,
therefore turn on when charging).&lt;/p&gt;
&lt;p&gt;After desoldering the power button from the main board, it was still bootlooping. Not good. I went
back and cleaned up the solder to make absolutely sure that the power button signal pins weren't
connected in any way. Still bootlooping when powered on. It would get to the bootloader and stay
there, meaning the power button wasn't being pressed anymore, but when launching to either recovery
or the main OS, it would immediately restart.&lt;/p&gt;
&lt;p&gt;Looked into dumping data from the bootloader - impossible.&lt;/p&gt;
&lt;p&gt;Reflashed the boot and recovery partitions - same thing.&lt;/p&gt;
&lt;p&gt;Tried booting into recovery using &lt;code&gt;fastboot boot &amp;lt;recovery-image&amp;gt;&lt;/code&gt; - bootloop.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;sounds like it's time to cry&lt;/p&gt;
&lt;p&gt;-- Someone on &lt;a href="https://webchat.freenode.net/?channels=#lineageos-dev"&gt;Freenode's #lineageos-dev channel&lt;/a&gt; after I explained the situation&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Thankfully, it was not. Right after that, someone else asked if I had reconnected the battery. I had
not.&lt;/p&gt;
&lt;p&gt;Turns out that a working battery is required to boot the phone, even when it's plugged in. I had
taken the battery out to desolder the power button and never put it back in since the phone seemed
to boot fine without it. Whoops.&lt;/p&gt;
&lt;p&gt;After plugging the battery into the board and booting the phone, it launched the main OS without any
issues. Huge relief.&lt;/p&gt;
&lt;h2&gt;Recovering the data&lt;/h2&gt;
&lt;p&gt;With the phone booted up normally I used &lt;code&gt;adb&lt;/code&gt; (running as root) to pull the 2FA codes and
other important things that I knew I needed over to my laptop.&lt;/p&gt;
&lt;p&gt;I really don't trust myself to remember everything so I booted the phone into recovery mode and
pulled a complete backup of &lt;code&gt;/data/data&lt;/code&gt;, &lt;code&gt;/data/app&lt;/code&gt;, and &lt;code&gt;/storage/sdcard&lt;/code&gt; (&lt;a href="https://developer.android.com/guide/topics/data/data-storage.html#filesExternal"&gt;not actually an
sdcard&lt;/a&gt;) to my laptop as well.&lt;/p&gt;
&lt;p&gt;To make &lt;strong&gt;absolutely&lt;/strong&gt; sure I didn't miss anything, I also pulled a raw image of the entire flash
memory (disk-based encryption was not enabled) using &lt;code&gt;adb pull /dev/block/mmcblk0 mmcblk0.img&lt;/code&gt;.
Everything I need should be in the normal backups, but if not, I can always go spelunking through
that image.&lt;/p&gt;
&lt;h2&gt;Lessons learned&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;If it's important, back it up &lt;em&gt;automatically&lt;/em&gt;. If it's not automatic, at some point it will be
   missed.&lt;/li&gt;
&lt;li&gt;Make sure you have the ability to get root access on every device you own before you need it - in
   this case I wouldn't've been able to pull the 2FA codes or do full backups without it.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Future plans&lt;/h2&gt;
&lt;p&gt;For the Nexus 5, I'm planning on either buying a replacement power button or maybe just soldering
some wires to the exposed pads and snaking them out of the phone to an external button if I can't
find one. The phone can then continue to be used as an app development testbed, a &lt;a href="https://store.google.com/product/chromecast"&gt;Chromecast&lt;/a&gt;
remote, or as a &lt;a href="https://cmetcalfe.ca/blog/adding-xbox360-controller-support-to-a-nexus5.html"&gt;basic emulation console&lt;/a&gt; until it dies for real. In theory I could keep using it
as a phone too, but at this point I just don't trust it enough.&lt;/p&gt;
&lt;p&gt;For my next phone, I've decided on the &lt;a href="https://en.wikipedia.org/wiki/Sony_Xperia_XZ1_Compact"&gt;Xperia XZ1 Compact&lt;/a&gt;. It's a smaller phone that's mostly
waterproof (&lt;a href="https://en.wikipedia.org/wiki/IP_Code"&gt;IP68&lt;/a&gt;), has a fast SoC (&lt;a href="https://en.wikipedia.org/wiki/List_of_Qualcomm_Snapdragon_systems-on-chip#Snapdragon_835_and_845_(2017/18)"&gt;Snapdragon 835&lt;/a&gt;), a headphone jack, SD card support, and
great battery life. I have high hopes for it. Also, as evidenced by this post, having root access to
the OS is pretty critical at times so I'll be flashing &lt;a href="https://lineageos.org/"&gt;LineageOS&lt;/a&gt; on it ASAP.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Tue, 18 Sep 2018 18:30:00 -0400</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2018-09-18:/blog/recovering-data-off-a-bootlooping-nexus5.html</guid><category>blog</category><category>android</category><category>data recovery</category><category>electronics</category><category>hardware</category></item><item><title>Password recovery from an Alcatel-Lucent Cellpipe 7130</title><link>https://cmetcalfe.ca/blog/password-recorvery-from-cellpipe-7130.html</link><description>&lt;h2&gt;Background&lt;/h2&gt;
&lt;p&gt;In my current rental situation, the landlord provides internet included with the rental. Since it's
fast enough and has enough bandwidth this isn't an issue at all. The only problem is that the modem
provided by the telco is an ancient &lt;code&gt;Alcatel-Lucent Cellpipe 7130 5VzA2001&lt;/code&gt; modem/router combo. It's
running firmware version &lt;code&gt;1.0.4.4R8-wh&lt;/code&gt;, released on 2012-05-08 16:30 (there are no updates, I
checked).&lt;/p&gt;
&lt;p&gt;Since the Cellpipe only has 4 x 10/100 LAN ports and terrible WiFi performance, I would much prefer
to use my own equipment to perform the routing and just use the Cellpipe 7130 as a WAN gateway.
Unfortunately, for some reason, there is no way to turn off the routing aspect of the Cellpipe and
just use it as a modem (aka bridge mode). There is also no way to turn off &lt;a href="https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol"&gt;DHCP&lt;/a&gt; functionality on
it.&lt;/p&gt;
&lt;p&gt;My current hacky solution to these problems is to let my router get an IP from the modem/router via
DHCP, then set that IP as the DMZ host on the Cellpipe. This effectively forwards all TCP and UDP
ports to the router, making it seem like it's the boundary device for the network. Luckily, my
router always seems to request the same IP no matter what so this continues to work even if both
devices are power cycled.&lt;/p&gt;
&lt;p&gt;Since this is not an ideal situation, I'd like to replace the Cellpipe with a more performant modem
without any of the routing overhead. To do this, I just need to port the configuration details from
the Cellpipe (like the username and password for the upstream &lt;a href="https://en.wikipedia.org/wiki/Point-to-Point_Protocol_over_Ethernet"&gt;PPPoE&lt;/a&gt; connection) over to a new
modem. Unfortunately, there's nothing in the web interface that will allow me to see the password
and there's no option to do a configuration backup. I also can't just call up the telco since it's
the landlord's account.&lt;/p&gt;
&lt;p&gt;This means we're stuck, right?&lt;/p&gt;
&lt;h2&gt;Digging into the Cellpipe&lt;/h2&gt;
&lt;p&gt;Doing a quick &lt;a href="https://en.wikipedia.org/wiki/Common_Vulnerabilities_and_Exposures"&gt;CVE&lt;/a&gt; search for the Cellpipe only turns up &lt;a href="https://www.cvedetails.com/cve/CVE-2015-4586"&gt;CVE-2015-4586&lt;/a&gt; (a &lt;a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery"&gt;CSRF&lt;/a&gt;
vulnerability) and &lt;a href="https://www.cvedetails.com/cve/CVE-2015-4587"&gt;CVE-2015-4587&lt;/a&gt; (an &lt;a href="https://en.wikipedia.org/wiki/Cross-site_scripting"&gt;XSS&lt;/a&gt; vulnerability), both of which aren't useful in this
case. Oh well.&lt;/p&gt;
&lt;p&gt;Seeing as the &lt;a href="https://infoproducts.alcatel-lucent.com/cgi-bin/dbaccessfilename.cgi/401389004_V1_CellPipe"&gt;Cellpipe 7130 manual&lt;/a&gt;(PDF) mentions various functionality that my device
doesn't seem have, my hypothesis is that there might be a configuration backup/restore function
somewhere, just not exposed in the UI. With that in mind, I went trawling through the HTML and
JavaScript files the web UI served up. I found:&lt;/p&gt;
&lt;p&gt;The color 'red' is commented out and redefined as white. This suggests that they could be hiding
error messages by just making them the same color as the background:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;//var red    =&amp;#39;#FF0000&amp;#39;;&lt;/span&gt;
&lt;span class="kd"&gt;var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;red&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;#FFFFFF&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Debugging in production builds with commented out &lt;code&gt;alert&lt;/code&gt; statements:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;//alert(isRouter);&lt;/span&gt;
&lt;span class="c1"&gt;//alert(isAPmode);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Various comments indicating lack of source control:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;
&lt;span class="normal"&gt;5&lt;/span&gt;
&lt;span class="normal"&gt;6&lt;/span&gt;
&lt;span class="normal"&gt;7&lt;/span&gt;
&lt;span class="normal"&gt;8&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;//Jamie hide 20111109&lt;/span&gt;
&lt;span class="cm"&gt;/*if(menuItem==&amp;#39;HPNA&amp;#39;)&lt;/span&gt;
&lt;span class="cm"&gt;{&lt;/span&gt;
&lt;span class="cm"&gt;    printMenuItem(&amp;#39;hpna.html&amp;#39;, &amp;#39;HPNA&amp;#39;, white, darkBlue);&lt;/span&gt;
&lt;span class="cm"&gt;}else{&lt;/span&gt;
&lt;span class="cm"&gt;    printMenuItem(&amp;#39;hpna.html&amp;#39;, &amp;#39;HPNA&amp;#39;, black, blue);&lt;/span&gt;
&lt;span class="cm"&gt;}&lt;/span&gt;
&lt;span class="cm"&gt;*/&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;//fanny add 2011/02/22&lt;/span&gt;
&lt;span class="nx"&gt;printMenuItem&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;wifi_statistics.html&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;WLAN Statistics &amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;black&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;white&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;
&lt;span class="normal"&gt;5&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="cm"&gt;&amp;lt;!-- jonathan 2004.04.07    Begin  --&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;form&lt;/span&gt; &lt;span class="na"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;logoutForm&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;method&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;post&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;input&lt;/span&gt; &lt;span class="na"&gt;type&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;hidden&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;logoutMsg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;form&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="cm"&gt;&amp;lt;!-- jonathan 2004.04.07    End  --&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;These all seem to allude to shoddy release processes, meaning that it's highly likely that
per-model customizations were rushed UI-level hack jobs on top of the current release and not
maintained branches where actual functionality was changed.&lt;/p&gt;
&lt;p&gt;Since a configuration backup will include the PPPoE username and password, let's do a search for
"config". Sure enough:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;
&lt;span class="normal"&gt;5&lt;/span&gt;
&lt;span class="normal"&gt;6&lt;/span&gt;
&lt;span class="normal"&gt;7&lt;/span&gt;
&lt;span class="normal"&gt;8&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nx"&gt;printMenuSection&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;util_main.html&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Utilities&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;white&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="nx"&gt;printMenuItem&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;lang_set.html&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Language Setting&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;black&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nx"&gt;white&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="nx"&gt;printMenuItem&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;util_reboot.html&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Reboot Gateway&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;black&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nx"&gt;white&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="c1"&gt;//printMenuItem(&amp;#39;util_reservice.html&amp;#39;, &amp;#39;Restart Service&amp;#39;, black,white);&lt;/span&gt;
&lt;span class="nx"&gt;printMenuItem&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;util_factory.html&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Restore Factory Defaults&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nx"&gt;black&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;white&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="hll"&gt;&lt;span class="c1"&gt;//printMenuItem(&amp;#39;util_cfgstore.html&amp;#39;, &amp;#39;Configuration Store&amp;#39;, black,white);&lt;/span&gt;
&lt;/span&gt;&lt;span class="hll"&gt;&lt;span class="c1"&gt;//printMenuItem(&amp;#39;util_cfgrestore.html&amp;#39;, &amp;#39;Configuration Restore&amp;#39;, black,white);&lt;/span&gt;
&lt;/span&gt;&lt;span class="nx"&gt;printMenuItem&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;util_webfirmware.html&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Web Firmware Upload&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;black&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nx"&gt;white&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="c1"&gt;//Jamie add back 20111109&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Visiting &lt;code&gt;http://&amp;lt;router_ip&amp;gt;/util_cfgstore.html&lt;/code&gt; shows a nice "Store" button that downloads a text
file containing 771(!) key/value pairs, including the username and password for the PPPoE connection.
Success!&lt;/p&gt;
&lt;h2&gt;Future plans&lt;/h2&gt;
&lt;p&gt;There are a ton of other options in the downloaded config file, some of which look like they enable
bridge mode. However, flipping those settings on and applying the new config using
&lt;code&gt;http://&amp;lt;router_ip&amp;gt;/util_cfgrestore.html&lt;/code&gt; didn't seem to change anything. I'm going to keep messing
with it while I look into sourcing a better modem to use my newfound credentials with.&lt;/p&gt;
&lt;p&gt;Longer-term, the plan is to transition to a dedicated modem that provides WAN access to a low-power
computer running &lt;a href="https://www.pfsense.org/"&gt;pfSense&lt;/a&gt; that handles firewall and routing duties. From there, an unmanaged
switch (possibly injecting &lt;a href="https://en.wikipedia.org/wiki/Power_over_Ethernet"&gt;PoE&lt;/a&gt;) can provide access for enough dumb wireless APs to bathe the
house in WiFi, as well as wired hookups for the devices that don't move around too much or need the
throughput. For now though, I'll settle for replacing the modem.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Tue, 11 Sep 2018 22:30:00 -0400</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2018-09-11:/blog/password-recorvery-from-cellpipe-7130.html</guid><category>blog</category><category>security</category></item><item><title>Forwarding spam with Gmail</title><link>https://cmetcalfe.ca/blog/forwarding-spam-with-gmail.html</link><description>&lt;p&gt;With multiple Gmail accounts, it's often easier to forward all emails to a single main account that
you actually check. This can be accomplished by setting up a forwarding account in Gmail's settings.&lt;/p&gt;
&lt;p&gt;However, something that isn't immediately obvious is that messages that are considered spam are
never forwarded. While Gmail's spam detection is extremely good, it's not perfect. There have been
times where emails that I actually wanted have ended up in the spam folder and weren't forwarded to
my main account.&lt;/p&gt;
&lt;p&gt;To fix this, we want to tell Gmail to not flag anything as spam so it will be forwarded along.&lt;/p&gt;
&lt;div class="admonition note"&gt;
&lt;p class="admonition-title"&gt;Note&lt;/p&gt;
&lt;p&gt;This will &lt;strong&gt;not&lt;/strong&gt; cause spam to appear in your inbox. It bypasses the spam filters so the email
is forwarded properly, but the account it's forwarded to will &lt;em&gt;also&lt;/em&gt; flag the email as spam. The
end result is that that the email will end up in the spam folder of your main account (where you
can actually look at it) instead of not being forwarded from the original account at all.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;We can do this with a filter that matches &lt;code&gt;is:spam&lt;/code&gt; and applies the option "Never send it to Spam".
Unfortunately, Gmail's interface makes this task much harder than it needs to be.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Open Gmail and do a search for &lt;code&gt;is:spam&lt;/code&gt;. Notice that Gmail autocorrects it to &lt;code&gt;in:spam&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Click the dropdown arrow on the right side of the search box to bring down the advanced options
   and click "Create filter with this search". Hit "OK" on the warning box that pops up. Notice that
   the filter has been autocorrected &lt;em&gt;again&lt;/em&gt; to &lt;code&gt;label:spam&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;In the URL you should see something like &lt;code&gt;#create-filter/has=label%3Aspam&lt;/code&gt;. Change &lt;code&gt;label&lt;/code&gt; to
   &lt;code&gt;is&lt;/code&gt; in the URL and hit enter. It should modify the text in the box without changing anything
   else.&lt;/li&gt;
&lt;li&gt;Check the "Never send it to Spam" checkbox and hit "Create filter". You'll see the text get
   autocorrected to &lt;code&gt;in:spam&lt;/code&gt; again, but if you check in Settings -&amp;gt; Filters and Blocked Addresses
   you should see the correct &lt;code&gt;is:spam&lt;/code&gt; filter.&lt;/li&gt;
&lt;/ol&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Mon, 03 Jul 2017 15:15:00 -0400</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2017-07-03:/blog/forwarding-spam-with-gmail.html</guid><category>blog</category><category>email</category></item><item><title>Bank of Canada currency conversion rates in the terminal</title><link>https://cmetcalfe.ca/blog/bank-of-canada-conversion-rates-terminal.html</link><description>&lt;h1&gt;Preface&lt;/h1&gt;
&lt;p&gt;In this entry I'll use two command line tools (&lt;a href="https://curl.haxx.se/"&gt;&lt;code&gt;curl&lt;/code&gt;&lt;/a&gt; and &lt;a href="https://stedolan.github.io/jq/"&gt;&lt;code&gt;jq&lt;/code&gt;&lt;/a&gt;) to request currency
conversion rates from the &lt;a href="https://www.bankofcanada.ca"&gt;Bank of Canada&lt;/a&gt;. Now obviously getting the same data through the &lt;a href="https://www.bankofcanada.ca/rates/exchange/daily-exchange-rates-lookup/"&gt;normal
web interface&lt;/a&gt; is possible as well. However, doing it this way returns the data in a
machine-readable form, allowing it to be customized or used as input into other programs.&lt;/p&gt;
&lt;p&gt;The basic flow will be request the data using &lt;code&gt;curl&lt;/code&gt;, then pipe it to &lt;code&gt;jq&lt;/code&gt; for processing.&lt;/p&gt;
&lt;div class="admonition note"&gt;
&lt;p class="admonition-title"&gt;Note&lt;/p&gt;
&lt;p&gt;This article will request the USD/CAD exchange rate from 2017-01-01 to 2017-01-10. It should be
fairly obvious how to switch this for any other currencies or date ranges. See the
&lt;a href="#appendix"&gt;Appendix&lt;/a&gt; for more information and caveats with the dates and the conversion codes.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;We'll go from seeing the raw data the server returns to something that we can more easily use. &lt;strong&gt;To
skip to the final result, click &lt;a href="#tldr"&gt;here&lt;/a&gt;&lt;/strong&gt;.&lt;/p&gt;
&lt;div class="admonition update"&gt;
&lt;p class="admonition-title"&gt;Update&lt;/p&gt;
&lt;p&gt;The URLs for the data were originally reverse-engineered from the website. They have since been
turned into a supported API. See &lt;a href="https://www.bankofcanada.ca/valet/docs"&gt;the API documentation&lt;/a&gt; for more details.&lt;/p&gt;
&lt;/div&gt;
&lt;h1&gt;Lets go!&lt;/h1&gt;
&lt;p&gt;Hitting the server without any processing will give the following result:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;curl&lt;span class="w"&gt; &lt;/span&gt;-s&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;https://www.bankofcanada.ca/valet/observations/FXUSDCAD/json?start_date=2017-01-01&amp;amp;end_date=2017-01-10&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt; 1&lt;/span&gt;
&lt;span class="normal"&gt; 2&lt;/span&gt;
&lt;span class="normal"&gt; 3&lt;/span&gt;
&lt;span class="normal"&gt; 4&lt;/span&gt;
&lt;span class="normal"&gt; 5&lt;/span&gt;
&lt;span class="normal"&gt; 6&lt;/span&gt;
&lt;span class="normal"&gt; 7&lt;/span&gt;
&lt;span class="normal"&gt; 8&lt;/span&gt;
&lt;span class="normal"&gt; 9&lt;/span&gt;
&lt;span class="normal"&gt;10&lt;/span&gt;
&lt;span class="normal"&gt;11&lt;/span&gt;
&lt;span class="normal"&gt;12&lt;/span&gt;
&lt;span class="normal"&gt;13&lt;/span&gt;
&lt;span class="normal"&gt;14&lt;/span&gt;
&lt;span class="normal"&gt;15&lt;/span&gt;
&lt;span class="normal"&gt;16&lt;/span&gt;
&lt;span class="normal"&gt;17&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="nt"&gt;&amp;quot;terms&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:{&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;url&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;http://www.bankofcanada.ca/terms/&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="nt"&gt;&amp;quot;seriesDetail&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:{&lt;/span&gt;
&lt;span class="nt"&gt;&amp;quot;FXUSDCAD&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:{&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;label&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;USD/CAD&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;description&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;US dollar to Canadian dollar daily exchange rate&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="nt"&gt;&amp;quot;observations&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:[&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;d&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;2017-01-02&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;FXUSDCAD&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:{&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;e&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;-64&lt;/span&gt;&lt;span class="p"&gt;}},&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;d&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;2017-01-03&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;FXUSDCAD&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:{&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;v&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;1.3435&lt;/span&gt;&lt;span class="p"&gt;}},&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;d&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;2017-01-04&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;FXUSDCAD&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:{&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;v&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;1.3315&lt;/span&gt;&lt;span class="p"&gt;}},&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;d&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;2017-01-05&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;FXUSDCAD&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:{&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;v&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;1.3244&lt;/span&gt;&lt;span class="p"&gt;}},&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;d&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;2017-01-06&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;FXUSDCAD&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:{&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;v&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;1.3214&lt;/span&gt;&lt;span class="p"&gt;}},&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;d&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;2017-01-09&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;FXUSDCAD&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:{&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;v&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;1.3240&lt;/span&gt;&lt;span class="p"&gt;}},&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;d&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;2017-01-10&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;FXUSDCAD&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:{&lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;v&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;1.3213&lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;
&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;To get the information we want, we need to iterate over the elements in the &lt;code&gt;observations&lt;/code&gt; list and
map the date (&lt;code&gt;d&lt;/code&gt;) to the conversion rate (&lt;code&gt;FXUSDCAD.v&lt;/code&gt;). Since this will create a list of
single-element dictionaries, we'll also need to "add" (merge) them together.&lt;/p&gt;
&lt;p&gt;To do this with &lt;code&gt;jq&lt;/code&gt;, it looks like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;curl&lt;span class="w"&gt; &lt;/span&gt;-s&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;https://www.bankofcanada.ca/valet/observations/FXUSDCAD/json?start_date=2017-01-01&amp;amp;end_date=2017-01-10&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
jq&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;    [.observations[] | {(.d) : .FXUSDCAD.v}] | add&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;
&lt;span class="normal"&gt;5&lt;/span&gt;
&lt;span class="normal"&gt;6&lt;/span&gt;
&lt;span class="normal"&gt;7&lt;/span&gt;
&lt;span class="normal"&gt;8&lt;/span&gt;
&lt;span class="normal"&gt;9&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;2017-01-02&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;2017-01-03&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1.3435&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;2017-01-04&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1.3315&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;2017-01-05&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1.3244&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;2017-01-06&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1.3214&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;2017-01-09&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1.324&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;2017-01-10&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1.3213&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;That first &lt;code&gt;null&lt;/code&gt; entry where there was no data is going to cause problems later, so let's just
delete it using the &lt;code&gt;del&lt;/code&gt; function:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;curl&lt;span class="w"&gt; &lt;/span&gt;-s&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;https://www.bankofcanada.ca/valet/observations/FXUSDCAD/json?start_date=2017-01-01&amp;amp;end_date=2017-01-10&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
jq&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;    [.observations[] | {(.d) : .FXUSDCAD.v}] | add | del(.[] | nulls)&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;
&lt;span class="normal"&gt;5&lt;/span&gt;
&lt;span class="normal"&gt;6&lt;/span&gt;
&lt;span class="normal"&gt;7&lt;/span&gt;
&lt;span class="normal"&gt;8&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;2017-01-03&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1.3435&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;2017-01-04&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1.3315&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;2017-01-05&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1.3244&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;2017-01-06&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1.3214&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;2017-01-09&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1.324&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;2017-01-10&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1.3213&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Now this may be good enough for most purposes, but it would be useful to compute some other
statistics from this data. For example, we want to know the average exchange rate for the date
range. Now that we have the data in an easy to use format, computing an average with &lt;code&gt;jq&lt;/code&gt; is just a
matter of passing the values to an &lt;code&gt;add / length&lt;/code&gt; filter. For example:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;curl&lt;span class="w"&gt; &lt;/span&gt;-s&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;https://www.bankofcanada.ca/valet/observations/FXUSDCAD/json?start_date=2017-01-01&amp;amp;end_date=2017-01-10&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
jq&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;    [.observations[] | {(.d) : .FXUSDCAD.v}] | add | del(.[] | nulls) | add / length&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="mf"&gt;1.327683333333333&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;&lt;a name="tldr"&gt;&lt;/a&gt;We can now construct an object that has both the average, as well as all the
data. Putting it all together we get:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;
&lt;span class="normal"&gt;5&lt;/span&gt;
&lt;span class="normal"&gt;6&lt;/span&gt;
&lt;span class="normal"&gt;7&lt;/span&gt;
&lt;span class="normal"&gt;8&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;curl&lt;span class="w"&gt; &lt;/span&gt;-s&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;https://www.bankofcanada.ca/valet/observations/FXUSDCAD/json?start_date=2017-01-01&amp;amp;end_date=2017-01-10&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
jq&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;    [.observations[] | {(.d) : .FXUSDCAD.v}] | add | del(.[] | nulls) |&lt;/span&gt;
&lt;span class="s1"&gt;    {&lt;/span&gt;
&lt;span class="s1"&gt;        &amp;quot;average&amp;quot;: (add / length),&lt;/span&gt;
&lt;span class="s1"&gt;        &amp;quot;values&amp;quot;: .&lt;/span&gt;
&lt;span class="s1"&gt;    }&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt; 1&lt;/span&gt;
&lt;span class="normal"&gt; 2&lt;/span&gt;
&lt;span class="normal"&gt; 3&lt;/span&gt;
&lt;span class="normal"&gt; 4&lt;/span&gt;
&lt;span class="normal"&gt; 5&lt;/span&gt;
&lt;span class="normal"&gt; 6&lt;/span&gt;
&lt;span class="normal"&gt; 7&lt;/span&gt;
&lt;span class="normal"&gt; 8&lt;/span&gt;
&lt;span class="normal"&gt; 9&lt;/span&gt;
&lt;span class="normal"&gt;10&lt;/span&gt;
&lt;span class="normal"&gt;11&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;average&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1.327683333333333&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;values&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;2017-01-03&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1.3435&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;2017-01-04&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1.3315&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;2017-01-05&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1.3244&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;2017-01-06&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1.3214&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;2017-01-09&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1.324&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;2017-01-10&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1.3213&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;And that's it! Hopefully you found this useful, if not for it's stated purpose of retrieving
exchange rates, then at least for getting more familiar with &lt;code&gt;jq&lt;/code&gt;. It's pretty much the best tool
out there when it comes to manipulating JSON on the command line.&lt;/p&gt;
&lt;h1&gt;Appendix&lt;a name="appendix"&gt;&lt;/a&gt;&lt;/h1&gt;
&lt;h3&gt;Date ranges&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;The server will only ever return data from &lt;code&gt;2017-01-03&lt;/code&gt; and onwards. If the start range is before
  that, it doesn't return an error, it just doesn't return any data for those dates.&lt;/li&gt;
&lt;li&gt;If the end date isn't specified, the server assumes the current date.&lt;/li&gt;
&lt;li&gt;There doesn't seem to be any limit on the amount of data retrieved&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Currency codes&lt;/h3&gt;
&lt;p&gt;A list of codes can be easily scraped from the lookup page. The command and its result are below for
reference.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;curl&lt;span class="w"&gt; &lt;/span&gt;-s&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;https://www.bankofcanada.ca/rates/exchange/daily-exchange-rates-lookup/&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;grep&lt;span class="w"&gt; &lt;/span&gt;-Eo&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;quot;FX......&amp;quot;.*&amp;lt;&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt; 1&lt;/span&gt;
&lt;span class="normal"&gt; 2&lt;/span&gt;
&lt;span class="normal"&gt; 3&lt;/span&gt;
&lt;span class="normal"&gt; 4&lt;/span&gt;
&lt;span class="normal"&gt; 5&lt;/span&gt;
&lt;span class="normal"&gt; 6&lt;/span&gt;
&lt;span class="normal"&gt; 7&lt;/span&gt;
&lt;span class="normal"&gt; 8&lt;/span&gt;
&lt;span class="normal"&gt; 9&lt;/span&gt;
&lt;span class="normal"&gt;10&lt;/span&gt;
&lt;span class="normal"&gt;11&lt;/span&gt;
&lt;span class="normal"&gt;12&lt;/span&gt;
&lt;span class="normal"&gt;13&lt;/span&gt;
&lt;span class="normal"&gt;14&lt;/span&gt;
&lt;span class="normal"&gt;15&lt;/span&gt;
&lt;span class="normal"&gt;16&lt;/span&gt;
&lt;span class="normal"&gt;17&lt;/span&gt;
&lt;span class="normal"&gt;18&lt;/span&gt;
&lt;span class="normal"&gt;19&lt;/span&gt;
&lt;span class="normal"&gt;20&lt;/span&gt;
&lt;span class="normal"&gt;21&lt;/span&gt;
&lt;span class="normal"&gt;22&lt;/span&gt;
&lt;span class="normal"&gt;23&lt;/span&gt;
&lt;span class="normal"&gt;24&lt;/span&gt;
&lt;span class="normal"&gt;25&lt;/span&gt;
&lt;span class="normal"&gt;26&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;quot;FXAUDCAD&amp;quot;&amp;gt;Australian dollar&amp;lt;
&amp;quot;FXBRLCAD&amp;quot;&amp;gt;Brazilian real&amp;lt;
&amp;quot;FXCNYCAD&amp;quot;&amp;gt;Chinese renminbi&amp;lt;
&amp;quot;FXEURCAD&amp;quot;&amp;gt;European euro&amp;lt;
&amp;quot;FXHKDCAD&amp;quot;&amp;gt;Hong Kong dollar&amp;lt;
&amp;quot;FXINRCAD&amp;quot;&amp;gt;Indian rupee&amp;lt;
&amp;quot;FXIDRCAD&amp;quot;&amp;gt;Indonesian rupiah&amp;lt;
&amp;quot;FXJPYCAD&amp;quot;&amp;gt;Japanese yen&amp;lt;
&amp;quot;FXMYRCAD&amp;quot;&amp;gt;Malaysian ringgit&amp;lt;
&amp;quot;FXMXNCAD&amp;quot;&amp;gt;Mexican peso&amp;lt;
&amp;quot;FXNZDCAD&amp;quot;&amp;gt;New Zealand dollar&amp;lt;
&amp;quot;FXNOKCAD&amp;quot;&amp;gt;Norwegian krone&amp;lt;
&amp;quot;FXPENCAD&amp;quot;&amp;gt;Peruvian new sol&amp;lt;
&amp;quot;FXRUBCAD&amp;quot;&amp;gt;Russian ruble&amp;lt;
&amp;quot;FXSARCAD&amp;quot;&amp;gt;Saudi riyal&amp;lt;
&amp;quot;FXSGDCAD&amp;quot;&amp;gt;Singapore dollar&amp;lt;
&amp;quot;FXZARCAD&amp;quot;&amp;gt;South African rand&amp;lt;
&amp;quot;FXKRWCAD&amp;quot;&amp;gt;South Korean won&amp;lt;
&amp;quot;FXSEKCAD&amp;quot;&amp;gt;Swedish krona&amp;lt;
&amp;quot;FXCHFCAD&amp;quot;&amp;gt;Swiss franc&amp;lt;
&amp;quot;FXTWDCAD&amp;quot;&amp;gt;Taiwanese dollar&amp;lt;
&amp;quot;FXTHBCAD&amp;quot;&amp;gt;Thai baht&amp;lt;
&amp;quot;FXTRYCAD&amp;quot;&amp;gt;Turkish lira&amp;lt;
&amp;quot;FXGBPCAD&amp;quot;&amp;gt;UK pound sterling&amp;lt;
&amp;quot;FXUSDCAD&amp;quot;&amp;gt;US dollar&amp;lt;
&amp;quot;FXVNDCAD&amp;quot;&amp;gt;Vietnamese dong&amp;lt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Sun, 02 Jul 2017 21:43:00 -0400</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2017-07-02:/blog/bank-of-canada-conversion-rates-terminal.html</guid><category>blog</category><category>website</category><category>shell script</category></item><item><title>Adding HTTPS support to this site</title><link>https://cmetcalfe.ca/blog/adding-https-support.html</link><description>&lt;p&gt;Yesterday I finally ticked something off my todo list that'd been on there for a while - I added
proper HTTPS support to this site, powered by &lt;a href="https://letsencrypt.org/"&gt;Let's Encrypt&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The Qualys SSL Labs &lt;a href="https://www.ssllabs.com/ssltest/index.html"&gt;SSL Server Test&lt;/a&gt; now gives this site &lt;a href="https://www.ssllabs.com/ssltest/analyze.html?d=cmetcalfe.ca"&gt;an A+ rating&lt;/a&gt;. You can see all the
certs (past and present) for it on &lt;a href="https://crt.sh/?q=cmetcalfe.ca"&gt;crt.sh&lt;/a&gt;, an online certificate search tool.&lt;/p&gt;
&lt;h3&gt;For those interested in how things work:&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://letsencrypt.org/"&gt;Let's Encrypt&lt;/a&gt; is a "free, automated, and open" certificate authority. They provide certificates
via an &lt;a href="https://letsencrypt.org/howitworks/technology/"&gt;automatable process&lt;/a&gt; that are valid for &lt;a href="https://letsencrypt.org/2015/11/09/why-90-days.html"&gt;90 days&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Exactly how I got it all working can be seen in my &lt;a href="https://github.com/pR0Ps/website"&gt;website repo&lt;/a&gt;, where this entire site and it's
deployment scripts are kept, but here's the gist of it:&lt;/p&gt;
&lt;p&gt;I decided to use &lt;a href="https://github.com/lukas2511/dehydrated"&gt;&lt;code&gt;dehydrated&lt;/code&gt;&lt;/a&gt; instead of the &lt;a href="https://github.com/letsencrypt/letsencrypt"&gt;official Let's Encrypt client&lt;/a&gt; to
generate the certificates. &lt;code&gt;dehydrated&lt;/code&gt; is ~1000 lines of &lt;code&gt;bash&lt;/code&gt; and only requires things like
&lt;code&gt;openssl&lt;/code&gt;, &lt;code&gt;curl&lt;/code&gt;, and a few other programs that any UNIX system should already have. It takes a
config file and a list of domains. Once those are in place running it from &lt;code&gt;cron&lt;/code&gt; is easy.&lt;/p&gt;
&lt;p&gt;The &lt;a href="https://github.com/letsencrypt/acme-spec"&gt;ACME protocol&lt;/a&gt; that Let's Encrypt uses to verify domain ownership requires the web server to
respond to certain requests. This check makes sure that only someone with control over the domain
can generate a cert for it. To allow those requests to return the files generated by &lt;code&gt;dehydrated&lt;/code&gt;,
a &lt;a href="https://github.com/pR0Ps/website/blob/8b3f9509e5f97522ac01789ca562409a7475cc60/web_config/https/letsencrypt.conf"&gt;location rule in the Nginx config&lt;/a&gt; was added.&lt;/p&gt;
&lt;p&gt;Initially there were problems with the first time generating certs. Since the certs didn't exist
yet, Nginx was failing to start (and therefore causing the domain validation to fail). The solution
was to make two sets of configs. An HTTP set, and an HTTPS set. During the renewal process, the HTTPS
configs are tried, and if running Nginx fails, it falls back to the HTTP set. Switching between HTTP
and HTTPS configs is done by modifying a symlink.&lt;/p&gt;
&lt;p&gt;When all set up, this makes both generating a cert for the first time and renewing a cert as easy as
deploying the site. For continual, automated renewals, a monthly &lt;code&gt;cron&lt;/code&gt; job was added. With the
expiry of certs being 90 days, this should be frequent enough that the certs should never expire.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Sat, 23 Jan 2016 10:00:00 -0500</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2016-01-23:/blog/adding-https-support.html</guid><category>blog</category><category>website</category><category>security</category><category>let's encrypt</category></item><item><title>YouTube subscriptions via RSS</title><link>https://cmetcalfe.ca/blog/youtube-subscriptions-via-rss.html</link><description>&lt;p&gt;The &lt;a href="https://support.google.com/youtube/answer/4489286"&gt;subscription feature&lt;/a&gt; on &lt;a href="https://www.youtube.com"&gt;Youtube&lt;/a&gt; allows you to keep up to date with content
that people upload to the site.&lt;/p&gt;
&lt;p&gt;Since I use an RSS reader for every other blog or site that I follow, why not do
the same for YouTube subscriptions?&lt;/p&gt;
&lt;div class="admonition update"&gt;
&lt;p class="admonition-title"&gt;Update&lt;/p&gt;
&lt;p&gt;This method no longer works. The YouTube v2 API (which is &lt;a href="https://developers.google.com/youtube/2.0/reference#Subscriptions_Feed"&gt;what this method
was using&lt;/a&gt;) was &lt;a href="http://youtube-eng.blogspot.ca/2014/03/committing-to-youtube-data-api-v3_4.html"&gt;retired on April 20th, 2015&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;To work around this, each channel must be subscribed to separately. See the
RSS reader section on &lt;a href="https://support.google.com/youtube/answer/6098135"&gt;this support page&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;The feed for anyone's subscribed videos is at the URL:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;http://gdata.youtube.com/feeds/base/users/&amp;lt;userID&amp;gt;/newsubscriptionvideos
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Where &lt;code&gt;&amp;lt;userID&amp;gt;&lt;/code&gt; is either your YouTube account name or the long string of
letters and numbers that can be found on the &lt;a href="https://www.youtube.com/account_advanced"&gt;YouTube advanced settings page&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Try it out, it makes watching episodic content a breeze!&lt;/p&gt;
&lt;div class="admonition warning"&gt;
&lt;p class="admonition-title"&gt;Warning&lt;/p&gt;
&lt;p&gt;You'll have to have "Keep all my subscriptions private" unchecked on the
&lt;a href="https://www.youtube.com/account_privacy"&gt;YouTube privacy settings page&lt;/a&gt; for this to work.&lt;/p&gt;
&lt;p&gt;This will allow anyone to access the RSS feed of your subscriptions at the
url above.&lt;/p&gt;
&lt;/div&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Wed, 04 Mar 2015 20:00:00 -0500</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2015-03-04:/blog/youtube-subscriptions-via-rss.html</guid><category>blog</category><category>sites</category></item><item><title>Dynamic DNS client for Namecheap using bash &amp; cron</title><link>https://cmetcalfe.ca/blog/dynamic-dns-client-for-namecheap.html</link><description>&lt;p&gt;In addition to running this website, I also run a home server. For convenience,
I point a subdomain of &lt;code&gt;cmetcalfe.ca&lt;/code&gt; at it so even though it's connected using
a dynamic IP (and actually seems to change fairly frequently), I can get access
to it from anywhere.&lt;/p&gt;
&lt;p&gt;As a bit of background, the domain for this website is registered and managed
through &lt;a href="http://namecheap.com"&gt;Namecheap&lt;/a&gt;. While they do provide a &lt;a href="https://www.namecheap.com/support/knowledgebase/article.aspx/28"&gt;recommended DDNS client&lt;/a&gt; for
keeping a domain's DNS updated, it only runs on Windows.&lt;/p&gt;
&lt;p&gt;Instead, after &lt;a href="https://www.namecheap.com/support/knowledgebase/article.aspx/595"&gt;enabling DDNS for the domain&lt;/a&gt; and reading &lt;a href="https://www.namecheap.com/support/knowledgebase/article.aspx/29"&gt;Namecheap's article
on using the browser to update DDNS&lt;/a&gt; I came up with the following &lt;code&gt;dns-update&lt;/code&gt;
script.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt; 1&lt;/span&gt;
&lt;span class="normal"&gt; 2&lt;/span&gt;
&lt;span class="normal"&gt; 3&lt;/span&gt;
&lt;span class="normal"&gt; 4&lt;/span&gt;
&lt;span class="normal"&gt; 5&lt;/span&gt;
&lt;span class="normal"&gt; 6&lt;/span&gt;
&lt;span class="normal"&gt; 7&lt;/span&gt;
&lt;span class="normal"&gt; 8&lt;/span&gt;
&lt;span class="normal"&gt; 9&lt;/span&gt;
&lt;span class="normal"&gt;10&lt;/span&gt;
&lt;span class="normal"&gt;11&lt;/span&gt;
&lt;span class="normal"&gt;12&lt;/span&gt;
&lt;span class="normal"&gt;13&lt;/span&gt;
&lt;span class="normal"&gt;14&lt;/span&gt;
&lt;span class="normal"&gt;15&lt;/span&gt;
&lt;span class="normal"&gt;16&lt;/span&gt;
&lt;span class="normal"&gt;17&lt;/span&gt;
&lt;span class="normal"&gt;18&lt;/span&gt;
&lt;span class="normal"&gt;19&lt;/span&gt;
&lt;span class="normal"&gt;20&lt;/span&gt;
&lt;span class="normal"&gt;21&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

&lt;span class="c1"&gt;# Abort if anything goes wrong (negates the need for error-checking)&lt;/span&gt;
&lt;span class="nb"&gt;set&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-e

&lt;span class="c1"&gt;# Uses drill instead of dig&lt;/span&gt;
resolve&lt;span class="o"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="c1"&gt;#dig &amp;quot;$1&amp;quot; @resolver1.opendns.com +short 2&amp;gt; /dev/null&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nv"&gt;line&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;drill&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;@resolver1.opendns.com&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;/dev/null&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;sed&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/;;.*$/d;/^\s*$/d&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;grep&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$line&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;head&lt;span class="w"&gt; &lt;/span&gt;-1&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;cut&lt;span class="w"&gt; &lt;/span&gt;-f5
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="nv"&gt;dns&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;resolve&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;subdomain&amp;gt;.cmetcalfe.ca&lt;span class="k"&gt;)&lt;/span&gt;
&lt;span class="nv"&gt;curr&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;resolve&lt;span class="w"&gt; &lt;/span&gt;myip.opendns.com&lt;span class="k"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$dns&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;!&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$curr&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;then&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;curl&lt;span class="w"&gt; &lt;/span&gt;-s&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;https://dynamicdns.park-your-domain.com/update?host=&amp;lt;subdomain&amp;gt;&amp;amp;domain=cmetcalfe.ca&amp;amp;password=&amp;lt;my passkey&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;grep&lt;span class="w"&gt; &lt;/span&gt;-q&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;lt;ErrCount&amp;gt;0&amp;lt;/ErrCount&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;then&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Server DNS record updated (&lt;/span&gt;&lt;span class="nv"&gt;$dns&lt;/span&gt;&lt;span class="s2"&gt; -&amp;gt; &lt;/span&gt;&lt;span class="nv"&gt;$curr&lt;/span&gt;&lt;span class="s2"&gt;)&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Server DNS record update FAILED (tried &lt;/span&gt;&lt;span class="nv"&gt;$dns&lt;/span&gt;&lt;span class="s2"&gt; -&amp;gt; &lt;/span&gt;&lt;span class="nv"&gt;$curr&lt;/span&gt;&lt;span class="s2"&gt;)&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;It basically checks if the IP returned by a DNS query for the subdomain matches
the current IP of the server (as reported by an &lt;a href="https://en.wikipedia.org/wiki/OpenDNS"&gt;OpenDNS&lt;/a&gt; resolver) and if it
doesn't, sends a request to update the DNS. The &lt;code&gt;echo&lt;/code&gt; commands are there just
to output some record of the IP changing. Maybe I'll do some analysis of it at
some point.&lt;/p&gt;
&lt;p&gt;To run the script every 30 minutes and redirect any output from it to the
syslog, the following &lt;a href="http://en.wikipedia.org/wiki/Cron"&gt;crontab&lt;/a&gt; entry can be used:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;*/30&lt;span class="w"&gt; &lt;/span&gt;*&lt;span class="w"&gt; &lt;/span&gt;*&lt;span class="w"&gt; &lt;/span&gt;*&lt;span class="w"&gt; &lt;/span&gt;*&lt;span class="w"&gt; &lt;/span&gt;/path/to/dns-update&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;/usr/bin/logger&lt;span class="w"&gt; &lt;/span&gt;-t&lt;span class="w"&gt; &lt;/span&gt;dns-update
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;With the script automatically running every 30 minutes I can now be confident
that my subdomain will always be pointing at my home server whenever I need
access to it.&lt;/p&gt;
&lt;div class="admonition note"&gt;
&lt;p class="admonition-title"&gt;Note&lt;/p&gt;
&lt;p&gt;A previous version of this article used &lt;code&gt;curl -sf http://curlmyip.com&lt;/code&gt; to
find the server's current IP address. However, after curlmyip went down for
a few days, I decided to take the advice in &lt;a href="http://unix.stackexchange.com/a/81699"&gt;this StackExchange answer&lt;/a&gt;
and use &lt;a href="https://en.wikipedia.org/wiki/OpenDNS"&gt;OpenDNS&lt;/a&gt; instead.&lt;/p&gt;
&lt;/div&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Thu, 26 Feb 2015 23:21:00 -0500</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2015-02-26:/blog/dynamic-dns-client-for-namecheap.html</guid><category>blog</category><category>shell script</category><category>code</category><category>linux</category><category>website</category><category>homelab</category></item><item><title>Remove an application from the cmd-tab switcher on macOS</title><link>https://cmetcalfe.ca/blog/remove-app-from-cmd-tab-switcher.html</link><description>&lt;p&gt;At work, I use &lt;a href="http://iterm2.com"&gt;iTerm2&lt;/a&gt; as my main terminal emulator. For quick access, I have
it configured to drop down from the top of the screen when &lt;code&gt;F12&lt;/code&gt; is pressed.&lt;/p&gt;
&lt;p&gt;Unfortunately, it also shows up in the application switcher, bumping up into
the 'last used' position whenever it's activated and getting in the way. Since
I already have access to the terminal via &lt;code&gt;F12&lt;/code&gt;, there's no need for it to be
shown in the application switcher as well.&lt;/p&gt;
&lt;p&gt;Changing how an application behaves can be done by editing its &lt;code&gt;Info.plist&lt;/code&gt;
file. The key &lt;code&gt;LSUIElement&lt;/code&gt; (&lt;a href="https://developer.apple.com/library/mac/documentation/General/Reference/InfoPlistKeyReference/Articles/LaunchServicesKeys.html#//apple_ref/doc/uid/20001431-108256"&gt;according to the Apple documentation&lt;/a&gt;)
"Specifies whether the app is an agent app, that is, an app that should not
appear in the Dock or Force Quit window."&lt;/p&gt;
&lt;p&gt;To set this key, open the application's &lt;code&gt;Info.plist&lt;/code&gt; at
&lt;code&gt;/Applications/[application name].app/Contents/Info.plist&lt;/code&gt; and add
&lt;code&gt;&amp;lt;key&amp;gt;LSUIElement&amp;lt;/key&amp;gt;&amp;lt;true/&amp;gt;&lt;/code&gt; after the first &lt;code&gt;&amp;lt;dict&amp;gt;&lt;/code&gt; tag. The result should
look something like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;
&lt;span class="normal"&gt;5&lt;/span&gt;
&lt;span class="normal"&gt;6&lt;/span&gt;
&lt;span class="normal"&gt;7&lt;/span&gt;
&lt;span class="normal"&gt;8&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="cp"&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot;?&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;&amp;lt;!DOCTYPE plist PUBLIC &amp;quot;-//Apple//DTD PLIST 1.0//EN&amp;quot; &amp;quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;plist&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="na"&gt;version=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;1.0&amp;quot;&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;dict&amp;gt;&lt;/span&gt;
&lt;span class="hll"&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;&amp;lt;key&amp;gt;&lt;/span&gt;LSUIElement&lt;span class="nt"&gt;&amp;lt;/key&amp;gt;&amp;lt;true/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="cm"&gt;&amp;lt;!-- The rest of the plist data --&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/dict&amp;gt;&lt;/span&gt;
&lt;span class="nt"&gt;&amp;lt;/plist&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Once the &lt;code&gt;LSUIElement&lt;/code&gt; key is set to &lt;code&gt;true&lt;/code&gt;, relaunch the application to see the
changes.&lt;/p&gt;
&lt;p&gt;Be warned that not only does this remove the application from the
application switcher, it also removes it from the dock and stops it from showing
the menu bar on the top of the screen.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Thu, 22 Jan 2015 23:30:00 -0500</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2015-01-22:/blog/remove-app-from-cmd-tab-switcher.html</guid><category>blog</category><category>application</category><category>macOS</category></item><item><title>Adding Xbox 360 controller support to a Nexus 5</title><link>https://cmetcalfe.ca/blog/adding-xbox360-controller-support-to-a-nexus5.html</link><description>&lt;div class="admonition update"&gt;
&lt;p class="admonition-title"&gt;Update&lt;/p&gt;
&lt;p&gt;CyanogenMod has effectively been replaced by &lt;a href="https://lineageos.org/"&gt;LineageOS&lt;/a&gt;. The links in this article originally
all pointed to CyanogenMod but since it no longer exists, I've updated them to use the LineageOS
equivilents where possible. The instructions will also need to be slightly modified for use with
LineageOS builds.&lt;/p&gt;
&lt;/div&gt;
&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;I finally just bought a new phone (a &lt;a href="http://en.wikipedia.org/wiki/Nexus_5"&gt;Nexus 5&lt;/a&gt;), and after flashing &lt;a href="https://en.wikipedia.org/wiki/CyanogenMod"&gt;CyanogenMod&lt;/a&gt; onto it, I've
been messing around with its &lt;a href="http://en.wikipedia.org/wiki/USB_On-The-Go"&gt;OTG&lt;/a&gt; support. My old phone (a &lt;a href="http://en.wikipedia.org/wiki/Nexus_4"&gt;Nexus 4&lt;/a&gt;) &lt;a href="http://blog.gsmarena.com/nexus-4-does-not-support-usb-otg-despite-google-saying-otherwise/"&gt;didn't have the
capability&lt;/a&gt; so being able to plug in keyboards, mice, external hard drives, and various other
peripherals was (embarrassingly enough) a thrill.&lt;/p&gt;
&lt;p&gt;Keyboards worked, mice worked, but when an Xbox 360 controller was plugged in, nothing happened.
Turns out that while the kernel didn't have support for it enabled out of the box, getting it
enabled and pushing the change upstream into the CyanogenMod project was easier than I thought.&lt;/p&gt;
&lt;p&gt;Beware that this post is going to be more of a record of what I did so that I can do it again and
less of a coherent tutorial.&lt;/p&gt;
&lt;h2&gt;Building CyanogenMod&lt;/h2&gt;
&lt;p&gt;First step was to download and compile CyanogenMod for my phone. I'm not going to go into this in
any detail on this because there's already a &lt;a href="https://web.archive.org/web/20161224200646/https://wiki.cyanogenmod.org/w/Development"&gt;good overview&lt;/a&gt; on the CyanogenMod wiki that covers
the entire process, as well as a &lt;a href="https://wiki.lineageos.org/devices/hammerhead/build"&gt;customized guide for the Nexus 5&lt;/a&gt;. If those articles are
followed correctly, you should be able to build a fresh CyanogenMod image with:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;brunch&lt;span class="w"&gt; &lt;/span&gt;hammerhead
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;h2&gt;Enabling the kernel module&lt;/h2&gt;
&lt;p&gt;Once the image was flashed to the phone and verified to be working, the next step was to enable the
&lt;a href="https://www.kernel.org/doc/html/v4.16/input/devices/xpad.html"&gt;xpad kernel module&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Copy current kernel config to the kernel directory for editing:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nb"&gt;cd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;build&lt;span class="w"&gt; &lt;/span&gt;dir&amp;gt;/kernel/lge/hammerhead/
cp&lt;span class="w"&gt; &lt;/span&gt;arch/arm/configs/cyanogenmod_hammerhead_defconfig&lt;span class="w"&gt; &lt;/span&gt;.config
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Edit the config:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;make&lt;span class="w"&gt; &lt;/span&gt;menuconfig&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ARCH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;arm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;At this point, a menu will come up. Search for &lt;code&gt;xpad&lt;/code&gt; (type &lt;code&gt;/xpad&lt;/code&gt;), and take note of the paths.
&lt;code&gt;ESC&lt;/code&gt; out of the search, navigate the tree and enable the modules found with the search. Save and
exit.&lt;/p&gt;
&lt;p&gt;Copy the config back and clean up any stray &lt;code&gt;*.o&lt;/code&gt; files:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cp&lt;span class="w"&gt; &lt;/span&gt;.config&lt;span class="w"&gt; &lt;/span&gt;arch/arm/configs/cyanogenmod_hammerhead_defconfig
make&lt;span class="w"&gt; &lt;/span&gt;mrproper
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;After enabling the module, rebuild CyanogenMod using the normal &lt;code&gt;brunch hammerhead&lt;/code&gt; and flash it to
the phone.&lt;/p&gt;
&lt;h2&gt;Submitting the change upstream&lt;/h2&gt;
&lt;p&gt;Since Xbox controller support had already been requested in &lt;del&gt;&lt;a href="https://jira.cyanogenmod.org/browse/CYAN-4469"&gt;a JIRA ticket&lt;/a&gt;&lt;/del&gt;(dead link), I went
through the process to submit &lt;a href="https://review.lineageos.org/#/c/LineageOS/android_kernel_lge_hammerhead/+/87409/"&gt;the change&lt;/a&gt; on the CyanogenMod Gerrit instance for inclusion in the
next release. There's a guide for this &lt;a href="https://wiki.lineageos.org/submitting-patch-howto.html"&gt;here&lt;/a&gt;. As well as the guide, I found the people in
&lt;a href="https://webchat.freenode.net/?channels=#cyanogenmod-dev"&gt;#cyanogenmod-dev on Freenode&lt;/a&gt; to be very helpful.&lt;/p&gt;
&lt;p&gt;A short while after submitting &lt;a href="https://review.lineageos.org/#/c/LineageOS/android_kernel_lge_hammerhead/+/87409/"&gt;the change&lt;/a&gt; to Gerrit, it was merged into the &lt;code&gt;cm-11.0&lt;/code&gt; branch as
commit &lt;a href="https://github.com/LineageOS/android_kernel_lge_hammerhead/commit/7ef4f6a87cc114b5010b623d72840b1d38ea01ed"&gt;&lt;code&gt;i7ef4f6a&lt;/code&gt;&lt;/a&gt; and pushed out in the next nightly build (&lt;a href="https://cmetcalfe.ca/images/cyanogenmod-changelog-xbox-support.png"&gt;changelog screenshot&lt;/a&gt;).&lt;/p&gt;
&lt;h2&gt;Wrap-up&lt;/h2&gt;
&lt;p&gt;It feels great to be able to contribute to an amazing open source project that had &lt;a href="https://twitter.com/CyanogenMod/status/157378138802888704"&gt;at least a
million people&lt;/a&gt; using it at one point or another. I recognize that the change by itself was just
changing a config file to enable functionality that already existed, but it's helped me get through
some of the non-coding hurdles of contributing to an Android fork like CyanogenMod (adb, fastboot,
unlocking and rooting phones, compiling AOSP, flashing images, the contribution process, etc). This
time the actual contribution itself was minor, but it's gotten me more familier with the process,
hopefully making it easier to contribute something more substantial in the future.&lt;/p&gt;
&lt;p&gt;In the end, I learned a lot about Android development and how all the different pieces that I had
read about at one point or another actually fit together. During the whole process I also lost a lot
of the fear I had about messing with phones and other more expensive locked down devices. Going
forward, I'm going to attempt to compile and flash open source operating systems like CyanogenMod
onto more devices that I own. I like being able to tweak things and feel like I really own them,
hardware and software.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Wed, 14 Jan 2015 20:26:00 -0500</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2015-01-14:/blog/adding-xbox360-controller-support-to-a-nexus5.html</guid><category>blog</category><category>android</category></item><item><title>Fixing save file corruption in Ridiculous Fishing</title><link>https://cmetcalfe.ca/blog/fixing-save-corruption-ridiculous-fishing.html</link><description>&lt;p&gt;&lt;a href="https://play.google.com/store/apps/details?id=com.vlambeer.RidiculousFishing"&gt;Ridiculous Fishing&lt;/a&gt; is a game by &lt;a href="http://www.vlambeer.com/"&gt;Vlambeer&lt;/a&gt; about fishing. That's if you
can call chainsawing fish and blowing them out of the sky with a bazooka "fishing".&lt;/p&gt;
&lt;p&gt;I've been playing this game on and off for a while now, but just recently I had
a problem where my save file somehow got corrupted, making the app refuse to open.&lt;/p&gt;
&lt;p&gt;The problem first manifested as the game freezing for up to 5 seconds when
navigating around the UI or buying items in the in-game store. Since I was
running the game on a &lt;a href="http://en.wikipedia.org/wiki/Nexus_5"&gt;Nexus 5&lt;/a&gt; (not the latest and greatest, but pretty
close), it seemed weird. The delay got longer and longer until the game
eventually crashed and refused to reopen.&lt;/p&gt;
&lt;p&gt;Since I was pretty far into the game (I only needed to catch one more species
of fish!), I opted to try to fix it instead of just wiping the app's data and
starting again. I initially tried clearing the app's cache and
&lt;a href="https://cmetcalfe.ca/blog/reinstall-android-app-without-losing-data.html"&gt;reinstalling the app&lt;/a&gt;, but the problem persisted.&lt;/p&gt;
&lt;p&gt;The next step was to dump the games's data to my computer so I could do some
analysis on it. Some exploration on the device revealed that the settings and
data were stored in the folder &lt;code&gt;/data/data/com.vlambeer.RidiculousFishing.humble&lt;/code&gt;
(I have the &lt;a href="https://www.humblebundle.com/"&gt;Humble Bundle&lt;/a&gt; version of the app).&lt;/p&gt;
&lt;p&gt;To pull that folder to my current directory, I used &lt;a href="http://developer.android.com/tools/help/adb.html"&gt;ADB&lt;/a&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;adb&lt;span class="w"&gt; &lt;/span&gt;root&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;#Restart adbd on the device with root permissions&lt;/span&gt;
adb&lt;span class="w"&gt; &lt;/span&gt;pull&lt;span class="w"&gt; &lt;/span&gt;/data/data/com.vlambeer.RidiculousFishing.humble/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;A quick &lt;code&gt;du -h&lt;/code&gt; revealed that something was very wrong in the
&lt;code&gt;files/Library/Preferences/com.vlambeer.RidiculousFishing.humble.plist&lt;/code&gt; file.
It should've been just a text document, but was well over 200MB.&lt;/p&gt;
&lt;p&gt;After trying out of habit to open the file in &lt;a href="http://www.vim.org/"&gt;Vim&lt;/a&gt; and having it hang (oops),
I paged through the document with &lt;a href="http://en.wikipedia.org/wiki/Less_%28Unix%29"&gt;less&lt;/a&gt;. About halfway through the file,
there was a line containing &lt;code&gt;&amp;amp;amp;lt;message&amp;amp;amp;gt;@eggbirdTBA Take it to the
Smartypants Bar&lt;/code&gt; (no, that's not a formatting error, in the plist there's XML
data stored in a &lt;code&gt;&amp;lt;string&amp;gt;&lt;/code&gt; element, requiring the &lt;code&gt;&amp;lt;&lt;/code&gt; and &lt;code&gt;&amp;gt;&lt;/code&gt; characters to be
escaped) followed by about 200MB of garbage.&lt;/p&gt;
&lt;p&gt;Apparently there are &lt;a href="http://stackoverflow.com/questions/908575/how-to-edit-multi-gigabyte-text-files-vim-doesnt-work"&gt;ways to load huge files in Vim&lt;/a&gt;, as well as other text
editors that handle them nicely, but since I already knew what line was causing
the issue, a simple &lt;a href="http://en.wikipedia.org/wiki/Sed"&gt;sed&lt;/a&gt; command would do the trick.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sed&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/Take it to the Smartypants Bar/d&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;com.vlambeer.RidiculousFishing.humble.plist&lt;span class="w"&gt; &lt;/span&gt;&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;temp.plist
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Total size of &lt;code&gt;temp.plist&lt;/code&gt;: 107.11KB. Much better.&lt;/p&gt;
&lt;p&gt;After going though and deleting some lines around the one that was removed (to
make the XML valid again), I pushed the file back to the device:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;adb&lt;span class="w"&gt; &lt;/span&gt;push&lt;span class="w"&gt; &lt;/span&gt;temp.plist&lt;span class="w"&gt; &lt;/span&gt;/data/data/com.vlambeer.RidiculousFishing.humble/files/Library/Preferences/com.vlambeer.RidiculousFishing.humble.plist
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Success! The game opened properly, all the freezing issues were gone, and my
save data was still there.&lt;/p&gt;
&lt;p&gt;Now to find that stupid &lt;a href="http://gaming.stackexchange.com/questions/159564/how-to-catch-the-mimic-fish"&gt;Mimic Fish&lt;/a&gt;...&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Thu, 11 Dec 2014 12:44:00 -0500</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2014-12-11:/blog/fixing-save-corruption-ridiculous-fishing.html</guid><category>blog</category><category>android</category><category>games</category></item><item><title>Reinstalling an Android app without losing data</title><link>https://cmetcalfe.ca/blog/reinstall-android-app-without-losing-data.html</link><description>&lt;p&gt;When an application isn't opening (and clearing the cache doesn't help) it
sometimes helps to reinstall it. However, uninstalling then reinstalling the
app normally will delete all the data associated with it.&lt;/p&gt;
&lt;p&gt;The way around this is to directly call the package manager from the shell and
give it the &lt;code&gt;-k&lt;/code&gt; argument, which tells it to keep the data and cache directories.&lt;/p&gt;
&lt;p&gt;Simply connect the device to a computer with &lt;a href="http://developer.android.com/tools/help/adb.html"&gt;ADB&lt;/a&gt; installed and run:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;adb&lt;span class="w"&gt; &lt;/span&gt;-d&lt;span class="w"&gt; &lt;/span&gt;shell&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;pm uninstall -k com.package.name&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Then just reinstall the app (either from an apk file or the &lt;a href="https://play.google.com/store"&gt;Play Store&lt;/a&gt;) and
the app will be back with all of its data intact.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Thu, 11 Dec 2014 11:20:00 -0500</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2014-12-11:/blog/reinstall-android-app-without-losing-data.html</guid><category>blog</category><category>android</category></item><item><title>Git checkout - autocomplete local branches only</title><link>https://cmetcalfe.ca/blog/git-checkout-autocomplete-local-branches-only.html</link><description>&lt;p&gt;Having Git autocomplete branch names when doing a checkout is super useful.  Having the autocomplete
hang for 30 seconds because it has to look up all 3000 of the remote branches in a massive repo is
not so useful. It's actually pretty frustrating.&lt;/p&gt;
&lt;p&gt;My solution: changing the &lt;code&gt;git checkout&lt;/code&gt; autocomplete to only look at local branches, while using a
&lt;code&gt;git checkoutr&lt;/code&gt; alias to preserve the original behaviour (because sometimes it's actually needed).&lt;/p&gt;
&lt;p&gt;How it's done:&lt;/p&gt;
&lt;h2&gt;Define an alias for checkout&lt;/h2&gt;
&lt;p&gt;We're going to use the same checkout command for the remote checkout, but need to have a different
command so the script can differentiate between them.  Making an alias does exactly this.&lt;/p&gt;
&lt;p&gt;Create the alias by running &lt;code&gt;git config --global alias.checkoutr checkout&lt;/code&gt;&lt;/p&gt;
&lt;h2&gt;Change the autocompletion function&lt;/h2&gt;
&lt;p&gt;The checkout autocomplete behaviour is defined in a function called &lt;code&gt;_git_checkout&lt;/code&gt; in the git
autocompletion file. We're going to override the function with our own version that has different
autocomplete logic in it.&lt;/p&gt;
&lt;p&gt;The location of the file varies over different operating systems and configurations, but here are a
few spots to look:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;/etc/bash_completion.d/git&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/usr/share/bash-completion/completions/git&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For a brew-installed git autocomplete on macOS, the file will probably be
&lt;code&gt;$(brew --prefix)/etc/bash_completion.d/git-completion.bash&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Once you've found the file, copy the entire &lt;code&gt;_git_checkout&lt;/code&gt; function into your &lt;code&gt;.bashrc&lt;/code&gt; (or
equivalent non-login shell startup script). Now look for the line&lt;/p&gt;
&lt;p&gt;&lt;code&gt;__git_complete_refs $track_opt&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;We're going to replace that line with:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;
&lt;span class="normal"&gt;5&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$command&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;checkoutr&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;then&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;__git_complete_refs&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$track_opt&lt;/span&gt;
&lt;span class="k"&gt;else&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;__gitcomp_direct&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;__git_heads&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$cur&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot; &amp;quot;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;After saving and re-sourcing your &lt;code&gt;.bashrc&lt;/code&gt; file, git will autocomplete local branches and tags when
using &lt;code&gt;git checkout&lt;/code&gt;, but will go back to the default behaviour of autocompleting all references
when using &lt;code&gt;git checkoutr&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Credits to a combination of answers on &lt;a href="disable-auto-completion-of-remote-branches-in-git-bash"&gt;this&lt;/a&gt; StackOverflow post.&lt;/p&gt;
&lt;p&gt;EDIT 2017-10-02: Updated to work with &lt;a href="https://github.com/git/git/commit/15b4a163950c2e8660a7797ce3975ccea8705f80#diff-f37c4f4a898819f0ca4b5ff69e81d4d9"&gt;git v2.13.0&lt;/a&gt; thanks to &lt;a href="https://gist.github.com/mmrko/b3ec6da9bea172cdb6bd83bdf95ee817#gistcomment-2218059"&gt;Alexander Ko's comment&lt;/a&gt;.&lt;br&gt;
EDIT 2018-03-24: Updated to &lt;a href="https://github.com/git/git/commit/227307a639c96b3579b7fe60840fdae123d1ee88"&gt;speed up branch and tag completion&lt;/a&gt;.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Wed, 24 Sep 2014 23:05:00 -0400</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2014-09-24:/blog/git-checkout-autocomplete-local-branches-only.html</guid><category>blog</category><category>git</category><category>shell script</category></item><item><title>Preserving the Xposed Framework through a ROM flash</title><link>https://cmetcalfe.ca/blog/preserving-xposed-framework-through-a-flash.html</link><description>&lt;p&gt;The &lt;a href="https://repo.xposed.info/"&gt;Xposed Framework&lt;/a&gt; is a neat Android program that enables &lt;a href="https://repo.xposed.info/module-overview"&gt;user-made
modules&lt;/a&gt; to change the behaviour of the lower-level Android OS. It does this
by modifying &lt;code&gt;/system/bin/app_process&lt;/code&gt; to add some hooks into it.&lt;/p&gt;
&lt;p&gt;The issue is that when flashing a new ROM, the modified &lt;code&gt;app_process&lt;/code&gt; is
reverted back to the original version, disabling the Xposed Framework until it's
restored.&lt;/p&gt;
&lt;div class="admonition update"&gt;
&lt;p class="admonition-title"&gt;Update&lt;/p&gt;
&lt;p&gt;The Xposed Framework installer now includes the option to flash a zip file
to install the framework instead of patching &lt;code&gt;app_process&lt;/code&gt; directly. The
method detailed in this post will still work, but the new way to make sure
the framework is installed after flashing a new ROM is to simply flash the
Xposed installer zip right after flashing the ROM.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;The solution to this is a script that will automatically back up the existing
&lt;code&gt;app_process&lt;/code&gt; before a flash, then restore it after the flash completes.&lt;/p&gt;
&lt;p&gt;The &lt;a href="https://cmetcalfe.ca/files/90-xposed.sh"&gt;90-xposed.sh&lt;/a&gt; script does exactly that. To enable it, download it to the
Android device, move it to &lt;code&gt;/system/addon.d/90-xposed.sh&lt;/code&gt;, and give it
executable permissions.&lt;/p&gt;
&lt;p&gt;This can be done on the device with a few different programs, but it's much
easier to do from a computer with &lt;a href="https://developer.android.com/tools/help/adb.html"&gt;adb&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Download the script and push it to the SD card of the Android device with&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;adb&lt;span class="w"&gt; &lt;/span&gt;push&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;90&lt;/span&gt;-xposed.sh&lt;span class="w"&gt; &lt;/span&gt;/sdcard/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Once the file is on the device, log into it (using &lt;code&gt;adb shell&lt;/code&gt;) and run the
following commands:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;su&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# Get root permissions&lt;/span&gt;
cp&lt;span class="w"&gt; &lt;/span&gt;/sdcard/90-xposed.sh&lt;span class="w"&gt; &lt;/span&gt;/system/addon.d/&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# Copy the file to the correct folder&lt;/span&gt;
chmod&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;755&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;/system/addon.d/90-xposed.sh&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;# Make the file executable&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;After logging out of the device, the Xposed framework will stay installed and
active even after flashing a new ROM. Note that this should only really be
used in situations where the ROM isn't changing too much (like flashing a new
nightly ROM).&lt;/p&gt;
&lt;p&gt;In situations where &lt;code&gt;app_process&lt;/code&gt; would actually be changed by the flash, this
script could cause issues as it would restore an incorrect version of the file.
If this happens, delete &lt;code&gt;app_process&lt;/code&gt; and &lt;code&gt;app_process.orig&lt;/code&gt; in the
&lt;code&gt;/system/bin/&lt;/code&gt; directory, then reflash. The script won't interfere, allowing
the flash to update &lt;code&gt;app_process&lt;/code&gt; to the correct version. After rebooting,
install the Xposed Framework again.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Sat, 22 Mar 2014 22:04:00 -0400</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2014-03-22:/blog/preserving-xposed-framework-through-a-flash.html</guid><category>blog</category><category>android</category><category>shell script</category></item><item><title>Limit download speed by IP or MAC address</title><link>https://cmetcalfe.ca/blog/limit-download-speed-by-ip-or-mac-address.html</link><description>&lt;h2&gt;Preamble&lt;/h2&gt;
&lt;p&gt;This article will focus on setting strict speed limits on misbehaving devices on your network. This can be a housemate incessantly torrenting, your kid downloading movies on iTunes, or anyone else clogging up your network with their overzealous bandwidth gobbling.&lt;/p&gt;
&lt;p&gt;If you're looking for help with the QOS (quality of service) settings that come baked into most router firmwares, this article is not for you.&lt;/p&gt;
&lt;p&gt;This article assumes you have a router running OpenWRT, DD-WRT, Tomato, or any other firmware that uses &lt;a href="http://linux.die.net/man/8/tc"&gt;&lt;code&gt;tc&lt;/code&gt;&lt;/a&gt; to manipulate traffic control settings.&lt;/p&gt;
&lt;h2&gt;Procedure&lt;/h2&gt;
&lt;p&gt;First, you'll need to get shell access to the router. With most custom router firmwares, this is as easy as selecting a radio button. Other firmwares might give you the ability to enter commands via a web interface. Whatever works.&lt;/p&gt;
&lt;p&gt;Once you have shell access, follow the steps below. Note that bits of the commands you might want to change are included in brackets.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Using &lt;code&gt;ifconfig&lt;/code&gt;, find the interface to apply the limits to. You'll want to use either the internal or external default gateway (the interfaces all the packets go though). Keep in mind which interface you use as the filtering rules will be reversed. &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Internal gateway: to src = uploading, to dst = downloading&lt;/li&gt;
&lt;li&gt;External gateway: to src = downloading, to dst = uploading&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Remove all existing rules on the interface (interface = &lt;code&gt;br0&lt;/code&gt;)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;tc qdisc del dev br0 root
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Set up the connection (Ex: connection speed = 20mbit)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;tc qdisc add dev br0 root handle 1: cbq avpkt 1000 bandwidth 20mbit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Add the limiting rule (Ex: speed limit = 10mbit)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;tc class add dev br0 parent 1: classid 1:1 cbq rate 10mbit allot 1500 prio 5 bounded isolated
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Filtering - Add the users to apply to rule to&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;By src IP (Ex: IP = &lt;code&gt;192.168.1.100&lt;/code&gt;)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;tc filter add dev br0 parent 1: protocol ip prio 16 u32 match ip src 192.168.1.100 flowid 1:1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;By dst IP (Ex: IP = &lt;code&gt;192.168.1.100&lt;/code&gt;)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;tc filter add dev br0 parent 1: protocol ip prio 16 u32 match ip dst 192.168.1.100 flowid 1:1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;By src MAC (Ex: MAC = &lt;code&gt;M0-M1-M2-M3-M4-M5&lt;/code&gt;)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;tc filter add dev br0 parent 1: protocol ip prio 5 u32 match u16 0x0800 0xFFFF at -2 match u16 0xM4M5 0xFFFF at -4 match u32 0xM0M1M2M3 0xFFFFFFFF at -8 flowid 1:1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;By dst MAC (Ex: MAC = &lt;code&gt;M0-M1-M2-M3-M4-M5&lt;/code&gt;)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;tc filter add dev br0 parent 1: protocol ip prio 5 u32 match u16 0x0800 0xFFFF at -2 match u32 0xM2M3M4M5 0xFFFFFFFF at -12 match u16 0xM0M1 0xFFFF at -14 flowid 1:1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Sources&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;http://lartc.org/lartc.html&lt;/li&gt;
&lt;li&gt;http://www.docum.org/faq/cache/62.html&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Tue, 04 Mar 2014 20:02:00 -0500</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2014-03-04:/blog/limit-download-speed-by-ip-or-mac-address.html</guid><category>blog</category><category>router</category><category>shell script</category></item><item><title>Preventing Wine from registering mimetypes</title><link>https://cmetcalfe.ca/blog/preventing-wine-from-registering-mimetypes.html</link><description>&lt;p&gt;When installing &lt;a href="http://winehq.org/"&gt;Wine for Linux&lt;/a&gt;, the install script insists on associating all text files with its built-in notepad.exe&lt;/p&gt;
&lt;p&gt;As someone who uses &lt;a href="http://www.vim.org/"&gt;Vim&lt;/a&gt; almost exculsively, this is definitely not the desired behaviour.&lt;/p&gt;
&lt;p&gt;To stop this from happening, run the following command &lt;em&gt;before&lt;/em&gt; installing Wine.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nb"&gt;export&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;WINEDLLOVERRIDES&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;winemenubuilder.exe=a&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;This sets the path of the winemenubuilder library (the library that creates mimetype associations) to something invalid,
preventing the associations from being made when Wine installs.&lt;/p&gt;
&lt;p&gt;Once Wine is installed, it won't try to associate notepad.exe again. However, if needed,
the library can be properly disabled via the libraries tab of wineconf.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Sun, 29 Dec 2013 14:37:00 -0500</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2013-12-29:/blog/preventing-wine-from-registering-mimetypes.html</guid><category>blog</category><category>linux</category><category>wine</category></item><item><title>Changes to the blog and website</title><link>https://cmetcalfe.ca/blog/changes-to-the-blog-and-website.html</link><description>&lt;p&gt;I used to run this site on two different platforms.
There was a static landing page hosted on my server, and a blog hosted on &lt;a href="http://blogger.com"&gt;Blogger&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;While the landing page was reasonably nice-looking (screenshot &lt;a href="https://cmetcalfe.ca/images/old_website_screenshot.png"&gt;here&lt;/a&gt;), the blog looked terrible.
Free Blogger templates are generally not the nicest-looking things to look at and the one I used was no exception.&lt;/p&gt;
&lt;p&gt;More importantly though, the Blogger composer made really hard to generate nice-looking articles.
For just writing text posts, it wasn't bad (aside from the crazy HTML it generated), but for inserting code
snippits or doing any kind of advanced formatting it was incredibly frustrating.&lt;/p&gt;
&lt;p&gt;A few weeks ago I finally decided to deal with the situation. My general plan was to find a static site generator
that allowed for writing posts in &lt;a href="http://daringfireball.net/projects/markdown"&gt;Markdown syntax&lt;/a&gt; and use it to create a website that would
host some static content as well as the blog.&lt;/p&gt;
&lt;p&gt;Static sites are exactly what they sound like. Just some static HTML files for a webserver to serve to clients.
No fancy frameworks, databases, or server-side processing involved. This is advantageous primarily because it
makes site blazing fast and very light on server resources.&lt;/p&gt;
&lt;p&gt;After looking at a few static site generators, I decided to go with &lt;a href="http://blog.getpelican.com"&gt;Pelican&lt;/a&gt;.
Pelican is a Python-based static site generator that uses the awesome &lt;a href="http://jinja.pocoo.org/docs"&gt;Jinja2&lt;/a&gt; templating library
and understands content written in a number of formats, including Markdown.
It's extremely easy to set up and requires only a single command to regenerate the entire site.&lt;/p&gt;
&lt;p&gt;Transferring content from the old blog into the *.md files that Pelican reads was also really simple.
Pelican includes a tool called &lt;code&gt;pelican-import&lt;/code&gt; that allows for reading in data from a variety of sources.
I used this tool to pull all my previous posts down from the RSS feed of the old blog.&lt;/p&gt;
&lt;p&gt;After fixing up the imported data (the import tool is good, but not perfect), I started looking into templates.&lt;/p&gt;
&lt;p&gt;Like with Blogger themes, I was having a hard time finding anything I liked, until I came across a template called &lt;a href="https://github.com/giulivo/pelican-svbhack"&gt;svbhack&lt;/a&gt;.
It had a nice page layout and the general aesthetic was good, but needed a fair bit of tweaking.
I forked the repository (+1 for open-source) and over the next few weeks used my limited HTML and CSS knowledge to transform it into the one you see today.&lt;/p&gt;
&lt;p&gt;There are still a bunch of things I want to change/fix/add, but at this point I feel that the site is ready to be released.
The code for the &lt;a href="https://github.com/pR0Ps/pelican-svbhack"&gt;template&lt;/a&gt; and the &lt;a href="https://github.com/pR0Ps/website"&gt;site&lt;/a&gt; is all freely availible on GitHub.&lt;/p&gt;
&lt;p&gt;If you have any comments or suggestions I'd love to hear them!&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Wed, 11 Dec 2013 06:30:00 -0500</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2013-12-11:/blog/changes-to-the-blog-and-website.html</guid><category>blog</category><category>website</category></item><item><title>Making Steam for Linux close to the system tray</title><link>https://cmetcalfe.ca/blog/making-steam-for-linux-close-to-the-system-tray.html</link><description>&lt;p&gt;Steam for Linux is a little odd in how it handles a user clicking the close button.
Instead of exiting the program or mimimizing the application to the system tray, it just minimizes it to the taskbar.
The developers have said that this is temporary and that it will be changed in the future, but for now, there is a workaround.&lt;/p&gt;
&lt;p&gt;To make Steam always minimize to the system tray, just add &lt;code&gt;STEAM_FRAME_FORCE_CLOSE=1&lt;/code&gt; to your environment.&lt;/p&gt;
&lt;p&gt;For more information see the &lt;a href="https://github.com/ValveSoftware/steam-for-linux/issues/1025"&gt;original GitHub issue&lt;/a&gt;.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Wed, 11 Dec 2013 06:00:00 -0500</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2013-12-11:/blog/making-steam-for-linux-close-to-the-system-tray.html</guid><category>blog</category><category>steam</category><category>linux</category><category>games</category></item><item><title>GitHub: Convert an issue to a pull request</title><link>https://cmetcalfe.ca/blog/github-convert-issue-to-pull-request.html</link><description>&lt;p&gt;&lt;a href="http://github.com"&gt;GitHub&lt;/a&gt; currently doesn't provide a way to convert an issue to a pull request in their interface.
However, the capability exists in their &lt;a href="http://developer.github.com/v3/pulls/#alternative-input"&gt;Pull Request API&lt;/a&gt;.&lt;/p&gt;
&lt;div class="admonition update"&gt;
&lt;p class="admonition-title"&gt;Update&lt;/p&gt;
&lt;p&gt;I've built a self-hostable webapp called &lt;a href="https://github.com/pR0Ps/gh-i2p"&gt;gh-i2p&lt;/a&gt; that makes this process easier.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;To call the API using a simple &lt;code&gt;curl&lt;/code&gt; command, run the command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;curl&lt;span class="w"&gt; &lt;/span&gt;--user&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;[github username]&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="w"&gt;     &lt;/span&gt;--request&lt;span class="w"&gt; &lt;/span&gt;POST&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="w"&gt;     &lt;/span&gt;--data&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;{&amp;quot;issue&amp;quot;: &amp;quot;[issue num]&amp;quot;, &amp;quot;head&amp;quot;: &amp;quot;[branch to merge from]&amp;quot;, &amp;quot;base&amp;quot;: &amp;quot;[branch to merge into]&amp;quot;}&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="w"&gt;     &lt;/span&gt;https://api.github.com/repos/&lt;span class="o"&gt;[&lt;/span&gt;user&lt;span class="o"&gt;]&lt;/span&gt;/&lt;span class="o"&gt;[&lt;/span&gt;repo&lt;span class="o"&gt;]&lt;/span&gt;/pulls
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;For example, to make &lt;code&gt;user1&lt;/code&gt; change issue 13 into a pull request to merge branch &lt;code&gt;test_branch&lt;/code&gt; into
&lt;code&gt;master&lt;/code&gt; in the &lt;code&gt;testing_repo&lt;/code&gt; repository belonging to &lt;code&gt;user2&lt;/code&gt;, the command would be:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;curl&lt;span class="w"&gt; &lt;/span&gt;--user&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;user1&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="w"&gt;     &lt;/span&gt;--request&lt;span class="w"&gt; &lt;/span&gt;POST&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="w"&gt;     &lt;/span&gt;--data&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;{&amp;quot;issue&amp;quot;: &amp;quot;13&amp;quot;, &amp;quot;head&amp;quot;: &amp;quot;test_branch&amp;quot;, &amp;quot;base&amp;quot;: &amp;quot;master&amp;quot;}&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="w"&gt;     &lt;/span&gt;https://api.github.com/repos/user2/testing_repo/pulls
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;To specify a fork of a repository to merge from, put the username followed by a semicolon in front
of the branch name like so: &lt;code&gt;"username:branch_name"&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;After running the command, you will be prompted for your GitHub password. Enter it and curl should
output the JSON response from the API. Make sure to check this response for errors!&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Tue, 26 Nov 2013 01:46:00 -0500</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2013-11-26:/blog/github-convert-issue-to-pull-request.html</guid><category>blog</category><category>code</category><category>git</category><category>shell script</category></item><item><title>Forcing a media refresh on Android with adb</title><link>https://cmetcalfe.ca/blog/forcing-a-media-refresh-on-android-with-adb.html</link><description>&lt;p&gt;Android will automatically perform a media refresh when an SD card is
mounted.&lt;/p&gt;
&lt;p&gt;Using &lt;a href="http://developer.android.com/tools/help/adb.html"&gt;adb&lt;/a&gt;, we can fake that event by manually sending a &lt;code&gt;MEDIA_MOUNTED&lt;/code&gt;
intent.&lt;/p&gt;
&lt;p&gt;For example, if you wanted to run a media refresh of the entire SD
card:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;adb&lt;span class="w"&gt; &lt;/span&gt;-d&lt;span class="w"&gt; &lt;/span&gt;shell&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;am broadcast -a android.intent.action.MEDIA_MOUNTED -d file:///sdcard&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;To refresh different directory, just change "/sdcard" to the absolute
path of the directory you want to refresh.&lt;/p&gt;
&lt;p&gt;For more fine-grained control, use the &lt;code&gt;MEDIA_SCANNER_SCAN_FILE&lt;/code&gt;
intent, which triggers a rescan of a single file.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Mon, 09 Sep 2013 18:52:00 -0400</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2013-09-09:/blog/forcing-a-media-refresh-on-android-with-adb.html</guid><category>blog</category><category>android</category></item><item><title>Installing Fehlstart - A simple, quick application launcher</title><link>https://cmetcalfe.ca/blog/installing-fehlstart-a-simple-quick-application-launcher.html</link><description>&lt;p&gt;&lt;a href="https://gitlab.com/fehlstart/fehlstart"&gt;Fehlstart&lt;/a&gt; is an application launcher, much like &lt;a href="http://www.launchy.net/"&gt;Launchy&lt;/a&gt;,
&lt;a href="http://qsapp.com/"&gt;Quicksilver&lt;/a&gt;, or &lt;a href="http://do.cooperteam.net/"&gt;GNOME Do&lt;/a&gt;. However, where other launchers focus
on adding features, Fehlstart is as basic as they come. If you want to
search for files or control your media player, look elsewhere. Felhstart
launches applications. Period.&lt;/p&gt;
&lt;p&gt;Fehlstart isn't in any major repositories so it has to be compiled from
source.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Install dependencies&lt;ul&gt;
&lt;li&gt;&lt;code&gt;git&lt;/code&gt;, &lt;code&gt;gcc&lt;/code&gt;, &lt;code&gt;make&lt;/code&gt;, &lt;code&gt;libgtk2.0-dev&lt;/code&gt;, &lt;code&gt;libkeybinder-dev&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;On most systems these packages will be available through your package manager&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Get the code&lt;ul&gt;
&lt;li&gt;&lt;code&gt;git clone https://gitlab.com/fehlstart/fehlstart.git&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Compile and install&lt;ul&gt;
&lt;li&gt;Navigate into the folder containing the code&lt;/li&gt;
&lt;li&gt;Run &lt;code&gt;make&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Run &lt;code&gt;make install&lt;/code&gt; (with the needed permissions)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Add &lt;code&gt;fehlstart&lt;/code&gt; to your window manager's autostart list&lt;/li&gt;
&lt;li&gt;Log out and back in to launch Fehlstart.&lt;/li&gt;
&lt;li&gt;Press the key combination &lt;code&gt;&amp;lt;Super&amp;gt;&lt;/code&gt; + &lt;code&gt;&amp;lt;Space&amp;gt;&lt;/code&gt; to bring up the
   launcher&lt;/li&gt;
&lt;li&gt;Type to search through the installed applications, then press
   &lt;code&gt;&amp;lt;Enter&amp;gt;&lt;/code&gt; to launch.&lt;/li&gt;
&lt;/ol&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Mon, 09 Sep 2013 18:51:00 -0400</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2013-09-09:/blog/installing-fehlstart-a-simple-quick-application-launcher.html</guid><category>blog</category><category>application</category><category>code</category></item><item><title>Gotcha with basic HTTP authentication in Python</title><link>https://cmetcalfe.ca/blog/gotcha-with-basic-http-authentication-with-python.html</link><description>&lt;p&gt;When doing basic HTTP authentication in Python, make sure your
authentication realm is surrounded by double, &lt;em&gt;NOT&lt;/em&gt; single quotes.&lt;/p&gt;
&lt;p&gt;Bad:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send_response&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;401&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send_header&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;WWW-Authenticate&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Basic realm=&amp;#39;/&amp;#39;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;end_headers&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Good:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send_response&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;401&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send_header&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;WWW-Authenticate&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Basic realm=&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s2"&gt;/&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;end_headers&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;The single quotes work with most browsers, curl, wget, and tons of other
tools. However, when using Python to access the page (using
&lt;a href="http://docs.python.org/2/library/urllib2.html#urllib2.HTTPPasswordMgrWithDefaultRealm"&gt;urllib2.HTTPPasswordMgrWithDefaultRealm&lt;/a&gt; to manage authentication)
single quotes don't trigger the "automatic retry with authentication"
response, and instead just raise a 401 &lt;code&gt;HTTPError&lt;/code&gt;.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Wed, 12 Jun 2013 19:53:00 -0400</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2013-06-12:/blog/gotcha-with-basic-http-authentication-with-python.html</guid><category>blog</category><category>code</category><category>python</category></item><item><title>Queen's University Resnet without IDA (Windows)</title><link>https://cmetcalfe.ca/blog/queens-university-resnet-without-ida-windows.html</link><description>&lt;h2&gt;Storytime&lt;/h2&gt;
&lt;p&gt;So you're in your first year at Queen's University residence and you
want to access the internet. Sounds reasonable. You plug in your Windows
laptop, open your browser, and...nothing. Well, mostly nothing. A page
that tells you that you've been quarantined and to please click here,
download IDA, install it, and let it work it's magic.&lt;/p&gt;
&lt;p&gt;Sounds easy right? What they don't tell you is that IDA holds ResNet
access hostage until you've installed some garbage antivirus, downloaded
all the new windows updates (IDA actually does this itself, it doesn't
step back and let Windows Update do it's job), and a few other things.
After all that, you enter your NetID and password, and it registers you.
In theory.&lt;/p&gt;
&lt;p&gt;What I ran into every single time I ran it with my laptop (running Windows
XP at the time) was it failing to download something, throwing an error
message and refusing to register me. I gave up after a few times and
plugged in my other computer (Running the relatively obscure Windows XP
x64). What I noticed is that I didn't get the typical quarantine page, I
got a simple page that asked for a NetID and password. I entered my
information and got a message stating I was good to go. I checked a few
pages and they all seemed to work.&lt;/p&gt;
&lt;p&gt;I plugged my laptop back in and tried to load a page. The same
quarantine screen. Since the main way a webpage tells the difference
between two operating systems is the user agent, I fired up &lt;a href="https://addons.mozilla.org/en-us/firefox/addon/tamper-data/"&gt;Tamper
Data&lt;/a&gt; and submitted a request with a blank one. I got the same page
that asked for my NetID and password.&lt;/p&gt;
&lt;p&gt;I assume this works because if the registration server decides (based on
your user agent) that IDA won't run on your computer, instead of leaving
you screwed, it'll give you an alternate way out. Since when you take
away the user agent the server can't tell what kind of operating system
you're running, they assume that IDA won't work on it and give you the
simple "Enter your account details" prompt.  &lt;/p&gt;
&lt;h2&gt;Register a computer without IDA&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Acquire unblocked internet (the queensu wireless is a good bet).&lt;/li&gt;
&lt;li&gt;Download and install &lt;a href="http://www.mozilla.org/firefox/"&gt;Firefox&lt;/a&gt; and the &lt;a href="https://addons.mozilla.org/en-us/firefox/addon/tamper-data/"&gt;Tamper Data&lt;/a&gt; addon.&lt;/li&gt;
&lt;li&gt;Disconnect from the internet and plug in to ResNet.&lt;/li&gt;
&lt;li&gt;In Firefox, click Tools,  Tamper Data.&lt;/li&gt;
&lt;li&gt;In the window that pops up, click "Start Tamper".&lt;/li&gt;
&lt;li&gt;Try to load a website.&lt;/li&gt;
&lt;li&gt;A window will pop up asking you if you want to tamper with the
    request. Click the "Tamper" option.&lt;/li&gt;
&lt;li&gt;In the windows that pops up, delete everything in the "User-Agent"
    field and hit OK.&lt;/li&gt;
&lt;li&gt;Repeat steps 8 and 9 until the popups stop and the page loads.&lt;/li&gt;
&lt;li&gt;Click "Stop Tamper" and close the Tamper Data window.&lt;/li&gt;
&lt;li&gt;You should be on a page that tells you to enter your NetID and
    password, do so and hit OK.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Your computer should now be able to use ResNet normally.&lt;/p&gt;
&lt;h2&gt;Registering other devices&lt;/h2&gt;
&lt;p&gt;Your computer is registered via it's MAC address. This means that if you
want to use ResNet with a device that can't run IDA, doesn't have a web
browser, and is against IT policy *cough* wireless router *cough*,
you can't. In theory.&lt;/p&gt;
&lt;p&gt;The easy way of course, it to call up ITS and tell them your Xbox can't
connect. They'll ask you for your Xbox's MAC address, you'll give them
the router's MAC address, and they'll register it. Aside from lying to
ITS being morally wrong, this works. However, I've heard complaints that
devices registered via calling ITS have had their speed throttled.
Throttling non-school-related devices on a school network makes sense,
but I haven't seen any actual proof of this.&lt;/p&gt;
&lt;p&gt;The better way of registering your other devices though, is to trick the
registration server into thinking that your device is just a normal
computer. Since computers are registered by their MAC addresses, you
just need to register the MAC address of your device with the system.&lt;/p&gt;
&lt;p&gt;The following steps will show you how to spoof your device's MAC address
and register it from your computer.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Find the MAC address of your device. It will probably be somewhere
    in the Advanced Options.&lt;/li&gt;
&lt;li&gt;Unplug your device from ResNet and plug in your computer.&lt;/li&gt;
&lt;li&gt;Open Control Panel, Network and Internet, Network Connections
    and note the name of your connection. Usually it's "Local Area
    Connection"&lt;/li&gt;
&lt;li&gt;Download and extract &lt;a href="http://devices.natetrue.com/macshift/"&gt;Macshift&lt;/a&gt; into a folder somewhere.&lt;/li&gt;
&lt;li&gt;Open a command prompt window in the Macshift folder.&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;In the command prompt window type&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;macshift.exe -i &amp;quot;[connection name]&amp;quot; [device MAC address, no dashes]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;For example, if my device's MAC address was "00-11-22-33-44-55" and my
connection name was "Local Area Connection", I would run&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;macshift.exe -i &amp;quot;Local Area Connection&amp;quot; 001122334455
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Wait until you have network access again and try to load a page. If
    everything went as planned, you should be seeing the ResNet
    quarantine page.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;Use the steps in the section above to register your computer again.&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Once you have ResNet access, go back to the command prompt and run&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;macshift.exe -i &amp;quot;[connection name]&amp;quot; -d
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;This restores your MAC address back to it's original value.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Your device should now be able to use ResNet normally.&lt;/p&gt;
&lt;h2&gt;Disclaimer&lt;/h2&gt;
&lt;p&gt;All information above is provided for informational purposes only. I
take no responsibility for the outcome of your actions. Furthermore, all
information on IDA is based on experiences in 2009, It may have
improved over time (ha).&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Tue, 07 May 2013 13:21:00 -0400</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2013-05-07:/blog/queens-university-resnet-without-ida-windows.html</guid><category>blog</category><category>queen's university</category><category>windows</category></item><item><title>Resolving Windows NetBIOS names in Linux</title><link>https://cmetcalfe.ca/blog/resolving-windows-netbios-names-in-linux.html</link><description>&lt;p&gt;When accessing computers on a LAN, it's often useful to access them by
name instead of IP. This is especially true when dealing with dynamic IP
addresses.&lt;/p&gt;
&lt;p&gt;In Windows, other Windows computer names are automatically resolved to
an IP address. In most Linux distros however, this is not the case (by default).&lt;/p&gt;
&lt;p&gt;To resolve Windows NetBIOS names in Linux, you'll need the &lt;a href="http://www.samba.org/samba/docs/man/manpages-3/winbindd.8.html"&gt;winbind&lt;/a&gt;
component of the &lt;a href="http://www.samba.org/"&gt;Samba suite&lt;/a&gt;. Winbind allows a UNIX box to become a
full member of an NT domain, giving the ability to resolve names from
it.&lt;/p&gt;
&lt;p&gt;Install winbind via your preferred package manager. For Debian and
derivatives, the following should work.   &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;apt-get install winbind
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Now that winbind is installed, the OS must be configured to use it when
looking up hostnames. Open the file &lt;code&gt;/etc/nsswitch.conf&lt;/code&gt; and add "wins"
to the end of the line starting with "hosts:".&lt;/p&gt;
&lt;p&gt;For example, the line in my file now looks like&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;hosts: files dns wins
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Save the file and reboot to start the winbindd deamon.&lt;/p&gt;
&lt;p&gt;To test if if worked, try pinging a computer on your LAN by name. For
example:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;
&lt;span class="normal"&gt;4&lt;/span&gt;
&lt;span class="normal"&gt;5&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$&lt;span class="w"&gt; &lt;/span&gt;ping&lt;span class="w"&gt; &lt;/span&gt;windows-server
PING&lt;span class="w"&gt; &lt;/span&gt;windows-server&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.0.107&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;56&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;84&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;of&lt;span class="w"&gt; &lt;/span&gt;data.
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.0.107:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_req&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;128&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;.268&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.0.107:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_req&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;128&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;.604&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;span class="m"&gt;64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;bytes&lt;span class="w"&gt; &lt;/span&gt;from&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.0.107:&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;icmp_req&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;128&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;.607&lt;span class="w"&gt; &lt;/span&gt;ms
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Sun, 17 Mar 2013 01:49:00 -0400</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2013-03-17:/blog/resolving-windows-netbios-names-in-linux.html</guid><category>blog</category><category>linux</category><category>windows</category></item><item><title>Vim: Search and replace in multiple files</title><link>https://cmetcalfe.ca/blog/vim-search-and-replace-in-multiple-files.html</link><description>&lt;p&gt;As is the way with &lt;a href="http://www.vim.org/"&gt;Vim&lt;/a&gt;, there are a ton of features, but stumbling
on the combination of commands that does what you want can be a bit
difficult sometimes. In this case, the objective is to perform a search
and replace over some files.&lt;/p&gt;
&lt;p&gt;This is done in two steps: loading up the files to process, then issuing
a command to run on each of the files.&lt;/p&gt;
&lt;p&gt;Load up the files to search using the &lt;code&gt;args&lt;/code&gt; command. This command
supports multiple arguments and can use bash-style path completion.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;:args src/*.cpp src/*.hpp README.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Perform a replace using sed-style syntax using the &lt;code&gt;argdo&lt;/code&gt; command. This
command iterates over all the files loaded by the &lt;code&gt;args&lt;/code&gt; command and
performs a command on them. In this case, it's performing the replace
operation.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;:argdo %s/FindMe/ReplaceWithMe/gec | update
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;The flags used in this case are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;g: global search (find more than a single occurance per line)&lt;/li&gt;
&lt;li&gt;e: suppress "string not found" error messages&lt;/li&gt;
&lt;li&gt;c: confirm each replace&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Running &lt;code&gt;update&lt;/code&gt; after the replace operation saves any changes to the
file before moving to the next one.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Mon, 27 Aug 2012 14:11:00 -0400</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2012-08-27:/blog/vim-search-and-replace-in-multiple-files.html</guid><category>blog</category><category>code</category><category>vim</category></item><item><title>How to download an entire Google Site</title><link>https://cmetcalfe.ca/blog/how-to-download-an-entire-google-site.html</link><description>&lt;p&gt;When using Google Sites, there is currently no way to make a backup of your
site, or download the site so you can host it on another server.  &lt;/p&gt;
&lt;p&gt;This command uses a tool called &lt;code&gt;wget&lt;/code&gt; to spider through a website
and download all the public files to the local computer. Unix users will
most likely have the wget tool already installed (if not, you can
install it via your preferred package manager), while Windows users can
get it from &lt;a href="http://gnuwin32.sourceforge.net/packages/wget.htm"&gt;here&lt;/a&gt;.  &lt;/p&gt;
&lt;p&gt;Once wget is installed, run it with the following parameters:  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;#Downloads all public pages on a Google Site&lt;/span&gt;

wget&lt;span class="w"&gt; &lt;/span&gt;-e&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;robots&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;off&lt;span class="w"&gt; &lt;/span&gt;-m&lt;span class="w"&gt; &lt;/span&gt;-k&lt;span class="w"&gt; &lt;/span&gt;-K&lt;span class="w"&gt; &lt;/span&gt;-E&lt;span class="w"&gt; &lt;/span&gt;-rH&lt;span class="w"&gt; &lt;/span&gt;-Dsites.google.com&lt;span class="w"&gt; &lt;/span&gt;http://sites.google.com/a/domain/site/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;This tells wget to spider through all the links on your site and download
the html files and linked content (such as images). Note that pages that
aren't linked from anywhere on the site won't be downloaded.&lt;/p&gt;
&lt;p&gt;This technique will also work for websites other than the ones hosted on Google Sites.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Thu, 16 Aug 2012 12:13:00 -0400</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2012-08-16:/blog/how-to-download-an-entire-google-site.html</guid><category>blog</category><category>website</category><category>shell script</category><category>backup</category></item><item><title>Backing up data to an external server via SSH</title><link>https://cmetcalfe.ca/blog/backing-up-data-to-an-external-server-via-ssh.html</link><description>&lt;p&gt;I recently needed to back up the contents of a website, but found that a
disk quota was preventing me from doing so. What I really needed to do
was find a way to compress all the files and, instead of storing the
archive locally, pipe the output to another server.  &lt;/p&gt;
&lt;p&gt;After much Googling and messing about, I ended up with the following
command:  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;
&lt;span class="normal"&gt;3&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;#Uses the tar utility to backup files to an external server&lt;/span&gt;

tar&lt;span class="w"&gt; &lt;/span&gt;zcvf&lt;span class="w"&gt; &lt;/span&gt;-&lt;span class="w"&gt; &lt;/span&gt;/path/to/backup&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;ssh&lt;span class="w"&gt; &lt;/span&gt;user@server:port&lt;span class="w"&gt; &lt;/span&gt;dd&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;of&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;filename.tgz&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;obs&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1024&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Of course, this is only practical for a one-off data dump. If regular
backups were needed, using &lt;a href="http://rsync.samba.org/"&gt;rsync&lt;/a&gt; would be the best option, as it
only transfers incremental changes. An excellent tutorial can be found
&lt;a href="http://troy.jdmz.net/rsync/index.html"&gt;here&lt;/a&gt;.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Thu, 16 Aug 2012 12:12:00 -0400</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2012-08-16:/blog/backing-up-data-to-an-external-server-via-ssh.html</guid><category>blog</category><category>linux</category><category>shell script</category><category>backup</category></item><item><title>How to set up Queen's University Webmail on an iPhone</title><link>https://cmetcalfe.ca/blog/how-to-set-up-queens-university-webmail-on-an-iphone.html</link><description>&lt;p&gt;Before you start, make sure the iPhone is connected to the internet via 3G or WiFi.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Navigate to the main settings screen&lt;/li&gt;
&lt;li&gt;Tap "Mail, Contacts, Calendars"&lt;/li&gt;
&lt;li&gt;Tap "Add Account..."&lt;/li&gt;
&lt;li&gt;Tap "Other"&lt;/li&gt;
&lt;li&gt;Tap "Add Mail Account"&lt;/li&gt;
&lt;li&gt;Enter your name, the address of the account you want to access
    ([your NetID]@queensu.ca), your password, and an optional description&lt;/li&gt;
&lt;li&gt;Tap "Save"&lt;/li&gt;
&lt;li&gt;Tap "IMAP"&lt;/li&gt;
&lt;li&gt;Scroll down to "Incoming Mail Server" and enter the following info:&lt;ul&gt;
&lt;li&gt;Host Name: mail.queensu.ca&lt;/li&gt;
&lt;li&gt;User Name: [your NetID]&lt;/li&gt;
&lt;li&gt;Password: [your password]&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Scroll down to "Outgoing Mail Server" and enter the following info:  &lt;ul&gt;
&lt;li&gt;Host Name: mail.queensu.ca:465&lt;/li&gt;
&lt;li&gt;User Name: [your NetID]&lt;/li&gt;
&lt;li&gt;Password: [your password]&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Save and exit.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Good Luck!&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Thu, 16 Aug 2012 11:55:00 -0400</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2012-08-16:/blog/how-to-set-up-queens-university-webmail-on-an-iphone.html</guid><category>blog</category><category>email</category><category>iphone</category><category>queen's university</category></item><item><title>Setting up TortiseHg on Windows</title><link>https://cmetcalfe.ca/blog/setting-up-tortisehg-on-windows.html</link><description>&lt;p&gt;TortiseHg can be a bit of a pain to set up if you don't want to
have&lt;a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html"&gt;peagent&lt;/a&gt; running in the background all the time for
authentication. This method uses TortisePlink (comes with the install)
for authentication, and runs it only when it needs to authenticate.  &lt;/p&gt;
&lt;h2&gt;Generating a public/private key pair&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Download &lt;a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html"&gt;PuTTYgen&lt;/a&gt; and run it.&lt;/li&gt;
&lt;li&gt;Generate the key pair by clicking the generate button.&lt;/li&gt;
&lt;li&gt;Optionally, enter a passphrase to protect the private key.&lt;/li&gt;
&lt;li&gt;Save the public and private keys somewhere. I prefer to save them as
   &lt;code&gt;id_rsa.pub&lt;/code&gt; and &lt;code&gt;id_rsa.ppk&lt;/code&gt; in &lt;code&gt;C:/Users/[username]/.ssh/&lt;/code&gt; but it
   doesn't really matter.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Setting up TortiseHg&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Download &lt;a href="http://tortoisehg.bitbucket.org/download/index.html"&gt;TortiseHg&lt;/a&gt; and install it.&lt;/li&gt;
&lt;li&gt;When installing, make sure that SSH Utils are installed.&lt;/li&gt;
&lt;li&gt;When it finishes installing, run the program (it'll be called
   "TortiseHg Workbench" in the start menu).&lt;/li&gt;
&lt;li&gt;Configure the settings as you see fit. This will generate a
   configuration file at &lt;code&gt;C:/Users/[username]/mercurial.ini&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Close the program and open up &lt;code&gt;mercurial.ini&lt;/code&gt; in a text editor.&lt;/li&gt;
&lt;li&gt;Under the "[ui]" section (if it doesn't exist, create it) add/edit two
   entries (adjusting for your own custom settings):&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;table class="highlighttable"&gt;&lt;tr&gt;&lt;td class="linenos"&gt;&lt;div class="linenodiv"&gt;&lt;pre&gt;&lt;span class="normal"&gt;1&lt;/span&gt;
&lt;span class="normal"&gt;2&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;td class="code"&gt;&lt;div&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;username = [name] &amp;lt;[email]@[domain]&amp;gt;
ssh = &amp;quot;C:\\Program Files\\TortoiseHg\\TortoisePlink.exe&amp;quot; -i &amp;quot;C:\\Users\\[username]\\.ssh\\id_rsa.ppk&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;

&lt;p&gt;Now all that's needed is to upload the generated public key to the
server(s) you wish to pull from or push to.&lt;/p&gt;
&lt;p&gt;When asked, just open the
key up in a text editor (make sure it's the public key, NEVER share your
private key) and copy-paste the text.&lt;/p&gt;
&lt;p&gt;After configuring this, you'll be able to push to repositories on the
servers you give your public key to, without having to enter your password every time.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Sat, 26 May 2012 20:47:00 -0400</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2012-05-26:/blog/setting-up-tortisehg-on-windows.html</guid><category>blog</category><category>code</category><category>windows</category><category>mercurial</category></item><item><title>Sending a file via a P2P connection in a web browser</title><link>https://cmetcalfe.ca/blog/sending-a-file-via-a-p2p-connection-in-a-web-browser.html</link><description>&lt;p&gt;&lt;a href="https://www.sharefest.me/"&gt;Sharefest&lt;/a&gt; is a site that allows users to send files of arbitrary size
via a P2P connection. To use it, go to the site, select a file to share,
then give the link to friend. All they have to do is visit the URL and
they'll be able to download the file you shared.&lt;/p&gt;
&lt;p&gt;This transfer is directly from your computer to theirs, without the file
being uploaded anywhere between. This also makes it easy to stop sharing the
file. Just close the browser window and the file becomes inaccessable.&lt;/p&gt;
&lt;p&gt;Sharefest is open-source! Check out the code on &lt;a href="https://github.com/Peer5/ShareFest/"&gt;GitHub&lt;/a&gt;.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Sat, 26 May 2012 20:40:00 -0400</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2012-05-26:/blog/sending-a-file-via-a-p2p-connection-in-a-web-browser.html</guid><category>blog</category><category>website</category></item><item><title>Backup/Restore a Gmail account</title><link>https://cmetcalfe.ca/blog/back-up-restore-a-gmail-account.html</link><description>&lt;p&gt;&lt;a href="http://gmvault.org/"&gt;Gmvault&lt;/a&gt; is an &lt;a href="https://github.com/gaubert/gmvault/"&gt;open source&lt;/a&gt; project that allows users to download all of
their emails, as well as the labels.&lt;/p&gt;
&lt;p&gt;From there it's as simple as opening them up in a program like &lt;a href="http://office.microsoft.com/en-us/outlook/"&gt;Outlook&lt;/a&gt; or
&lt;a href="http://www.mozilla.org/en-US/thunderbird/"&gt;Thunderbird&lt;/a&gt; to view them. It also includes an option to restore the emails.&lt;/p&gt;
&lt;p&gt;Most email clients have the capability of doing this, but this was by far the
quickest way. Automatic incremental backups can also be done by running a
'quick sync' regularly.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Sat, 11 Feb 2012 22:08:00 -0500</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2012-02-11:/blog/back-up-restore-a-gmail-account.html</guid><category>blog</category><category>application</category><category>backup</category><category>email</category></item><item><title>How keyboard media keys work</title><link>https://cmetcalfe.ca/blog/changing-media-key-behaviours.html</link><description>&lt;p&gt;A recent project of mine involved tearing apart an old keyboard (a &lt;a href="http://i.imgur.com/dWBnR.jpg"&gt;Dell
Y-UK-DEL1&lt;/a&gt;) and using the media keys to make a simple media controller box.  &lt;/p&gt;
&lt;p&gt;Everything went smoothly with the build, but when I plugged it in, the
music media key launched &lt;a href="http://www.videolan.org/vlc/"&gt;VLC&lt;/a&gt; instead of my preferred player, &lt;a href="http://www.foobar2000.org/"&gt;foobar2000&lt;/a&gt;.
After spending a while in the control panel looking for how to change this behavour
and finding nothing, I used &lt;a href="http://technet.microsoft.com/en-us/sysinternals/bb896653"&gt;Process Explorer&lt;/a&gt; to trace the registry key
it was using to determine which application to launch.  &lt;/p&gt;
&lt;p&gt;Turns out, the registry keys in
&lt;code&gt;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\AppKey&lt;/code&gt;
store the information regarding what program gets launched when a media key is pressed.&lt;/p&gt;
&lt;p&gt;In this location there are a bunch of keys that map button IDs to file associations.
This is done by looking up the button ID when the button is pressed, then looking at
the contents of the string called "Association" in the button ID's key.&lt;/p&gt;
&lt;p&gt;With my keyboard, the music media key maps to button 16. On my system, within the
key called "16", there is a string value called "Association". This was set to the
".cda" extension, which is associated with VLC. After changing the ".cda" association
to open using foobar2000, whenever I press the music key on my media controller, foobar2000 opens.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Carey Metcalfe</dc:creator><pubDate>Sat, 11 Feb 2012 22:05:00 -0500</pubDate><guid isPermaLink="false">tag:cmetcalfe.ca,2012-02-11:/blog/changing-media-key-behaviours.html</guid><category>blog</category><category>windows</category></item></channel></rss>