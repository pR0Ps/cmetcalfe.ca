<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Carey Metcalfe">
  <meta name="description" content="Posts by Carey Metcalfe">

  <link rel="stylesheet" type="text/css" href="../theme/css/styles.425931e9.min.css">

  <script src="../theme/js/scripts.ab06d70e.min.js" type="text/javascript"></script>

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">

  <link href="https://cmetcalfe.ca/feeds/all.rss" type="application/rss+xml" rel="alternate" title="Carey Metcalfe Full RSS Feed" />

  <meta name="keywords" content="blog, carey, cmetcalfe, metcalfe, pr0ps, pr0pscm, android, application, automation, backup, chromecast, code, data recovery, electronics, email, games, git, hardware, iphone, let's encrypt, linux, macOS, mercurial, networking, png, proxmox, python, queen's university, router, security, shell script, sites, steam, vim, website, windows, wine">

  <title>Blog | Carey Metcalfe</title>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-28306875-1', 'cmetcalfe.ca');
  ga('send', 'pageview');
</script>
</head>

<body>
  <aside>
    <div id="user_meta">
      <a href="..">
        <img src="/images/avatar.jpg" id="logo">
      </a>
      <h2><a href=".." class="nohover">Carey Metcalfe</a></h2>
      <p>Software Developer</p>
      <div class="social">
          <a data-email="ac.eflactemc@yerac:otliam" data-title="Email" title="You need javascript enabled to view this email" class="email" target="_blank" rel="noopener noreferrer"><i class="fa fa-envelope fa-lg"></i></a>
          <a href="https://github.com/pR0Ps" title="GitHub" target="_blank" rel="noopener noreferrer"><i class="fa fa-github fa-lg"></i></a>
          <a href="https://twitter.com/CareyMetcalfe" title="Twitter" target="_blank" rel="noopener noreferrer"><i class="fa fa-twitter fa-lg"></i></a>
      </div>
      <ul>
      </ul>
    </div>
  </aside>

  <main id="main">
    <header>
      <p id="header">
      <a href="..">Home</a>

      &#124; <a href="../blog/index.html">Blog</a>
      &#124; <a href="https://cmetcalfe.ca/feeds/all.rss">RSS Feed</a>
      </p>
<p>
<a href="../blog/index.html">Posts</a>
&#124; <a href="../blog/tags/">Tags</a>
&#124; <a href="../blog/archives.html">Archive</a>
</p>    </header>

<article>
  <div class="article_title">
    <h1><a href="../blog/reinstall-android-app-without-losing-data.html">Reinstalling an Android app without losing data</a></h1>
  </div>
  <div class="article_text">
    <p>When an application isn't opening (and clearing the cache doesn't help) it
sometimes helps to reinstall it. However, uninstalling then reinstalling the
app normally will delete all the data associated with it.</p>
<p>The way around this is to directly call the package manager from the shell and
give it the <code>-k</code> argument, which tells it to keep the data and cache directories.</p>
<p>Simply connect the device to a computer with <a href="http://developer.android.com/tools/help/adb.html">ADB</a> installed and run:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>adb -d shell <span class="s2">&quot;pm uninstall -k com.package.name&quot;</span>
</code></pre></div>
</td></tr></table>
<p>Then just reinstall the app (either from an apk file or the <a href="https://play.google.com/store">Play Store</a>) and
the app will be back with all of its data intact.</p>
  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="../blog/git-checkout-autocomplete-local-branches-only.html">Git checkout - autocomplete local branches only</a></h1>
  </div>
  <div class="article_text">
    <p>Having Git autocomplete branch names when doing a checkout is super useful.  Having the autocomplete
hang for 30 seconds because it has to look up all 3000 of the remote branches in a massive repo is
not so useful. It's actually pretty frustrating.</p>
<p>My solution: changing the <code>git checkout</code> autocomplete to only look at local branches, while using a
<code>git checkoutr</code> alias to preserve the original behaviour (because sometimes it's actually needed).</p>
<p>How it's done:</p>
<h2>Define an alias for checkout</h2>
<p>We're going to use the same checkout command for the remote checkout, but need to have a different
command so the script can differentiate between them.  Making an alias does exactly this.</p>
<p>Create the alias by running <code>git config --global alias.checkoutr checkout</code></p>
<h2>Change the autocompletion function</h2>
<p>The checkout autocomplete behaviour is defined in a function called <code>_git_checkout</code> in the git
autocompletion file. We're going to override the function with our own version that has different
autocomplete logic in it.</p>
<p>The location of the file varies over different operating systems and configurations, but here are a
few spots to look:</p>
<ul>
<li><code>/etc/bash_completion.d/git</code></li>
<li><code>/usr/share/bash-completion/completions/git</code></li>
</ul>
<p>For a brew-installed git autocomplete on macOS, the file will probably be
<code>$(brew --prefix)/etc/bash_completion.d/git-completion.bash</code></p>
<p>Once you've found the file, copy the entire <code>_git_checkout</code> function into your <code>.bashrc</code> (or
equivalent non-login shell startup script). Now look for the line</p>
<p><code>__git_complete_refs $track_opt</code></p>
<p>We're going to replace that line with:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$command</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;checkoutr&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    __git_complete_refs <span class="nv">$track_opt</span>
<span class="k">else</span>
    __gitcomp_direct <span class="s2">&quot;</span><span class="k">$(</span>__git_heads <span class="s2">&quot;&quot;</span> <span class="s2">&quot;</span><span class="nv">$cur</span><span class="s2">&quot;</span> <span class="s2">&quot; &quot;</span><span class="k">)</span><span class="s2">&quot;</span>
<span class="k">fi</span>
</code></pre></div>
</td></tr></table>
<p>After saving and re-sourcing your <code>.bashrc</code> file, git will autocomplete local branches and tags when
using <code>git checkout</code>, but will go back to the default behaviour of autocompleting all references
when using <code>git checkoutr</code>.</p>
<p>Credits to a combination of answers on <a href="disable-auto-completion-of-remote-branches-in-git-bash">this</a> StackOverflow post.</p>
<p>EDIT 2017-10-02: Updated to work with <a href="https://github.com/git/git/commit/15b4a163950c2e8660a7797ce3975ccea8705f80#diff-f37c4f4a898819f0ca4b5ff69e81d4d9">git v2.13.0</a> thanks to <a href="https://gist.github.com/mmrko/b3ec6da9bea172cdb6bd83bdf95ee817#gistcomment-2218059">Alexander Ko's comment</a>.<br>
EDIT 2018-03-24: Updated to <a href="https://github.com/git/git/commit/227307a639c96b3579b7fe60840fdae123d1ee88">speed up branch and tag completion</a>.</p>
  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="../blog/preserving-xposed-framework-through-a-flash.html">Preserving the Xposed Framework through a ROM flash</a></h1>
  </div>
  <div class="article_text">
    <p>The <a href="https://repo.xposed.info/">Xposed Framework</a> is a neat Android program that enables <a href="https://repo.xposed.info/module-overview">user-made
modules</a> to change the behaviour of the lower-level Android OS. It does this
by modifying <code>/system/bin/app_process</code> to add some hooks into it.</p>
<p>The issue is that when flashing a new ROM, the modified <code>app_process</code> is
reverted back to the original version, disabling the Xposed Framework until it's
restored.</p>
<div class="admonition update">
<p class="admonition-title">Update</p>
<p>The Xposed Framework installer now includes the option to flash a zip file
to install the framework instead of patching <code>app_process</code> directly. The
method detailed in this post will still work, but the new way to make sure
the framework is installed after flashing a new ROM is to simply flash the
Xposed installer zip right after flashing the ROM.</p>
</div>
<p>The solution to this is a script that will automatically back up the existing
<code>app_process</code> before a flash, then restore it after the flash completes.</p>
<p>The <a href="../files/90-xposed.sh">90-xposed.sh</a> script does exactly that. To enable it, download it to the
Android device, move it to <code>/system/addon.d/90-xposed.sh</code>, and give it
executable permissions.</p>
<p>This can be done on the device with a few different programs, but it's much
easier to do from a computer with <a href="https://developer.android.com/tools/help/adb.html">adb</a>.</p>
<p>Download the script and push it to the SD card of the Android device with</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>adb push <span class="m">90</span>-xposed.sh /sdcard/
</code></pre></div>
</td></tr></table>
<p>Once the file is on the device, log into it (using <code>adb shell</code>) and run the
following commands:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>su  <span class="c1"># Get root permissions</span>
cp /sdcard/90-xposed.sh /system/addon.d/  <span class="c1"># Copy the file to the correct folder</span>
chmod <span class="m">755</span> /system/addon.d/90-xposed.sh  <span class="c1"># Make the file executable</span>
</code></pre></div>
</td></tr></table>
<p>After logging out of the device, the Xposed framework will stay installed and
active even after flashing a new ROM. Note that this should only really be
used in situations where the ROM isn't changing too much (like flashing a new
nightly ROM).</p>
<p>In situations where <code>app_process</code> would actually be changed by the flash, this
script could cause issues as it would restore an incorrect version of the file.
If this happens, delete <code>app_process</code> and <code>app_process.orig</code> in the
<code>/system/bin/</code> directory, then reflash. The script won't interfere, allowing
the flash to update <code>app_process</code> to the correct version. After rebooting,
install the Xposed Framework again.</p>
  </div>
</article>

<footer>
<div id="paginator">
  <span id="left">
      <a href="../blog/index5.html"><i class="fa fa-arrow-circle-left"></i> Prev</a>
  </span>
  <span id="right">
      <a href="../blog/index7.html">Next <i class="fa fa-arrow-circle-right"></i></a>
  </span>
  <div>
      <a href="../blog/index.html"> 1 </a>
      <a href="../blog/index2.html"> 2 </a>
      <a href="../blog/index3.html"> 3 </a>
      <a href="../blog/index4.html"> 4 </a>
      <a href="../blog/index5.html"> 5 </a>
      <a href="../blog/index6.html">[6]</a>
      <a href="../blog/index7.html"> 7 </a>
      <a href="../blog/index8.html"> 8 </a>
      <a href="../blog/index9.html"> 9 </a>
      <a href="../blog/index10.html"> 10 </a>
      <a href="../blog/index11.html"> 11 </a>
      <a href="../blog/index12.html"> 12 </a>
  </div>
</div>
</footer>

    <div id="ending_message">
        <p>&copy; Carey Metcalfe. Built using <a href="http://getpelican.com">Pelican</a>. Theme is <a href="https://github.com/pR0Ps/pelican-subtle">subtle</a> by <a href="http://cmetcalfe.ca">Carey Metcalfe</a>. Based on <a href="https://github.com/giulivo/pelican-svbhack">svbhack</a> by Giulio Fidente.</p>
    </div>
  </main>

  <script type="text/javascript">
    window.addEventListener('load', skipHeader)
  </script>

  <script type="text/javascript">
  window.addEventListener('load', unmangleEmail)
  </script>
</body>
</html>