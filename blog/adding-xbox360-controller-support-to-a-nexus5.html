<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Carey Metcalfe">
  <meta name="description" content="Adding Xbox 360 controller support to a Nexus 5 | Update CyanogenMod has effectively been replaced by LineageOS. The links in this article originally all...">

  <link rel="stylesheet" type="text/css" href="../theme/css/styles.425931e9.min.css">

  <script src="../theme/js/scripts.ab06d70e.min.js" type="text/javascript"></script>

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">

  <link href="https://cmetcalfe.ca/feeds/all.rss" type="application/rss+xml" rel="alternate" title="Carey Metcalfe Full RSS Feed" />

<meta name="keywords" content="blog, carey, cmetcalfe, metcalfe, pr0ps, pr0pscm, android">

  <title>Adding Xbox 360 controller support to a Nexus 5 | Carey Metcalfe</title>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-28306875-1', 'cmetcalfe.ca');
  ga('send', 'pageview');
</script>
</head>

<body>
  <aside>
    <div id="user_meta">
      <a href="..">
        <img src="/images/avatar.jpg" id="logo">
      </a>
      <h2><a href=".." class="nohover">Carey Metcalfe</a></h2>
      <p>Software Developer</p>
      <div class="social">
          <a data-email="ac.eflactemc@yerac:otliam" data-title="Email" title="You need javascript enabled to view this email" class="email" target="_blank" rel="noopener noreferrer"><i class="fa fa-envelope fa-lg"></i></a>
          <a href="https://github.com/pR0Ps" title="GitHub" target="_blank" rel="noopener noreferrer"><i class="fa fa-github fa-lg"></i></a>
          <a href="https://twitter.com/CareyMetcalfe" title="Twitter" target="_blank" rel="noopener noreferrer"><i class="fa fa-twitter fa-lg"></i></a>
      </div>
      <ul>
      </ul>
    </div>
  </aside>

  <main id="main">
    <header>
      <p id="header">
      <a href="..">Home</a>

      &#124; <a href="../blog/index.html">Blog</a>
      &#124; <a href="https://cmetcalfe.ca/feeds/all.rss">RSS Feed</a>
      </p>
<p>
<a href="../blog/index.html">Posts</a>
&#124; <a href="../blog/tags/">Tags</a>
&#124; <a href="../blog/archives.html">Archive</a>
</p>    </header>

<article>
  <div class="article_title">
    <h1><a href="../blog/adding-xbox360-controller-support-to-a-nexus5.html" class="nohover">Adding Xbox 360 controller support to a Nexus 5</a></h1>
  </div>
  <div class="article_text">
    <div class="admonition update">
<p class="admonition-title">Update</p>
<p>CyanogenMod has effectively been replaced by <a href="https://lineageos.org/">LineageOS</a>. The links in this article originally
all pointed to CyanogenMod but since it no longer exists, I've updated them to use the LineageOS
equivilents where possible. The instructions will also need to be slightly modified for use with
LineageOS builds.</p>
</div>
<h2>Introduction</h2>
<p>I finally just bought a new phone (a <a href="http://en.wikipedia.org/wiki/Nexus_5">Nexus 5</a>), and after flashing <a href="https://en.wikipedia.org/wiki/CyanogenMod">CyanogenMod</a> onto it, I've
been messing around with its <a href="http://en.wikipedia.org/wiki/USB_On-The-Go">OTG</a> support. My old phone (a <a href="http://en.wikipedia.org/wiki/Nexus_4">Nexus 4</a>) <a href="http://blog.gsmarena.com/nexus-4-does-not-support-usb-otg-despite-google-saying-otherwise/">didn't have the
capability</a> so being able to plug in keyboards, mice, external hard drives, and various other
peripherals was (embarrassingly enough) a thrill.</p>
<p>Keyboards worked, mice worked, but when an Xbox 360 controller was plugged in, nothing happened.
Turns out that while the kernel didn't have support for it enabled out of the box, getting it
enabled and pushing the change upstream into the CyanogenMod project was easier than I thought.</p>
<p>Beware that this post is going to be more of a record of what I did so that I can do it again and
less of a coherent tutorial.</p>
<h2>Building CyanogenMod</h2>
<p>First step was to download and compile CyanogenMod for my phone. I'm not going to go into this in
any detail on this because there's already a <a href="https://web.archive.org/web/20161224200646/https://wiki.cyanogenmod.org/w/Development">good overview</a> on the CyanogenMod wiki that covers
the entire process, as well as a <a href="https://wiki.lineageos.org/devices/hammerhead/build">customized guide for the Nexus 5</a>. If those articles are
followed correctly, you should be able to build a fresh CyanogenMod image with:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>brunch hammerhead
</code></pre></div>
</td></tr></table>
<h2>Enabling the kernel module</h2>
<p>Once the image was flashed to the phone and verified to be working, the next step was to enable the
<a href="https://www.kernel.org/doc/html/v4.16/input/devices/xpad.html">xpad kernel module</a>.</p>
<p>Copy current kernel config to the kernel directory for editing:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nb">cd</span> &lt;build dir&gt;/kernel/lge/hammerhead/
cp arch/arm/configs/cyanogenmod_hammerhead_defconfig .config
</code></pre></div>
</td></tr></table>
<p>Edit the config:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>make menuconfig <span class="nv">ARCH</span><span class="o">=</span>arm
</code></pre></div>
</td></tr></table>
<p>At this point, a menu will come up. Search for <code>xpad</code> (type <code>/xpad</code>), and take note of the paths.
<code>ESC</code> out of the search, navigate the tree and enable the modules found with the search. Save and
exit.</p>
<p>Copy the config back and clean up any stray <code>*.o</code> files:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>cp .config arch/arm/configs/cyanogenmod_hammerhead_defconfig
make mrproper
</code></pre></div>
</td></tr></table>
<p>After enabling the module, rebuild CyanogenMod using the normal <code>brunch hammerhead</code> and flash it to
the phone.</p>
<h2>Submitting the change upstream</h2>
<p>Since Xbox controller support had already been requested in <del><a href="https://jira.cyanogenmod.org/browse/CYAN-4469">a JIRA ticket</a></del>(dead link), I went
through the process to submit <a href="https://review.lineageos.org/#/c/LineageOS/android_kernel_lge_hammerhead/+/87409/">the change</a> on the CyanogenMod Gerrit instance for inclusion in the
next release. There's a guide for this <a href="https://wiki.lineageos.org/submitting-patch-howto.html">here</a>. As well as the guide, I found the people in
<a href="https://webchat.freenode.net/?channels=#cyanogenmod-dev">#cyanogenmod-dev on Freenode</a> to be very helpful.</p>
<p>A short while after submitting <a href="https://review.lineageos.org/#/c/LineageOS/android_kernel_lge_hammerhead/+/87409/">the change</a> to Gerrit, it was merged into the <code>cm-11.0</code> branch as
commit <a href="https://github.com/LineageOS/android_kernel_lge_hammerhead/commit/7ef4f6a87cc114b5010b623d72840b1d38ea01ed"><code>i7ef4f6a</code></a> and pushed out in the next nightly build (<a href="../images/cyanogenmod-changelog-xbox-support.png">changelog screenshot</a>).</p>
<h2>Wrap-up</h2>
<p>It feels great to be able to contribute to an amazing open source project that had <a href="https://twitter.com/CyanogenMod/status/157378138802888704">at least a
million people</a> using it at one point or another. I recognize that the change by itself was just
changing a config file to enable functionality that already existed, but it's helped me get through
some of the non-coding hurdles of contributing to an Android fork like CyanogenMod (adb, fastboot,
unlocking and rooting phones, compiling AOSP, flashing images, the contribution process, etc). This
time the actual contribution itself was minor, but it's gotten me more familier with the process,
hopefully making it easier to contribute something more substantial in the future.</p>
<p>In the end, I learned a lot about Android development and how all the different pieces that I had
read about at one point or another actually fit together. During the whole process I also lost a lot
of the fear I had about messing with phones and other more expensive locked down devices. Going
forward, I'm going to attempt to compile and flash open source operating systems like CyanogenMod
onto more devices that I own. I like being able to tweak things and feel like I really own them,
hardware and software.</p>
  </div>
<div class="article_meta">
  <p>Posted <time data-timeago datetime="2015-01-14T20:26:00-05:00">Jan 14, 2015</time>
   by Carey Metcalfe  </p>
  <p>Last updated <time data-timeago datetime="2018-09-11T14:30:00-04:00">Sep 11, 2018</time></p>
  <p>
  Tags:
    <a href="../blog/tags/android.html">android</a>  </p>
</div>
  <div id="article_comments">
    <div id="disqus_thread">
      <a href="javascript:loadDisqus()"><i class="fa fa-comments fa-lg"></i>Click to load <span class="disqus-comment-count" data-disqus-identifier="blog/adding-xbox360-controller-support-to-a-nexus5.html">comments</span></a>
    </div>
  </div>

  <script id="dsq-count-scr" src="https://cmetcalfe.disqus.com/count.js" async></script>
  <script type="text/javascript">
    var disqus_config = function () {
        this.page.identifier = "blog/adding-xbox360-controller-support-to-a-nexus5.html";
        this.page.title = "Adding Xbox 360 controller support to a Nexus 5";
    };
    loadDisqus = function(sitename) {
      var d = document, s = d.createElement('script');
      s.src = 'https://cmetcalfe.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    };
  </script>
</article>


    <div id="ending_message">
        <p>&copy; Carey Metcalfe. Built using <a href="http://getpelican.com">Pelican</a>. Theme is <a href="https://github.com/pR0Ps/pelican-subtle">subtle</a> by <a href="http://cmetcalfe.ca">Carey Metcalfe</a>. Based on <a href="https://github.com/giulivo/pelican-svbhack">svbhack</a> by Giulio Fidente.</p>
    </div>
  </main>

  <script type="text/javascript">
    window.addEventListener('load', skipHeader)
  </script>

  <script type="text/javascript">
  window.addEventListener('load', unmangleEmail)
  </script>

<script type="text/javascript">window.addEventListener("load", lw_timeago);</script>
</body>
</html>