<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Carey Metcalfe">
  <meta name="description" content="Git checkout - autocomplete local branches only | Having Git autocomplete branch names when doing a checkout is super useful. Having the autocomplete...">

  <link rel="stylesheet" type="text/css" href="../theme/css/styles.ec0bdb0f.min.css">

  <script src="../theme/js/scripts.7db5858b.min.js" type="text/javascript"></script>

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">

  <link href="https://cmetcalfe.ca/feeds/all.rss" type="application/rss+xml" rel="alternate" title="Carey Metcalfe Full RSS Feed" />

<meta name="keywords" content="blog, carey, cmetcalfe, metcalfe, pr0ps, pr0pscm, git, shell script">

  <title>Git checkout - autocomplete local branches only | Carey Metcalfe</title>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-DXC76BHD2F"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-DXC76BHD2F');
</script>
</head>

<body>
  <aside>
    <div id="user_meta">
      <a href="..">
        <img src="/images/avatar.jpg" id="logo">
      </a>
      <h2><a href=".." class="nohover">Carey Metcalfe</a></h2>
      <p>Software Developer</p>
      <div class="social">
          <a data-email="ac.eflactemc@yerac:otliam" data-title="Email" title="You need javascript enabled to view this email" class="email" target="_blank" rel="noopener noreferrer"><i class="fa fa-envelope fa-lg"></i></a>
          <a href="https://github.com/pR0Ps" title="GitHub" target="_blank" rel="noopener noreferrer"><i class="fa fa-github fa-lg"></i></a>
          <a href="https://twitter.com/CareyMetcalfe" title="Twitter" target="_blank" rel="noopener noreferrer"><i class="fa fa-twitter fa-lg"></i></a>
      </div>
      <ul>
      </ul>
    </div>
  </aside>

  <main id="main">
    <header>
      <p id="header">
      <a href="..">Home</a>

      &#124; <a href="../blog/index.html">Blog</a>
      &#124; <a href="https://cmetcalfe.ca/feeds/all.rss">RSS Feed</a>
      </p>
<p>
<a href="../blog/index.html">Posts</a>
&#124; <a href="../blog/tags/">Tags</a>
&#124; <a href="../blog/archives.html">Archive</a>
</p>    </header>

<article>
  <div class="article_title">
    <h1><a href="../blog/git-checkout-autocomplete-local-branches-only.html" class="nohover">Git checkout - autocomplete local branches only</a></h1>
  </div>
  <div class="article_text">
    <p>Having Git autocomplete branch names when doing a checkout is super useful.  Having the autocomplete
hang for 30 seconds because it has to look up all 3000 of the remote branches in a massive repo is
not so useful. It's actually pretty frustrating.</p>
<p>My solution: changing the <code>git checkout</code> autocomplete to only look at local branches, while using a
<code>git checkoutr</code> alias to preserve the original behaviour (because sometimes it's actually needed).</p>
<p>How it's done:</p>
<h2>Define an alias for checkout</h2>
<p>We're going to use the same checkout command for the remote checkout, but need to have a different
command so the script can differentiate between them.  Making an alias does exactly this.</p>
<p>Create the alias by running <code>git config --global alias.checkoutr checkout</code></p>
<h2>Change the autocompletion function</h2>
<p>The checkout autocomplete behaviour is defined in a function called <code>_git_checkout</code> in the git
autocompletion file. We're going to override the function with our own version that has different
autocomplete logic in it.</p>
<p>The location of the file varies over different operating systems and configurations, but here are a
few spots to look:</p>
<ul>
<li><code>/etc/bash_completion.d/git</code></li>
<li><code>/usr/share/bash-completion/completions/git</code></li>
</ul>
<p>For a brew-installed git autocomplete on macOS, the file will probably be
<code>$(brew --prefix)/etc/bash_completion.d/git-completion.bash</code></p>
<p>Once you've found the file, copy the entire <code>_git_checkout</code> function into your <code>.bashrc</code> (or
equivalent non-login shell startup script). Now look for the line</p>
<p><code>__git_complete_refs $track_opt</code></p>
<p>We're going to replace that line with:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$command</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;checkoutr&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span>__git_complete_refs<span class="w"> </span><span class="nv">$track_opt</span>
<span class="k">else</span>
<span class="w">    </span>__gitcomp_direct<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>__git_heads<span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$cur</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="k">)</span><span class="s2">&quot;</span>
<span class="k">fi</span>
</code></pre></div></td></tr></table></div>

<p>After saving and re-sourcing your <code>.bashrc</code> file, git will autocomplete local branches and tags when
using <code>git checkout</code>, but will go back to the default behaviour of autocompleting all references
when using <code>git checkoutr</code>.</p>
<p>Credits to a combination of answers on <a href="disable-auto-completion-of-remote-branches-in-git-bash">this</a> StackOverflow post.</p>
<p>EDIT 2017-10-02: Updated to work with <a href="https://github.com/git/git/commit/15b4a163950c2e8660a7797ce3975ccea8705f80#diff-f37c4f4a898819f0ca4b5ff69e81d4d9">git v2.13.0</a> thanks to <a href="https://gist.github.com/mmrko/b3ec6da9bea172cdb6bd83bdf95ee817#gistcomment-2218059">Alexander Ko's comment</a>.<br>
EDIT 2018-03-24: Updated to <a href="https://github.com/git/git/commit/227307a639c96b3579b7fe60840fdae123d1ee88">speed up branch and tag completion</a>.</p>
  </div>
<div class="article_meta">
  <p>Posted <time data-reltime datetime="2014-09-24T23:05:00-04:00">Sep 24, 2014</time>
   by Carey Metcalfe  </p>
  <p>Last updated <time data-reltime datetime="2018-03-24T19:00:00-04:00">Mar 24, 2018</time></p>
  <p>
  Tags:
    <a href="../blog/tags/git.html">git</a>,    <a href="../blog/tags/shell-script.html">shell script</a>  </p>
</div>
  <script src="https://giscus.app/client.js"
          data-repo="pR0Ps/cmetcalfe.ca"
          data-repo-id="MDEwOlJlcG9zaXRvcnkyNDUwNTQ4Njg="
          data-category="Announcements"
          data-category-id="DIC_kwDODps9lM4CTHc_"
          data-mapping="pathname"
          data-strict="0"
          data-reactions-enabled="1"
          data-emit-metadata="0"
          data-input-position="top"
          data-theme="light"
          data-lang="en"
          data-loading="lazy"
          crossorigin="anonymous"
          async>
  </script>
</article>


    <div id="ending_message">
        <p>&copy; Carey Metcalfe. Built using <a href="http://getpelican.com">Pelican</a>. Theme is <a href="https://github.com/pR0Ps/pelican-subtle">subtle</a> by <a href="http://cmetcalfe.ca">Carey Metcalfe</a>. Based on <a href="https://github.com/giulivo/pelican-svbhack">svbhack</a> by Giulio Fidente.</p>
    </div>
  </main>

  <script type="text/javascript">
    window.addEventListener('load', skipHeader)
  </script>

  <script type="text/javascript">
  window.addEventListener('load', unmangleEmail)
  </script>

<script type="text/javascript">window.addEventListener("load", reltime);</script>
</body>
</html>