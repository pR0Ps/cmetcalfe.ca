<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Carey Metcalfe">
  <meta name="description" content="Posts by Carey Metcalfe">

  <link rel="stylesheet" type="text/css" href="../theme/css/styles.ec0bdb0f.min.css">

  <script src="../theme/js/scripts.7db5858b.min.js" type="text/javascript"></script>

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">

  <link href="https://cmetcalfe.ca/feeds/all.rss" type="application/rss+xml" rel="alternate" title="Carey Metcalfe Full RSS Feed" />

  <meta name="keywords" content="blog, carey, cmetcalfe, metcalfe, pr0ps, pr0pscm, android, application, audio, automation, backup, chromecast, code, data recovery, electronics, email, games, git, hardware, homelab, iphone, let's encrypt, linux, macOS, mercurial, networking, nvidia, png, proxmox, python, queen's university, router, security, shell script, sites, steam, vim, website, windows, wine">

  <title>Blog | Carey Metcalfe</title>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-28306875-1', 'cmetcalfe.ca');
  ga('send', 'pageview');
</script>
</head>

<body>
  <aside>
    <div id="user_meta">
      <a href="..">
        <img src="/images/avatar.jpg" id="logo">
      </a>
      <h2><a href=".." class="nohover">Carey Metcalfe</a></h2>
      <p>Software Developer</p>
      <div class="social">
          <a data-email="ac.eflactemc@yerac:otliam" data-title="Email" title="You need javascript enabled to view this email" class="email" target="_blank" rel="noopener noreferrer"><i class="fa fa-envelope fa-lg"></i></a>
          <a href="https://github.com/pR0Ps" title="GitHub" target="_blank" rel="noopener noreferrer"><i class="fa fa-github fa-lg"></i></a>
          <a href="https://twitter.com/CareyMetcalfe" title="Twitter" target="_blank" rel="noopener noreferrer"><i class="fa fa-twitter fa-lg"></i></a>
      </div>
      <ul>
      </ul>
    </div>
  </aside>

  <main id="main">
    <header>
      <p id="header">
      <a href="..">Home</a>

      &#124; <a href="../blog/index.html">Blog</a>
      &#124; <a href="https://cmetcalfe.ca/feeds/all.rss">RSS Feed</a>
      </p>
<p>
<a href="../blog/index.html">Posts</a>
&#124; <a href="../blog/tags/">Tags</a>
&#124; <a href="../blog/archives.html">Archive</a>
</p>    </header>

<article>
  <div class="article_title">
    <h1><a href="../blog/preserving-xposed-framework-through-a-flash.html">Preserving the Xposed Framework through a ROM flash</a></h1>
  </div>
  <div class="article_text">
    <p>The <a href="https://repo.xposed.info/">Xposed Framework</a> is a neat Android program that enables <a href="https://repo.xposed.info/module-overview">user-made
modules</a> to change the behaviour of the lower-level Android OS. It does this
by modifying <code>/system/bin/app_process</code> to add some hooks into it.</p>
<p>The issue is that when flashing a new ROM, the modified <code>app_process</code> is
reverted back to the original version, disabling the Xposed Framework until it's
restored.</p>
<div class="admonition update">
<p class="admonition-title">Update</p>
<p>The Xposed Framework installer now includes the option to flash a zip file
to install the framework instead of patching <code>app_process</code> directly. The
method detailed in this post will still work, but the new way to make sure
the framework is installed after flashing a new ROM is to simply flash the
Xposed installer zip right after flashing the ROM.</p>
</div>
<p>The solution to this is a script that will automatically back up the existing
<code>app_process</code> before a flash, then restore it after the flash completes.</p>
<p>The <a href="../files/90-xposed.sh">90-xposed.sh</a> script does exactly that. To enable it, download it to the
Android device, move it to <code>/system/addon.d/90-xposed.sh</code>, and give it
executable permissions.</p>
<p>This can be done on the device with a few different programs, but it's much
easier to do from a computer with <a href="https://developer.android.com/tools/help/adb.html">adb</a>.</p>
<p>Download the script and push it to the SD card of the Android device with</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>adb push <span class="m">90</span>-xposed.sh /sdcard/
</code></pre></div></td></tr></table></div>

<p>Once the file is on the device, log into it (using <code>adb shell</code>) and run the
following commands:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code>su  <span class="c1"># Get root permissions</span>
cp /sdcard/90-xposed.sh /system/addon.d/  <span class="c1"># Copy the file to the correct folder</span>
chmod <span class="m">755</span> /system/addon.d/90-xposed.sh  <span class="c1"># Make the file executable</span>
</code></pre></div></td></tr></table></div>

<p>After logging out of the device, the Xposed framework will stay installed and
active even after flashing a new ROM. Note that this should only really be
used in situations where the ROM isn't changing too much (like flashing a new
nightly ROM).</p>
<p>In situations where <code>app_process</code> would actually be changed by the flash, this
script could cause issues as it would restore an incorrect version of the file.
If this happens, delete <code>app_process</code> and <code>app_process.orig</code> in the
<code>/system/bin/</code> directory, then reflash. The script won't interfere, allowing
the flash to update <code>app_process</code> to the correct version. After rebooting,
install the Xposed Framework again.</p>
  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="../blog/limit-download-speed-by-ip-or-mac-address.html">Limit download speed by IP or MAC address</a></h1>
  </div>
  <div class="article_text">
    <h2>Preamble</h2>
<p>This article will focus on setting strict speed limits on misbehaving devices on your network. This can be a housemate incessantly torrenting, your kid downloading movies on iTunes, or anyone else clogging up your network with their overzealous bandwidth gobbling.</p>
<p>If you're looking for help with the QOS (quality of service) settings that come baked into most router firmwares, this article is not for you.</p>
<p>This article assumes you have a router running OpenWRT, DD-WRT, Tomato, or any other firmware that uses <a href="http://linux.die.net/man/8/tc"><code>tc</code></a> to manipulate traffic control settings.</p>
<h2>Procedure</h2>
<p>First, you'll need to get shell access to the router. With most custom router firmwares, this is as easy as selecting a radio button. Other firmwares might give you the ability to enter commands via a web interface. Whatever works.</p>
<p>Once you have shell access, follow the steps below. Note that bits of the commands you might want to change are included in brackets.</p>
<ol>
<li>
<p>Using <code>ifconfig</code>, find the interface to apply the limits to. You'll want to use either the internal or external default gateway (the interfaces all the packets go though). Keep in mind which interface you use as the filtering rules will be reversed. </p>
<ul>
<li>Internal gateway: to src = uploading, to dst = downloading</li>
<li>External gateway: to src = downloading, to dst = uploading</li>
</ul>
</li>
<li>
<p>Remove all existing rules on the interface (interface = <code>br0</code>)</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>tc qdisc del dev br0 root
</code></pre></div></td></tr></table></div>

</li>
<li>
<p>Set up the connection (Ex: connection speed = 20mbit)</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>tc qdisc add dev br0 root handle 1: cbq avpkt 1000 bandwidth 20mbit
</code></pre></div></td></tr></table></div>

</li>
<li>
<p>Add the limiting rule (Ex: speed limit = 10mbit)</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>tc class add dev br0 parent 1: classid 1:1 cbq rate 10mbit allot 1500 prio 5 bounded isolated
</code></pre></div></td></tr></table></div>

</li>
<li>
<p>Filtering - Add the users to apply to rule to</p>
<ul>
<li>
<p>By src IP (Ex: IP = <code>192.168.1.100</code>)</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>tc filter add dev br0 parent 1: protocol ip prio 16 u32 match ip src 192.168.1.100 flowid 1:1
</code></pre></div></td></tr></table></div>

</li>
<li>
<p>By dst IP (Ex: IP = <code>192.168.1.100</code>)</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>tc filter add dev br0 parent 1: protocol ip prio 16 u32 match ip dst 192.168.1.100 flowid 1:1
</code></pre></div></td></tr></table></div>

</li>
<li>
<p>By src MAC (Ex: MAC = <code>M0-M1-M2-M3-M4-M5</code>)</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>tc filter add dev br0 parent 1: protocol ip prio 5 u32 match u16 0x0800 0xFFFF at -2 match u16 0xM4M5 0xFFFF at -4 match u32 0xM0M1M2M3 0xFFFFFFFF at -8 flowid 1:1
</code></pre></div></td></tr></table></div>

</li>
<li>
<p>By dst MAC (Ex: MAC = <code>M0-M1-M2-M3-M4-M5</code>)</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>tc filter add dev br0 parent 1: protocol ip prio 5 u32 match u16 0x0800 0xFFFF at -2 match u32 0xM2M3M4M5 0xFFFFFFFF at -12 match u16 0xM0M1 0xFFFF at -14 flowid 1:1
</code></pre></div></td></tr></table></div>

</li>
</ul>
</li>
</ol>
<h2>Sources</h2>
<ul>
<li>http://lartc.org/lartc.html</li>
<li>http://www.docum.org/faq/cache/62.html</li>
</ul>
  </div>
</article>
<hr />
<article>
  <div class="article_title">
    <h1><a href="../blog/preventing-wine-from-registering-mimetypes.html">Preventing Wine from registering mimetypes</a></h1>
  </div>
  <div class="article_text">
    <p>When installing <a href="http://winehq.org/">Wine for Linux</a>, the install script insists on associating all text files with its built-in notepad.exe</p>
<p>As someone who uses <a href="http://www.vim.org/">Vim</a> almost exculsively, this is definitely not the desired behaviour.</p>
<p>To stop this from happening, run the following command <em>before</em> installing Wine.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nb">export</span> <span class="nv">WINEDLLOVERRIDES</span><span class="o">=</span><span class="s1">&#39;winemenubuilder.exe=a&#39;</span>
</code></pre></div></td></tr></table></div>

<p>This sets the path of the winemenubuilder library (the library that creates mimetype associations) to something invalid,
preventing the associations from being made when Wine installs.</p>
<p>Once Wine is installed, it won't try to associate notepad.exe again. However, if needed,
the library can be properly disabled via the libraries tab of wineconf.</p>
  </div>
</article>

<footer>
<div id="paginator">
  <span id="left">
      <a href="../blog/index6.html"><i class="fa fa-arrow-circle-left"></i> Prev</a>
  </span>
  <span id="right">
      <a href="../blog/index8.html">Next <i class="fa fa-arrow-circle-right"></i></a>
  </span>
  <div>
      <a href="../blog/index.html"> 1 </a>
      <a href="../blog/index2.html"> 2 </a>
      <a href="../blog/index3.html"> 3 </a>
      <a href="../blog/index4.html"> 4 </a>
      <a href="../blog/index5.html"> 5 </a>
      <a href="../blog/index6.html"> 6 </a>
      <a href="../blog/index7.html">[7]</a>
      <a href="../blog/index8.html"> 8 </a>
      <a href="../blog/index9.html"> 9 </a>
      <a href="../blog/index10.html"> 10 </a>
      <a href="../blog/index11.html"> 11 </a>
      <a href="../blog/index12.html"> 12 </a>
      <a href="../blog/index13.html"> 13 </a>
  </div>
</div>
</footer>

    <div id="ending_message">
        <p>&copy; Carey Metcalfe. Built using <a href="http://getpelican.com">Pelican</a>. Theme is <a href="https://github.com/pR0Ps/pelican-subtle">subtle</a> by <a href="http://cmetcalfe.ca">Carey Metcalfe</a>. Based on <a href="https://github.com/giulivo/pelican-svbhack">svbhack</a> by Giulio Fidente.</p>
    </div>
  </main>

  <script type="text/javascript">
    window.addEventListener('load', skipHeader)
  </script>

  <script type="text/javascript">
  window.addEventListener('load', unmangleEmail)
  </script>
</body>
</html>