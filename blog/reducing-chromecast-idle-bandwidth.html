<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Carey Metcalfe">
  <meta name="description" content="Reducing Chromecast Idle Bandwidth | Google&#39;s Chromecast is a pretty useful device. It plugs into the HDMI port of a TV and allows users to &#34;cast&#34;...">

  <link rel="stylesheet" type="text/css" href="../theme/css/styles.425931e9.min.css">

  <script src="../theme/js/scripts.ab06d70e.min.js" type="text/javascript"></script>

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">

  <link href="https://cmetcalfe.ca/feeds/all.rss" type="application/rss+xml" rel="alternate" title="Carey Metcalfe Full RSS Feed" />

<meta name="keywords" content="blog, carey, cmetcalfe, metcalfe, pr0ps, pr0pscm, chromecast, png">

  <title>Reducing Chromecast Idle Bandwidth | Carey Metcalfe</title>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-28306875-1', 'cmetcalfe.ca');
  ga('send', 'pageview');
</script>
</head>

<body>
  <aside>
    <div id="user_meta">
      <a href="..">
        <img src="/images/avatar.jpg" id="logo">
      </a>
      <h2><a href=".." class="nohover">Carey Metcalfe</a></h2>
      <p>Software Developer</p>
      <div class="social">
          <a data-email="ac.eflactemc@yerac:otliam" data-title="Email" title="You need javascript enabled to view this email" class="email" target="_blank" rel="noopener noreferrer"><i class="fa fa-envelope fa-lg"></i></a>
          <a href="https://github.com/pR0Ps" title="GitHub" target="_blank" rel="noopener noreferrer"><i class="fa fa-github fa-lg"></i></a>
          <a href="https://twitter.com/CareyMetcalfe" title="Twitter" target="_blank" rel="noopener noreferrer"><i class="fa fa-twitter fa-lg"></i></a>
      </div>
      <ul>
      </ul>
    </div>
  </aside>

  <main id="main">
    <header>
      <p id="header">
      <a href="..">Home</a>

      &#124; <a href="../blog/index.html">Blog</a>
      &#124; <a href="https://cmetcalfe.ca/feeds/all.rss">RSS Feed</a>
      </p>
<p>
<a href="../blog/index.html">Posts</a>
&#124; <a href="../blog/tags/">Tags</a>
&#124; <a href="../blog/archives.html">Archive</a>
</p>    </header>

<article>
  <div class="article_title">
    <h1><a href="../blog/reducing-chromecast-idle-bandwidth.html" class="nohover">Reducing Chromecast Idle Bandwidth</a></h1>
  </div>
  <div class="article_text">
    <p>Google's <a href="https://store.google.com/product/chromecast">Chromecast</a> is a pretty useful device. It plugs into the HDMI port of a TV and allows
users to "cast" content to it via a smartphone, <a href="https://www.google.com/chrome/">Chrome browser</a>, etc. This content is mostly
assumed to be streaming services like <a href="https://www.youtube.com/">Youtube</a>, <a href="https://www.spotify.com/">Spotify</a>, or <a href="https://www.netflix.com/">Netflix</a>, but for someone who
doesn't really buy into the whole cloud revolution like myself, it's still perfectly capable of
playing local content as well.</p>
<p>The one downside of the Chromecast is that when it's not being used, instead of going into a
low-power state and/or turning off the TV, it instead enters <a href="https://support.google.com/chromecast/answer/6080931">Ambient Mode</a>. This shows some
useful information overlaid on a changing backdrop of featured photos downloaded from <a href="https://photos.google.com/">Google
Photos</a>. The issue with this is that the images are high-resolution, not cached, and are
continually being downloaded 24/7 even when the TV is turned off. Although I haven't personally
measured it, the general consensus seems to be that it uses around 15GB of data per month from just
being plugged in.</p>
<p>What I'll be going over here is reducing the data the Chromecast uses by configuring it to only
download some tiny black 1x1 px images to use as a backdrop.</p>
<h2>The short version</h2>
<ul>
<li>Make a tiny black PNG (<a href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAAAAAA6fptVAAAACklEQVQIHWNgAAAAAgABz8g15QAAAABJRU5ErkJggg==">pixel.png</a>)</li>
<li>Make a slightly different tiny PNG to avoid deduplication (<a href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAAAAAA6fptVAAAACklEQVQIW2NgAAAAAgABYkBPaAAAAABJRU5ErkJggg==">pixel_alt1.png</a>)</li>
<li>Upload both to an album in Google Photos</li>
<li>Mark both images as favorites</li>
<li>Configure the Chromecast to only pull images from your specific album every 10 minutes</li>
</ul>
<p>If you like details, keep reading...</p>
<h2>Making a small image</h2>
<p>I ended up creating a 1x1 solid black image in GIMP, saving it as a PNG, hacking out as much data as
possible using a hex editor, then using <a href="https://pmt.sourceforge.io/pngcrush/"><code>pngcrush</code></a> to attempt to optimize the data
that was left.</p>
<p>As I was working on the PNG file, I used a small script based on the Python <a href="https://construct.readthedocs.io/en/latest/">construct</a> library to
visualize the chunks and structure of it so I could figure out what to cut.</p>
<p>To install <code>construct</code> and download the example PNG specification:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>python3 -m venv .venv
<span class="nb">source</span> .venv/bin/activate
pip install construct
wget <span class="s2">&quot;https://raw.githubusercontent.com/construct/construct/abd48c4892ceddc60c11d25f4a955573e2c61111/deprecated_gallery/png.py&quot;</span>
</code></pre></div>
</td></tr></table>
<p>Create <code>pngview.py</code>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">png</span>  <span class="c1"># the png spec downloaded above</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Size:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s2">&quot;bytes&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">png</span><span class="o">.</span><span class="n">png_file</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</code></pre></div>
</td></tr></table>
<p>Running it on the PNG exported from GIMP using the default settings gives:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ ./pngview.py pixel.png
Size: <span class="m">146</span> bytes
Container: 
    <span class="nv">signature</span> <span class="o">=</span> b<span class="s1">&#39;\x89PNG\r\n\x1a\n&#39;</span> <span class="o">(</span>total <span class="m">8</span><span class="o">)</span>
    <span class="nv">image_header</span> <span class="o">=</span> Container: 
        <span class="nv">length</span> <span class="o">=</span> <span class="m">13</span>
        <span class="nv">signature</span> <span class="o">=</span> b<span class="s1">&#39;IHDR&#39;</span> <span class="o">(</span>total <span class="m">4</span><span class="o">)</span>
        <span class="nv">width</span> <span class="o">=</span> <span class="m">1</span>
        <span class="nv">height</span> <span class="o">=</span> <span class="m">1</span>
        <span class="nv">bit_depth</span> <span class="o">=</span> <span class="m">8</span>
        <span class="nv">color_type</span> <span class="o">=</span> <span class="o">(</span>enum<span class="o">)</span> truecolor <span class="m">2</span>
        <span class="nv">compression_method</span> <span class="o">=</span> <span class="o">(</span>enum<span class="o">)</span> deflate <span class="m">0</span>
        <span class="nv">filter_method</span> <span class="o">=</span> <span class="o">(</span>enum<span class="o">)</span> adaptive5 <span class="m">0</span>
        <span class="nv">interlace_method</span> <span class="o">=</span> <span class="o">(</span>enum<span class="o">)</span> none <span class="m">0</span>
        <span class="nv">crc</span> <span class="o">=</span> <span class="m">2423739358</span>
    <span class="nv">chunks</span> <span class="o">=</span> ListContainer: 
        Container: 
            <span class="nv">length</span> <span class="o">=</span> <span class="m">9</span>
            <span class="nb">type</span> <span class="o">=</span> b<span class="s1">&#39;pHYs&#39;</span> <span class="o">(</span>total <span class="m">4</span><span class="o">)</span>
            <span class="nv">data</span> <span class="o">=</span> Container: 
                <span class="nv">pixels_per_unit_x</span> <span class="o">=</span> <span class="m">11811</span>
                <span class="nv">pixels_per_unit_y</span> <span class="o">=</span> <span class="m">11811</span>
                <span class="nv">unit</span> <span class="o">=</span> <span class="o">(</span>enum<span class="o">)</span> meter <span class="m">1</span>
            <span class="nv">crc</span> <span class="o">=</span> <span class="m">2024095606</span>
        Container: 
            <span class="nv">length</span> <span class="o">=</span> <span class="m">7</span>
            <span class="nb">type</span> <span class="o">=</span> b<span class="s1">&#39;tIME&#39;</span> <span class="o">(</span>total <span class="m">4</span><span class="o">)</span>
            <span class="nv">data</span> <span class="o">=</span> Container: 
                <span class="nv">year</span> <span class="o">=</span> <span class="m">2018</span>
                <span class="nv">month</span> <span class="o">=</span> <span class="m">12</span>
                <span class="nv">day</span> <span class="o">=</span> <span class="m">11</span>
                <span class="nv">hour</span> <span class="o">=</span> <span class="m">5</span>
                <span class="nv">minute</span> <span class="o">=</span> <span class="m">2</span>
                <span class="nv">second</span> <span class="o">=</span> <span class="m">19</span>
            <span class="nv">crc</span> <span class="o">=</span> <span class="m">904567710</span>
        Container: 
            <span class="nv">length</span> <span class="o">=</span> <span class="m">25</span>
            <span class="nb">type</span> <span class="o">=</span> b<span class="s1">&#39;tEXt&#39;</span> <span class="o">(</span>total <span class="m">4</span><span class="o">)</span>
            <span class="nv">data</span> <span class="o">=</span> Container: 
                <span class="nv">keyword</span> <span class="o">=</span> u<span class="s1">&#39;Comment&#39;</span> <span class="o">(</span>total <span class="m">7</span><span class="o">)</span>
                <span class="nv">text</span> <span class="o">=</span> b<span class="s1">&#39;Created with GIM&#39;</span>... <span class="o">(</span>truncated, total <span class="m">17</span><span class="o">)</span>
            <span class="nv">crc</span> <span class="o">=</span> <span class="m">1468075543</span>
        Container: 
            <span class="nv">length</span> <span class="o">=</span> <span class="m">12</span>
            <span class="nb">type</span> <span class="o">=</span> b<span class="s1">&#39;IDAT&#39;</span> <span class="o">(</span>total <span class="m">4</span><span class="o">)</span>
            <span class="nv">data</span> <span class="o">=</span> b<span class="s1">&#39;\x08\xd7c```\x00\x00\x00\x04\x00\x01&#39;</span> <span class="o">(</span>total <span class="m">12</span><span class="o">)</span>
            <span class="nv">crc</span> <span class="o">=</span> <span class="m">657729290</span>
        Container: 
            <span class="nv">length</span> <span class="o">=</span> <span class="m">0</span>
            <span class="nb">type</span> <span class="o">=</span> b<span class="s1">&#39;IEND&#39;</span> <span class="o">(</span>total <span class="m">4</span><span class="o">)</span>
            <span class="nv">data</span> <span class="o">=</span> None
            <span class="nv">crc</span> <span class="o">=</span> <span class="m">2923585666</span>
</code></pre></div>
</td></tr></table>
<p>After removing the unneeded <code>pHYs</code>, <code>tIME</code>, and <code>tEXt</code> chunks using a hex editor, it looks like this:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ ./pngview.py pixel.png 
Size: <span class="m">69</span> bytes
Container: 
    <span class="nv">signature</span> <span class="o">=</span> b<span class="s1">&#39;\x89PNG\r\n\x1a\n&#39;</span> <span class="o">(</span>total <span class="m">8</span><span class="o">)</span>
    <span class="nv">image_header</span> <span class="o">=</span> Container: 
        <span class="nv">length</span> <span class="o">=</span> <span class="m">13</span>
        <span class="nv">signature</span> <span class="o">=</span> b<span class="s1">&#39;IHDR&#39;</span> <span class="o">(</span>total <span class="m">4</span><span class="o">)</span>
        <span class="nv">width</span> <span class="o">=</span> <span class="m">1</span>
        <span class="nv">height</span> <span class="o">=</span> <span class="m">1</span>
        <span class="nv">bit_depth</span> <span class="o">=</span> <span class="m">8</span>
        <span class="nv">color_type</span> <span class="o">=</span> <span class="o">(</span>enum<span class="o">)</span> truecolor <span class="m">2</span>
        <span class="nv">compression_method</span> <span class="o">=</span> <span class="o">(</span>enum<span class="o">)</span> deflate <span class="m">0</span>
        <span class="nv">filter_method</span> <span class="o">=</span> <span class="o">(</span>enum<span class="o">)</span> adaptive5 <span class="m">0</span>
        <span class="nv">interlace_method</span> <span class="o">=</span> <span class="o">(</span>enum<span class="o">)</span> none <span class="m">0</span>
        <span class="nv">crc</span> <span class="o">=</span> <span class="m">2423739358</span>
    <span class="nv">chunks</span> <span class="o">=</span> ListContainer: 
        Container: 
            <span class="nv">length</span> <span class="o">=</span> <span class="m">12</span>
            <span class="nb">type</span> <span class="o">=</span> b<span class="s1">&#39;IDAT&#39;</span> <span class="o">(</span>total <span class="m">4</span><span class="o">)</span>
            <span class="nv">data</span> <span class="o">=</span> b<span class="s1">&#39;\x08\xd7c```\x00\x00\x00\x04\x00\x01&#39;</span> <span class="o">(</span>total <span class="m">12</span><span class="o">)</span>
            <span class="nv">crc</span> <span class="o">=</span> <span class="m">657729290</span>
        Container: 
            <span class="nv">length</span> <span class="o">=</span> <span class="m">0</span>
            <span class="nb">type</span> <span class="o">=</span> b<span class="s1">&#39;IEND&#39;</span> <span class="o">(</span>total <span class="m">4</span><span class="o">)</span>
            <span class="nv">data</span> <span class="o">=</span> None
            <span class="nv">crc</span> <span class="o">=</span> <span class="m">2923585666</span>
</code></pre></div>
</td></tr></table>
<p>At this point, all that's left to optimize is the image data itself. This is where <code>pngcrush</code>
shines. After running <code>pngcrush -brute -ow pixel.png</code> we see:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ ./pngview.py pixel.png
Size: <span class="m">67</span> bytes
Container: 
    <span class="nv">signature</span> <span class="o">=</span> b<span class="s1">&#39;\x89PNG\r\n\x1a\n&#39;</span> <span class="o">(</span>total <span class="m">8</span><span class="o">)</span>
    <span class="nv">image_header</span> <span class="o">=</span> Container: 
        <span class="nv">length</span> <span class="o">=</span> <span class="m">13</span>
        <span class="nv">signature</span> <span class="o">=</span> b<span class="s1">&#39;IHDR&#39;</span> <span class="o">(</span>total <span class="m">4</span><span class="o">)</span>
        <span class="nv">width</span> <span class="o">=</span> <span class="m">1</span>
        <span class="nv">height</span> <span class="o">=</span> <span class="m">1</span>
        <span class="nv">bit_depth</span> <span class="o">=</span> <span class="m">8</span>
        <span class="nv">color_type</span> <span class="o">=</span> <span class="o">(</span>enum<span class="o">)</span> greyscale <span class="m">0</span>
        <span class="nv">compression_method</span> <span class="o">=</span> <span class="o">(</span>enum<span class="o">)</span> deflate <span class="m">0</span>
        <span class="nv">filter_method</span> <span class="o">=</span> <span class="o">(</span>enum<span class="o">)</span> adaptive5 <span class="m">0</span>
        <span class="nv">interlace_method</span> <span class="o">=</span> <span class="o">(</span>enum<span class="o">)</span> none <span class="m">0</span>
        <span class="nv">crc</span> <span class="o">=</span> <span class="m">981375829</span>
    <span class="nv">chunks</span> <span class="o">=</span> ListContainer: 
        Container: 
            <span class="nv">length</span> <span class="o">=</span> <span class="m">10</span>
            <span class="nb">type</span> <span class="o">=</span> b<span class="s1">&#39;IDAT&#39;</span> <span class="o">(</span>total <span class="m">4</span><span class="o">)</span>
            <span class="nv">data</span> <span class="o">=</span> b<span class="s1">&#39;\x08\x1dc`\x00\x00\x00\x02\x00\x01&#39;</span> <span class="o">(</span>total <span class="m">10</span><span class="o">)</span>
            <span class="nv">crc</span> <span class="o">=</span> <span class="m">3486004709</span>
        Container: 
            <span class="nv">length</span> <span class="o">=</span> <span class="m">0</span>
            <span class="nb">type</span> <span class="o">=</span> b<span class="s1">&#39;IEND&#39;</span> <span class="o">(</span>total <span class="m">4</span><span class="o">)</span>
            <span class="nv">data</span> <span class="o">=</span> None
            <span class="nv">crc</span> <span class="o">=</span> <span class="m">2923585666</span>
</code></pre></div>
</td></tr></table>
<p>The 2 byte savings in the data seem to have come from setting the <code>color_type</code> to <code>greyscale</code>
instead of <code>truecolor</code>. To view what actually changed in the data, we can un-<code>deflate</code> it using Python:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">zlib</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># before pngcrush (12 bytes)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x08\xd7</span><span class="s1">c```</span><span class="se">\x00\x00\x00\x04\x00\x01</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00</span><span class="s1">&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># after pngcrush (10 bytes)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x08\x1d</span><span class="s1">c`</span><span class="se">\x00\x00\x00\x02\x00\x01</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00\x00</span><span class="s1">&#39;</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div>
</td></tr></table>
<p>This makes sense since, according to the <a href="https://www.w3.org/TR/PNG/">PNG spec</a>, when using <code>truecolor</code>, each pixel is an RGB
triple, requiring 3 bytes. For <code>greyscale</code>, only a single byte representing luminance is needed. The
first byte is the filtering method, which isn't relevant here since we only have a single pixel.</p>
<p>Interestingly enough, in both cases we would actually be much better off if we could opt to <strong>not</strong> use
compression, but alas, the spec does not allow for anything except <code>deflate</code>.</p>
<p>But I digress, we now have a black 1x1 px PNG image that's just 67 bytes (<a href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAAAAAA6fptVAAAACklEQVQIHWNgAAAAAgABz8g15QAAAABJRU5ErkJggg==">pixel.png</a>).</p>
<h2>Generating multiple unique small images</h2>
<p>So now we have the small PNG we want to display. Since the Chromecast's ambient mode requires at
least 2 different images in an album to cycle through, all we need to to do is upload 2 copies
of this PNG and we're done right? Almost.</p>
<p>Since Google Photos will automatically deduplicate uploaded images, we need to find a way to make
the second image slightly different. Normally this would involve tweaking a comment or something,
but in this case, the image has already been stripped down to its bare essentials.</p>
<p>My strategy was attempt to abuse the data compression to see if I could generate an image that
compressed the same data into the same number of bytes, but differently. Fortunately, <code>pngcrush</code> can
be told to use specific compression strategies (there are currently 177 of them). My hope is that at
least one of these will achieve the same results, but in a different way. For starters we'll try the
first 9:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">for</span> x <span class="k">in</span> <span class="k">$(</span>seq <span class="m">9</span><span class="k">)</span><span class="p">;</span> <span class="k">do</span>
    pngcrush -m <span class="s2">&quot;</span><span class="nv">$x</span><span class="s2">&quot;</span> pixel.png pixel_alt<span class="si">${</span><span class="nv">x</span><span class="si">}</span>.png<span class="p">;</span>
<span class="k">done</span>
</code></pre></div>
</td></tr></table>
<p>A quick <code>ls -l</code> reveals that all of the <code>pixel_alt*.png</code> files are still 67 bytes. Now we just need
to find one that has different data. <code>sha1sum</code> is the perfect utility for this:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ sha1sum pixel.png pixel_alt*.png
d99a9d63b1cd9e4b3f823d4d03144ccd95328f48  pixel.png
7487dcce2b2bb81a442faf139b0a547bf070d5e2  pixel_alt1.png
7487dcce2b2bb81a442faf139b0a547bf070d5e2  pixel_alt2.png
7487dcce2b2bb81a442faf139b0a547bf070d5e2  pixel_alt3.png
c3ea09bfcfcb36ce22d3f19eacada359f3984ed1  pixel_alt4.png
c3ea09bfcfcb36ce22d3f19eacada359f3984ed1  pixel_alt5.png
c3ea09bfcfcb36ce22d3f19eacada359f3984ed1  pixel_alt6.png
c3ea09bfcfcb36ce22d3f19eacada359f3984ed1  pixel_alt7.png
c3ea09bfcfcb36ce22d3f19eacada359f3984ed1  pixel_alt8.png
d99a9d63b1cd9e4b3f823d4d03144ccd95328f48  pixel_alt9.png
</code></pre></div>
</td></tr></table>
<p><code>pixel_alt1.png</code> looks like a good candidate, let's see what changed:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>$ diff &lt;<span class="o">(</span>./pngview.py pixel.png<span class="o">)</span> &lt;<span class="o">(</span>./pngview.py pixel_alt1.png<span class="o">)</span>
<span class="m">20</span>,21c20,21
&lt;             <span class="nv">data</span> <span class="o">=</span> b<span class="s1">&#39;\x08\x1dc`\x00\x00\x00\x02\x00\x01&#39;</span> <span class="o">(</span>total <span class="m">10</span><span class="o">)</span>
&lt;             <span class="nv">crc</span> <span class="o">=</span> <span class="m">3486004709</span>
---
&gt;             <span class="nv">data</span> <span class="o">=</span> b<span class="s1">&#39;\x08[c`\x00\x00\x00\x02\x00\x01&#39;</span> <span class="o">(</span>total <span class="m">10</span><span class="o">)</span>
&gt;             <span class="nv">crc</span> <span class="o">=</span> <span class="m">1648381800</span>
</code></pre></div>
</td></tr></table>
<p>There's the same amount of data, but it's different. Let's check if it decompresses to the same
image data:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">zlib</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x08\x1d</span><span class="s1">c`</span><span class="se">\x00\x00\x00\x02\x00\x01</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00\x00</span><span class="s1">&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x08</span><span class="s1">[c`</span><span class="se">\x00\x00\x00\x02\x00\x01</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00\x00</span><span class="s1">&#39;</span>
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div>
</td></tr></table>
<p>Yep, this means that <a href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAAAAAA6fptVAAAACklEQVQIW2NgAAAAAgABYkBPaAAAAABJRU5ErkJggg==">pixel_alt1.png</a> is the exact same image with the exact same size, but won't
be deduplicated when uploading it to Google Photos since the compressed data is different.</p>
<h2>Final touches</h2>
<p>Now that we have 2 different tiny images, we can upload them to Google Photos and put them in an
album so they can be pulled down by the Chromecast. Something to note is that you may have to mark
the images as favorites to get them to be displayed. There seems to be some sort of AI-fueled "we
know better than you" algorithm that initially refused to display my images until I starred them.</p>
<p>Now just set your ambient mode to display the album with your images in it (or your favorites
album), set the slideshow speed to its maximum value (change image every 10 mins), and you're done.</p>
  </div>
<div class="article_meta">
  <p>Posted <time data-timeago datetime="2018-12-10T22:50:00-05:00">Dec 10, 2018</time>
   by Carey Metcalfe  </p>
  <p>
  Tags:
    <a href="../blog/tags/chromecast.html">chromecast</a>,    <a href="../blog/tags/png.html">png</a>  </p>
</div>
  <div id="article_comments">
    <div id="disqus_thread">
      <a href="javascript:loadDisqus()"><i class="fa fa-comments fa-lg"></i>Click to load <span class="disqus-comment-count" data-disqus-identifier="blog/reducing-chromecast-idle-bandwidth.html">comments</span></a>
    </div>
  </div>

  <script id="dsq-count-scr" src="https://cmetcalfe.disqus.com/count.js" async></script>
  <script type="text/javascript">
    var disqus_config = function () {
        this.page.identifier = "blog/reducing-chromecast-idle-bandwidth.html";
        this.page.title = "Reducing Chromecast Idle Bandwidth";
    };
    loadDisqus = function(sitename) {
      var d = document, s = d.createElement('script');
      s.src = 'https://cmetcalfe.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    };
  </script>
</article>


    <div id="ending_message">
        <p>&copy; Carey Metcalfe. Built using <a href="http://getpelican.com">Pelican</a>. Theme is <a href="https://github.com/pR0Ps/pelican-subtle">subtle</a> by <a href="http://cmetcalfe.ca">Carey Metcalfe</a>. Based on <a href="https://github.com/giulivo/pelican-svbhack">svbhack</a> by Giulio Fidente.</p>
    </div>
  </main>

  <script type="text/javascript">
    window.addEventListener('load', skipHeader)
  </script>

  <script type="text/javascript">
  window.addEventListener('load', unmangleEmail)
  </script>

<script type="text/javascript">window.addEventListener("load", lw_timeago);</script>
</body>
</html>